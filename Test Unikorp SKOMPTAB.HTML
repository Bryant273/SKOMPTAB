<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIKORP - SKOMPTAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #5D5CDE;
            --secondary-color: #4b4aae;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            
            --light-bg: #ffffff;
            --dark-bg: #181818;
            --light-text: #333333;
            --dark-text: #f5f5f5;
            --light-border: #e5e7eb;
            --dark-border: #374151;
            --light-hover: #f3f4f6;
            --dark-hover: #1f2937;
            
            /* Module colors */
            --skomptab-color: #5D5CDE;
            --logson-color: #10b981;
            --socix-color: #f59e0b;
            --markos-color: #3b82f6;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .dark {
            --bg-color: var(--dark-bg);
            --text-color: var(--dark-text);
            --border-color: var(--dark-border);
            --hover-color: var(--dark-hover);
        }
        
        :not(.dark) {
            --bg-color: var(--light-bg);
            --text-color: var(--light-text);
            --border-color: var(--light-border);
            --hover-color: var(--light-hover);
        }
        
        .sidebar-item.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .sidebar-item:hover:not(.active) {
            background-color: var(--hover-color);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 50;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeContent 0.5s ease;
        }
        
        @keyframes fadeContent {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Module Styling */
        .module-nav-item {
            position: relative;
            padding: 0.75rem 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .module-nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background-color: white;
            transition: width 0.3s;
        }
        
        .module-nav-item:hover::after,
        .module-nav-item.active::after {
            width: 100%;
        }
        
        .module-nav-item.active {
            font-weight: 600;
        }
        
        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 10;
            min-width: 220px;
            margin-top: 0.5rem;
        }
        
        .dropdown:hover .dropdown-menu {
            display: block;
        }
        
        /* Module-specific colors */
        .module-skomptab {
            --primary-module-color: var(--skomptab-color);
        }
        
        .module-logson {
            --primary-module-color: var(--logson-color);
        }
        
        .module-socix {
            --primary-module-color: var(--socix-color);
        }
        
        .module-markos {
            --primary-module-color: var(--markos-color);
        }
        
        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 600;
            background-color: var(--danger-color);
            color: white;
        }
        
        /* Menu déroulant du sidebar */
        .sidebar-category {
            margin-bottom: 0.5rem;
        }
        
        .sidebar-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }
        
        .sidebar-category-header:hover {
            background-color: var(--hover-color);
        }
        
        .sidebar-category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .sidebar-category.open .sidebar-category-content {
            max-height: 500px;
            transition: max-height 0.5s ease-in;
        }
        
        .sidebar-category.open .sidebar-category-header .dropdown-icon {
            transform: rotate(180deg);
        }
        
        .dropdown-icon {
            transition: transform 0.3s;
        }
        
        /* Login Screen */
        .login-container {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .login-form {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 420px;
            padding: 2rem;
        }
        
        .login-logo {
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .login-title {
            color: #4f46e5;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .login-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }
        
        .login-button {
            width: 100%;
            padding: 0.75rem;
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .login-button:hover {
            background-color: #4338ca;
        }
        
        /* Company Selection */
        .company-card {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .company-card:hover {
            border-color: #4f46e5;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .company-card.selected {
            border-color: #4f46e5;
            background-color: rgba(79, 70, 229, 0.1);
        }
        
        /* Dashboard Cards */
        .dashboard-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .card-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        
        .activity-log {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .activity-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .disabled-row {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .highlight-row {
            background-color: rgba(93, 92, 222, 0.1);
        }
        
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #company-selection-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9998;
            background-color: #f3f4f6;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        /* Fiscal Calendar */
        .fiscal-calendar {
            height: 300px;
            font-size: 0.85rem;
        }
        
        .fc-event {
            cursor: pointer;
        }
        
        /* Analytical Accounting */
        .analytical-section {
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        
        .analytical-header {
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            font-weight: 600;
        }
        
        .analytical-content {
            padding: 1rem;
        }
        
        /* Print Styles */
        .print-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .print-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .print-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 0.25rem;
        }
        
        .print-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #777;
            margin-top: 1rem;
        }
        
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(93, 92, 222, 0.05);
        }
        
        .document-preview {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        /* Document digitalization */
        .document-form {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .digitalized-document {
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        .digitalized-header {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background-color: var(--hover-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        .digitalized-body {
            padding: 1rem;
        }
        
        /* Treasury Control */
        .treasury-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .treasury-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #f0f0f0;
            margin-bottom: 0.5rem;
        }
        
        .treasury-title {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .treasury-amount {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .treasury-amount.positive {
            color: var(--success-color);
        }
        
        .treasury-amount.negative {
            color: var(--danger-color);
        }
        
        /* Financial statements */
        .financial-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .financial-table th, .financial-table td {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
        }
        
        .financial-table th {
            background-color: var(--hover-color);
            font-weight: 600;
            text-align: left;
        }
        
        .financial-table tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        .financial-table .total-row {
            font-weight: 700;
            background-color: rgba(93, 92, 222, 0.05);
        }
        
        .financial-table .subtotal-row {
            font-weight: 600;
            background-color: rgba(93, 92, 222, 0.02);
        }
        
        /* Tax declaration */
        .tax-form {
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .tax-form-header {
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tax-amount {
            font-weight: 700;
        }
        
        .tax-amount.credit {
            color: var(--success-color);
        }
        
        .tax-amount.debit {
            color: var(--danger-color);
        }
    </style>
</head>
<body class="bg-[var(--bg-color)] text-[var(--text-color)]">
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-form">
            <div class="login-logo">
                <h1 class="text-3xl font-bold text-indigo-600">UNIKORP</h1>
                <p class="text-gray-500">Système ERP Intégré</p>
            </div>
            <h2 class="login-title">Connexion</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="identifier">
                        Identifiant
                    </label>
                    <input id="identifier" type="text" class="login-input" placeholder="Votre identifiant" value="admin" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="password">
                        Mot de passe
                    </label>
                    <input id="password" type="password" class="login-input" placeholder="Votre mot de passe" value="password" required>
                    <p id="login-error" class="text-red-500 text-xs italic mt-1 hidden">Identifiant ou mot de passe incorrect</p>
                </div>
                <button type="submit" class="login-button">
                    Se connecter
                </button>
            </form>
        </div>
    </div>
    
    <!-- Company Selection Screen -->
    <div id="company-selection-screen">
        <div class="login-form" style="max-width: 600px;">
            <div class="login-logo">
                <h1 class="text-3xl font-bold text-indigo-600">UNIKORP</h1>
                <p class="text-gray-500">Sélection du dossier</p>
            </div>
            <h2 class="login-title">Sélectionnez un dossier comptable</h2>
            <div class="mb-6">
                <div class="company-card selected" data-company="societeX">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold text-gray-800">AUTO - SociétéX</h3>
                            <p class="text-sm text-gray-500">SARL - Technologie</p>
                        </div>
                        <div class="h-6 w-6 flex items-center justify-center rounded-full bg-green-100">
                            <i class="fas fa-check text-sm text-green-600"></i>
                        </div>
                    </div>
                </div>
                <div class="company-card" data-company="societeY">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold text-gray-800">AUTO - SociétéY</h3>
                            <p class="text-sm text-gray-500">SA - Commerce</p>
                        </div>
                        <div class="h-6 w-6 flex items-center justify-center rounded-full bg-gray-100 company-check invisible">
                            <i class="fas fa-check text-sm text-green-600"></i>
                        </div>
                    </div>
                </div>
                <div class="company-card" data-company="societeZ">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold text-gray-800">AUTO - SociétéZ</h3>
                            <p class="text-sm text-gray-500">SAS - Services</p>
                        </div>
                        <div class="h-6 w-6 flex items-center justify-center rounded-full bg-gray-100 company-check invisible">
                            <i class="fas fa-check text-sm text-green-600"></i>
                        </div>
                    </div>
                </div>
            </div>
            <button id="confirm-company-selection" class="login-button">
                Confirmer
            </button>
        </div>
    </div>

    <div id="main-app" class="min-h-screen flex flex-col" style="display: none;">
        <!-- Primary Header - UNIKORP -->
        <header class="bg-gray-900 text-white">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between py-3">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold">UNIKORP</h1>
                        <span id="company-name-display" class="ml-4 hidden md:inline text-sm bg-white bg-opacity-20 px-3 py-1 rounded-full">AUTO - SociétéX</span>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button class="p-2 rounded-full hover:bg-white hover:bg-opacity-10 relative">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge">3</span>
                            </button>
                        </div>
                        <div class="relative dropdown">
                            <button class="flex items-center space-x-2 p-2 rounded hover:bg-white hover:bg-opacity-10">
                                <i class="fas fa-user-circle text-xl"></i>
                                <span class="hidden md:inline">Admin</span>
                                <i class="fas fa-chevron-down text-xs ml-1"></i>
                            </button>
                            <div class="dropdown-menu bg-white dark:bg-gray-800 shadow-lg rounded-md py-2 text-gray-800 dark:text-white">
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="fas fa-user mr-2"></i> Mon profil
                                </a>
                                <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="fas fa-cog mr-2"></i> Paramètres
                                </a>
                                <hr class="my-1 border-gray-200 dark:border-gray-700">
                                <a href="#" id="logout-link" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-red-600 dark:text-red-400">
                                    <i class="fas fa-sign-out-alt mr-2"></i> Déconnexion
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Secondary Header - Module Navigation -->
        <nav class="bg-[var(--primary-color)] text-white shadow-md">
            <div class="container mx-auto px-4">
                <div class="flex justify-between">
                    <div class="flex">
                        <a href="#" id="tableau-bord-btn" class="module-nav-item">
                            <i class="fas fa-tachometer-alt mr-2"></i> Tableau de bord
                        </a>
                        <a href="#" class="module-nav-item active" data-module="skomptab">
                            <i class="fas fa-calculator mr-2"></i> SKOMPTAB
                        </a>
                        <a href="#" class="module-nav-item" data-module="logson">
                            <i class="fas fa-truck mr-2"></i> LOGSON
                        </a>
                        <a href="#" class="module-nav-item" data-module="socix">
                            <i class="fas fa-users mr-2"></i> SOCIX
                        </a>
                        <a href="#" class="module-nav-item" data-module="markos">
                            <i class="fas fa-bullhorn mr-2"></i> MARKOS
                        </a>

                    
                    <button id="mobile-menu-button" class="md:hidden p-3">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Module Description Bar -->
        <div class="bg-gray-100 dark:bg-gray-800 border-b border-[var(--border-color)]">
            <div class="container mx-auto px-4 py-2">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="font-medium">Comptabilité générale et analytique</h2>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Module de gestion financière</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="text-gray-600 dark:text-gray-400 hover:text-[var(--primary-color)] dark:hover:text-[var(--primary-color)]">
                            <i class="fas fa-question-circle"></i>
                        </button>
                        <button class="text-gray-600 dark:text-gray-400 hover:text-[var(--primary-color)] dark:hover:text-[var(--primary-color)]">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flex flex-1">
            <!-- Sidebar avec menus déroulants -->
            <aside id="sidebar" class="hidden md:block w-64 bg-[var(--bg-color)] border-r border-[var(--border-color)] overflow-y-auto">
                <div class="p-4">
                    <!-- Section Création -->
                    <div class="sidebar-category open">
                        <div class="sidebar-category-header">
                            <h2 class="text-sm font-semibold uppercase text-gray-500">Création</h2>
                            <i class="fas fa-chevron-down text-xs text-gray-500 dropdown-icon"></i>
                        </div>
                        <div class="sidebar-category-content pl-2">
                            <div class="space-y-1 mt-2">
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="codes-journaux">
                                    <i class="fas fa-book-open w-6"></i>
                                    <span>Codes journaux</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="comptes-tiers">
                                    <i class="fas fa-users w-6"></i>
                                    <span>Comptes tiers</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="comptes-generaux">
                                    <i class="fas fa-list-ol w-6"></i>
                                    <span>Comptes généraux</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="modeles-saisie">
                                    <i class="fas fa-clipboard-list w-6"></i>
                                    <span>Modèles de saisie</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="modeles-declaration">
                                    <i class="fas fa-file-invoice w-6"></i>
                                    <span>Modèles de déclaration</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section Gestion -->
                    <div class="sidebar-category">
                        <div class="sidebar-category-header">
                            <h2 class="text-sm font-semibold uppercase text-gray-500">Gestion</h2>
                            <i class="fas fa-chevron-down text-xs text-gray-500 dropdown-icon"></i>
                        </div>
                        <div class="sidebar-category-content pl-2">
                            <div class="space-y-1 mt-2">
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="saisie-ecritures">
                                    <i class="fas fa-edit w-6"></i>
                                    <span>Saisie des écritures</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="digitalisation-factures">
                                    <i class="fas fa-file-invoice w-6"></i>
                                    <span>Digitalisation des factures</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="controle-tresorerie">
                                    <i class="fas fa-chart-line w-6"></i>
                                    <span>Contrôle de trésorerie</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section Finance -->
                    <div class="sidebar-category">
                        <div class="sidebar-category-header">
                            <h2 class="text-sm font-semibold uppercase text-gray-500">Finance</h2>
                            <i class="fas fa-chevron-down text-xs text-gray-500 dropdown-icon"></i>
                        </div>
                        <div class="sidebar-category-content pl-2">
                            <div class="space-y-1 mt-2">
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="sig">
                                    <i class="fas fa-chart-bar w-6"></i>
                                    <span>Tableau des SIG</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="bilan">
                                    <i class="fas fa-balance-scale w-6"></i>
                                    <span>Bilan</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="compte-resultat">
                                    <i class="fas fa-calculator w-6"></i>
                                    <span>Compte de résultat</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="flux-tresorerie">
                                    <i class="fas fa-money-bill-wave w-6"></i>
                                    <span>Tableau des flux de trésorerie</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section États comptables -->
                    <div class="sidebar-category">
                        <div class="sidebar-category-header">
                            <h2 class="text-sm font-semibold uppercase text-gray-500">États comptables</h2>
                            <i class="fas fa-chevron-down text-xs text-gray-500 dropdown-icon"></i>
                        </div>
                        <div class="sidebar-category-content pl-2">
                            <div class="space-y-1 mt-2">
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="journaux">
                                    <i class="fas fa-journal-whills w-6"></i>
                                    <span>Journaux</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="grand-livre-general">
                                    <i class="fas fa-book w-6"></i>
                                    <span>Grand livre Général</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="grand-livre-tiers">
                                    <i class="fas fa-address-book w-6"></i>
                                    <span>Grand livre tiers</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="balance-generale">
                                    <i class="fas fa-balance-scale-right w-6"></i>
                                    <span>Balance Générale</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="balance-agee">
                                    <i class="fas fa-hourglass-half w-6"></i>
                                    <span>Balance Agée (Tiers)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section Comptabilité Analytique -->
                    <div class="sidebar-category">
                        <div class="sidebar-category-header">
                            <h2 class="text-sm font-semibold uppercase text-gray-500">Compta. Analytique</h2>
                            <i class="fas fa-chevron-down text-xs text-gray-500 dropdown-icon"></i>
                        </div>
                        <div class="sidebar-category-content pl-2">
                            <div class="space-y-1 mt-2">
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="plan-comptable-analytique">
                                    <i class="fas fa-project-diagram w-6"></i>
                                    <span>Plan comptable analytique</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="sections-analytiques">
                                    <i class="fas fa-th-large w-6"></i>
                                    <span>Sections analytiques</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="ventilation-analytique">
                                    <i class="fas fa-random w-6"></i>
                                    <span>Ventilation analytique</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="tableaux-bord-analytique">
                                    <i class="fas fa-chart-pie w-6"></i>
                                    <span>Tableaux de bord</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section Fiscalité -->
                    <div class="sidebar-category">
                        <div class="sidebar-category-header">
                            <h2 class="text-sm font-semibold uppercase text-gray-500">Fiscalité</h2>
                            <i class="fas fa-chevron-down text-xs text-gray-500 dropdown-icon"></i>
                        </div>
                        <div class="sidebar-category-content pl-2">
                            <div class="space-y-1 mt-2">
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="declarations-tva">
                                    <i class="fas fa-receipt w-6"></i>
                                    <span>Déclarations TVA</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="declarations-fiscales">
                                    <i class="fas fa-file-invoice-dollar w-6"></i>
                                    <span>Déclarations fiscales</span>
                                </div>
                                <div class="sidebar-item p-2 rounded cursor-pointer flex items-center" data-target="suivi-fiscal">
                                    <i class="fas fa-calendar-check w-6"></i>
                                    <span>Suivi fiscal</span>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
            
            <!-- Mobile sidebar overlay -->
            <div id="mobile-sidebar-overlay" class="md:hidden fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
            
            <!-- Main content -->
            <main class="flex-1 p-4 overflow-x-hidden">
                <!-- Tableau de bord -->
                <div id="tableau-bord" class="tab-content active">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Tableau de Bord</h1>
                        <p class="text-gray-500">Vue d'ensemble de la performance financière</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- KPI 1: Chiffre d'Affaires -->
                        <div class="dashboard-card dark:bg-gray-800">
                            <div class="card-icon bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300">
                                <i class="fas fa-chart-line text-lg"></i>
                            </div>
                            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Chiffre d'Affaires</h3>
                            <p id="kpi-ca" class="text-2xl font-bold mt-1">0 FCFA</p>
                            <div class="flex items-center mt-2">
                                <span id="kpi-ca-trend" class="text-gray-500 text-sm flex items-center">
                                    <i class="fas fa-minus mr-1"></i> 0%
                                </span>
                                <span class="text-gray-400 text-xs ml-2">vs période précédente</span>
                            </div>
                        </div>
                        
                        <!-- KPI 2: Dépenses -->
                        <div class="dashboard-card dark:bg-gray-800">
                            <div class="card-icon bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-300">
                                <i class="fas fa-file-invoice-dollar text-lg"></i>
                            </div>
                            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Dépenses</h3>
                            <p id="kpi-depenses" class="text-2xl font-bold mt-1">0 FCFA</p>
                            <div class="flex items-center mt-2">
                                <span id="kpi-depenses-trend" class="text-gray-500 text-sm flex items-center">
                                    <i class="fas fa-minus mr-1"></i> 0%
                                </span>
                                <span class="text-gray-400 text-xs ml-2">vs période précédente</span>
                            </div>
                        </div>
                        
                        <!-- KPI 3: Bénéfice -->
                        <div class="dashboard-card dark:bg-gray-800">
                            <div class="card-icon bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-300">
                                <i class="fas fa-coins text-lg"></i>
                            </div>
                            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Bénéfice</h3>
                            <p id="kpi-benefice" class="text-2xl font-bold mt-1">0 FCFA</p>
                            <div class="flex items-center mt-2">
                                <span id="kpi-benefice-trend" class="text-gray-500 text-sm flex items-center">
                                    <i class="fas fa-minus mr-1"></i> 0%
                                </span>
                                <span class="text-gray-400 text-xs ml-2">vs période précédente</span>
                            </div>
                        </div>
                        
                        <!-- KPI 4: Marge Bénéficiaire -->
                        <div class="dashboard-card dark:bg-gray-800">
                            <div class="card-icon bg-purple-100 text-purple-600 dark:bg-purple-900 dark:text-purple-300">
                                <i class="fas fa-percentage text-lg"></i>
                            </div>
                            <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium">Marge Bénéficiaire</h3>
                            <p id="kpi-marge" class="text-2xl font-bold mt-1">0%</p>
                            <div class="flex items-center mt-2">
                                <span id="kpi-marge-trend" class="text-gray-500 text-sm flex items-center">
                                    <i class="fas fa-minus mr-1"></i> 0%
                                </span>
                                <span class="text-gray-400 text-xs ml-2">vs période précédente</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Chart 1: Évolution du Chiffre d'Affaires -->
                        <div class="dashboard-card dark:bg-gray-800">
                            <h3 class="text-lg font-semibold mb-4">Évolution du Chiffre d'Affaires</h3>
                            <div class="h-64">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Chart 2: Évolution des Dépenses -->
                        <div class="dashboard-card dark:bg-gray-800">
                            <h3 class="text-lg font-semibold mb-4">Évolution des Dépenses</h3>
                            <div class="h-64">
                                <canvas id="expensesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Calendar Fiscal -->
                        <div class="dashboard-card dark:bg-gray-800">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">Calendrier fiscal</h3>
                            </div>
                            <div class="fiscal-calendar" id="fiscal-calendar"></div>
                        </div>
                        
                        <!-- Historique des Actions -->
                        <div class="dashboard-card dark:bg-gray-800 col-span-2">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">Historique des Actions</h3>
                                <a href="#" class="text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">Voir tout</a>
                            </div>
                            <div class="activity-log" id="activity-log">
                                <!-- Les activités seront ajoutées dynamiquement ici -->
                                <div class="flex justify-center items-center py-4 text-gray-500 dark:text-gray-400">
                                    <p>Aucune activité récente</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Comptes généraux -->
                <div id="comptes-generaux" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Gestion des Comptes Généraux</h1>
                        <p class="text-gray-500">Créez et gérez les comptes du plan comptable de votre entreprise</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="creer-compte-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Créer un Compte
                        </button>
                        <button id="import-plan-comptable-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                        <button id="export-plan-comptable-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                        <button id="print-charges-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-print"></i> Imprimer Charges
                        </button>
                        <button id="print-produits-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-print"></i> Imprimer Produits
                        </button>
                        <button id="print-autres-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-print"></i> Imprimer Autres
                        </button>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">Liste des comptes</h2>
                            <div class="relative">
                                <input type="text" id="search-comptes" placeholder="Rechercher un compte..." class="border border-[var(--border-color)] rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-[var(--border-color)]">
                                <thead class="bg-[var(--hover-color)]">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Numéro de Compte</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="comptes-generaux-table" class="divide-y divide-[var(--border-color)]">
                                    <!-- Les données des comptes seront ajoutées dynamiquement ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="px-6 py-4 flex items-center justify-between">
                            <div class="text-sm text-gray-700 dark:text-gray-300">
                                Affichage <span id="comptes-start" class="font-medium">0</span> à <span id="comptes-end" class="font-medium">0</span> sur <span id="comptes-total" class="font-medium">0</span> comptes
                            </div>
                            <div class="flex space-x-2">
                                <button id="comptes-prev" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-3 py-1 bg-[var(--primary-color)] text-white rounded">1</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">2</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">3</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">...</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">25</button>
                                <button id="comptes-next" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Comptes tiers -->
                <div id="comptes-tiers" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Gestion des Comptes Tiers</h1>
                        <p class="text-gray-500">Créez et gérez les comptes clients, fournisseurs et autres tiers</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="creer-tiers-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Créer un Tiers
                        </button>
                        <button id="import-tiers-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                        <button id="export-tiers-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                        <button id="print-clients-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-print"></i> Imprimer Clients
                        </button>
                        <button id="print-fournisseurs-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-print"></i> Imprimer Fournisseurs
                        </button>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">Liste des tiers</h2>
                            <div class="relative">
                                <input type="text" id="search-tiers" placeholder="Rechercher un tiers..." class="border border-[var(--border-color)] rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-[var(--border-color)]">
                                <thead class="bg-[var(--hover-color)]">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nom/Raison Sociale</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Compte Collectif</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="comptes-tiers-table" class="divide-y divide-[var(--border-color)]">
                                    <!-- Les données des tiers seront ajoutées dynamiquement ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="px-6 py-4 flex items-center justify-between">
                            <div class="text-sm text-gray-700 dark:text-gray-300">
                                Affichage <span id="tiers-start" class="font-medium">0</span> à <span id="tiers-end" class="font-medium">0</span> sur <span id="tiers-total" class="font-medium">0</span> tiers
                            </div>
                            <div class="flex space-x-2">
                                <button id="tiers-prev" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-3 py-1 bg-[var(--primary-color)] text-white rounded">1</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">2</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">3</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">...</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">10</button>
                                <button id="tiers-next" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Codes journaux -->
                <div id="codes-journaux" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Gestion des Codes Journaux</h1>
                        <p class="text-gray-500">Créez et gérez les journaux comptables</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="ajouter-journal-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Ajouter Journal
                        </button>
                        <button id="import-journaux-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                        <button id="export-journaux-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                        <button id="print-journaux-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-print"></i> Imprimer en PDF
                        </button>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">Liste des journaux</h2>
                            <div class="relative">
                                <input type="text" id="search-journaux" placeholder="Rechercher un journal..." class="border border-[var(--border-color)] rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-[var(--border-color)]">
                                <thead class="bg-[var(--hover-color)]">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nom</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Devise</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Compte Associé</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="journaux-table" class="divide-y divide-[var(--border-color)]">
                                    <!-- Les données des journaux seront ajoutées dynamiquement ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="px-6 py-4 flex items-center justify-between">
                            <div class="text-sm text-gray-700 dark:text-gray-300">
                                Affichage <span id="journaux-start" class="font-medium">0</span> à <span id="journaux-end" class="font-medium">0</span> sur <span id="journaux-total" class="font-medium">0</span> journaux
                            </div>
                            <div class="flex space-x-2">
                                <button id="journaux-prev" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-3 py-1 bg-[var(--primary-color)] text-white rounded">1</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">2</button>
                                <button id="journaux-next" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modèles de saisie -->
                <div id="modeles-saisie" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Modèles de saisie</h1>
                        <p class="text-gray-500">Créez et gérez des modèles d'écritures comptables pour une saisie simplifiée</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="creer-modele-saisie-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Créer un modèle
                        </button>
                        <button id="import-modeles-saisie-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                        <button id="export-modeles-saisie-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">Liste des modèles</h2>
                            <div class="relative">
                                <input type="text" id="search-modeles-saisie" placeholder="Rechercher un modèle..." class="border border-[var(--border-color)] rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-[var(--border-color)]">
                                <thead class="bg-[var(--hover-color)]">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Journal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nb. Lignes</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dernière utilisation</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="modeles-saisie-table" class="divide-y divide-[var(--border-color)]">
                                    <!-- Les modèles de saisie seront ajoutés dynamiquement ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="px-6 py-4 flex items-center justify-between">
                            <div class="text-sm text-gray-700 dark:text-gray-300">
                                Affichage <span id="modeles-saisie-start" class="font-medium">0</span> à <span id="modeles-saisie-end" class="font-medium">0</span> sur <span id="modeles-saisie-total" class="font-medium">0</span> modèles
                            </div>
                            <div class="flex space-x-2">
                                <button id="modeles-saisie-prev" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-3 py-1 bg-[var(--primary-color)] text-white rounded">1</button>
                                <button id="modeles-saisie-next" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modèles de déclaration -->
                <div id="modeles-declaration" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Modèles de déclaration</h1>
                        <p class="text-gray-500">Créez et gérez des modèles pour vos déclarations fiscales et sociales</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="creer-modele-declaration-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Créer un modèle
                        </button>
                        <button id="import-modeles-declaration-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-import"></i> Importer
                        </button>
                        <button id="export-modeles-declaration-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-export"></i> Exporter
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Modèles fiscaux -->
                        <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm">
                            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                                <h2 class="text-lg font-semibold">Modèles fiscaux</h2>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--hover-color)]">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Périodicité</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modeles-fiscaux-table" class="divide-y divide-[var(--border-color)]">
                                        <!-- Les modèles fiscaux seront ajoutés dynamiquement ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Modèles sociaux -->
                        <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm">
                            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                                <h2 class="text-lg font-semibold">Modèles sociaux</h2>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--hover-color)]">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Périodicité</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modeles-sociaux-table" class="divide-y divide-[var(--border-color)]">
                                        <!-- Les modèles sociaux seront ajoutés dynamiquement ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Saisie des écritures -->
                <div id="saisie-ecritures" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Saisie des écritures comptables</h1>
                        <p class="text-gray-500">Créez, modifiez et consultez vos écritures comptables</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="nouvelle-ecriture-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Nouvelle écriture
                        </button>
                        <button id="importer-ecritures-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-import"></i> Importer XLSX
                        </button>
                        <button id="ecritures-erronees-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2 text-amber-600 dark:text-amber-400">
                            <i class="fas fa-exclamation-triangle"></i> Écritures erronées
                        </button>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">Liste des opérations</h2>
                            <div class="relative">
                                <input type="text" id="search-ecritures" placeholder="Rechercher..." class="border border-[var(--border-color)] rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-[var(--border-color)]">
                                <thead class="bg-[var(--hover-color)]">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N°</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date de saisie</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date de l'opération</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Journal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° de saisie</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Référence</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ecritures-table" class="divide-y divide-[var(--border-color)]">
                                    <!-- Les données des écritures seront ajoutées dynamiquement ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="px-6 py-4 flex items-center justify-between">
                            <div class="text-sm text-gray-700 dark:text-gray-300">
                                Affichage <span id="ecritures-start" class="font-medium">0</span> à <span id="ecritures-end" class="font-medium">0</span> sur <span id="ecritures-total" class="font-medium">0</span> écritures
                            </div>
                            <div class="flex space-x-2">
                                <button id="ecritures-prev" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-3 py-1 bg-[var(--primary-color)] text-white rounded">1</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">2</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">3</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">...</button>
                                <button class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]">0</button>
                                <button id="ecritures-next" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)]" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Digitalisation des factures -->
                <div id="digitalisation-factures" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Digitalisation des factures</h1>
                        <p class="text-gray-500">Importez et numérisez vos factures pour une gestion dématérialisée</p>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <button id="ajouter-facture-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Ajouter une facture
                        </button>
                        <button id="scanner-facture-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-file-upload"></i> Importer un fichier
                        </button>
                        <button id="lier-ecriture-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-link"></i> Lier à une écriture
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <!-- Liste des factures -->
                        <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm col-span-1">
                            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                                <h2 class="text-lg font-semibold">Factures numérisées</h2>
                                <div class="relative">
                                    <input type="text" id="search-factures" placeholder="Rechercher..." class="border border-[var(--border-color)] rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div id="factures-list" class="h-[600px] overflow-y-auto">
                                <!-- Liste des factures affichées ici -->
                                <div class="p-4 text-center text-gray-500 dark:text-gray-400">
                                    Aucune facture numérisée
                                </div>
                            </div>
                        </div>
                        
                        <!-- Aperçu de la facture -->
                        <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm col-span-2">
                            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                                <h2 class="text-lg font-semibold">Aperçu de la facture</h2>
                                <div class="flex space-x-2">
                                    <button id="edit-facture-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-3 py-1 rounded flex items-center gap-1" disabled>
                                        <i class="fas fa-edit"></i> Modifier
                                    </button>
                                    <button id="export-facture-btn" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-3 py-1 rounded flex items-center gap-1" disabled>
                                        <i class="fas fa-download"></i> Exporter
                                    </button>
                                </div>
                            </div>
                            
                            <div id="facture-preview" class="h-[600px] flex flex-col">
                                <div class="flex-1 overflow-auto p-4">
                                    <div class="flex justify-center items-center h-full text-gray-500 dark:text-gray-400">
                                        <div class="text-center">
                                            <i class="fas fa-file-invoice text-6xl mb-4 opacity-25"></i>
                                            <p>Sélectionnez une facture pour l'afficher</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Contrôle de trésorerie -->
                <div id="controle-tresorerie" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Contrôle de Trésorerie</h1>
                        <p class="text-gray-500">Suivez et analysez les mouvements de trésorerie de votre entreprise</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                        <!-- Solde global -->
                        <div class="treasury-card dark:bg-gray-800">
                            <div class="treasury-header">
                                <span class="treasury-title">Solde global</span>
                                <i class="fas fa-wallet text-gray-500"></i>
                            </div>
                            <p id="solde-global" class="treasury-amount mt-2">0 FCFA</p>
                        </div>
                        
                        <!-- Encaissements -->
                        <div class="treasury-card dark:bg-gray-800">
                            <div class="treasury-header">
                                <span class="treasury-title">Encaissements du mois</span>
                                <i class="fas fa-arrow-down text-green-600"></i>
                            </div>
                            <p id="encaissements" class="treasury-amount positive mt-2">0 FCFA</p>
                        </div>
                        
                        <!-- Décaissements -->
                        <div class="treasury-card dark:bg-gray-800">
                            <div class="treasury-header">
                                <span class="treasury-title">Décaissements du mois</span>
                                <i class="fas fa-arrow-up text-red-600"></i>
                            </div>
                            <p id="decaissements" class="treasury-amount negative mt-2">0 FCFA</p>
                        </div>
                        
                        <!-- Prévisionnel -->
                        <div class="treasury-card dark:bg-gray-800">
                            <div class="treasury-header">
                                <span class="treasury-title">Solde prévisionnel</span>
                                <i class="fas fa-chart-line text-blue-600"></i>
                            </div>
                            <p id="solde-previsionnel" class="treasury-amount mt-2">0 FCFA</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Évolution de la trésorerie -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                            <h3 class="font-semibold text-lg mb-4">Évolution de la trésorerie</h3>
                            <div class="h-64">
                                <canvas id="treasuryChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Répartition des comptes -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4">
                            <h3 class="font-semibold text-lg mb-4">Répartition par compte</h3>
                            <div class="h-64">
                                <canvas id="accountDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">État des comptes de trésorerie</h2>
                            <div class="flex items-center space-x-2">
                                <div class="relative">
                                    <input type="date" id="treasury-date" class="border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                </div>
                                <button id="refresh-treasury" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-3 py-2 rounded">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-[var(--border-color)]">
                                <thead class="bg-[var(--hover-color)]">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Compte</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solde initial</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Encaissements</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Décaissements</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solde actuel</th>
                                    </tr>
                                </thead>
                                <tbody id="treasury-accounts-table" class="divide-y divide-[var(--border-color)]">
                                    <!-- Les données des comptes de trésorerie seront ajoutées dynamiquement ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">Prévisions de trésorerie</h2>
                            <div class="flex items-center space-x-2">
                                <select id="treasury-period" class="border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    <option value="7">7 jours</option>
                                    <option value="15">15 jours</option>
                                    <option value="30" selected>30 jours</option>
                                    <option value="60">60 jours</option>
                                    <option value="90">90 jours</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-[var(--border-color)]">
                                <thead class="bg-[var(--hover-color)]">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                    </tr>
                                </thead>
                                <tbody id="treasury-forecasts-table" class="divide-y divide-[var(--border-color)]">
                                    <!-- Les prévisions de trésorerie seront ajoutées dynamiquement ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Grand Livre Général -->
                <div id="grand-livre-general" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Consultation du Grand Livre Général</h1>
                        <p class="text-gray-500">Consultez le détail des mouvements par compte sur une période définie</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="grand-livre-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Sélection des comptes :</label>
                                    <select id="grand-livre-compte" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="">-- Sélectionnez un compte --</option>
                                        <!-- Les options de compte seront ajoutées dynamiquement ici -->
                                    </select>
                                    <div class="mt-2 p-3 bg-gray-100 dark:bg-gray-800 rounded-md">
                                        <p class="text-sm" id="compte-selection-info">Aucun compte sélectionné</p>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de début :</label>
                                            <input type="date" id="grand-livre-date-debut" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de fin :</label>
                                            <input type="date" id="grand-livre-date-fin" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-grand-livre" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-grand-livre" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold">Grand Livre Général</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-grand-livre" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-grand-livre" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-grand-livre" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="grand-livre-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">EXTRAIT GRAND LIVRE</h3>
                                <p id="grand-livre-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période du <span id="grand-livre-periode-debut" class="font-semibold">01/01/2024</span> au <span id="grand-livre-periode-fin" class="font-semibold">31/03/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="grand-livre-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h4 id="grand-livre-compte-title" class="text-lg font-semibold pb-2 border-b border-[var(--border-color)]">602100 - Matières premières</h4>
                                
                                <div class="overflow-x-auto mt-3">
                                    <table class="min-w-full divide-y divide-[var(--border-color)]">
                                        <thead class="bg-[var(--hover-color)]">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Pièce</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Journal</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solde progressif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="grand-livre-mouvements" class="divide-y divide-[var(--border-color)]">
                                            <!-- Les mouvements seront ajoutés dynamiquement ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Grand Livre Tiers -->
                <div id="grand-livre-tiers" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Consultation du Grand Livre Tiers</h1>
                        <p class="text-gray-500">Consultez le détail des mouvements par compte tiers sur une période définie</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="grand-livre-tiers-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Sélection du tiers :</label>
                                    <select id="grand-livre-tiers-compte" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="">-- Sélectionnez un tiers --</option>
                                        <!-- Les options de tiers seront ajoutées dynamiquement ici -->
                                    </select>
                                    <div class="mt-2 p-3 bg-gray-100 dark:bg-gray-800 rounded-md">
                                        <p class="text-sm" id="tiers-selection-info">Aucun tiers sélectionné</p>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de début :</label>
                                            <input type="date" id="grand-livre-tiers-date-debut" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de fin :</label>
                                            <input type="date" id="grand-livre-tiers-date-fin" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-grand-livre-tiers" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-grand-livre-tiers" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold">Grand Livre Tiers</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-grand-livre-tiers" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-grand-livre-tiers" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-grand-livre-tiers" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="grand-livre-tiers-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">EXTRAIT GRAND LIVRE TIERS</h3>
                                <p id="grand-livre-tiers-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période du <span id="grand-livre-tiers-periode-debut" class="font-semibold">01/01/2024</span> au <span id="grand-livre-tiers-periode-fin" class="font-semibold">31/03/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="grand-livre-tiers-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h4 id="grand-livre-tiers-title" class="text-lg font-semibold pb-2 border-b border-[var(--border-color)]">Tiers: [Code Tiers] - [Nom Tiers]</h4>
                                
                                <div class="overflow-x-auto mt-3">
                                    <table class="min-w-full divide-y divide-[var(--border-color)]">
                                        <thead class="bg-[var(--hover-color)]">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Pièce</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Journal</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Compte</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Référence</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solde progressif</th>
                                            </tr>
                                        </thead>
                                        <tbody id="grand-livre-tiers-mouvements" class="divide-y divide-[var(--border-color)]">
                                            <!-- Les mouvements seront ajoutés dynamiquement ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Balance Générale -->
                <div id="balance-generale" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Balance Générale</h1>
                        <p class="text-gray-500">Consultez les soldes de tous les comptes pour une période définie</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="balance-generale-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Options de la balance :</label>
                                    <div class="mt-2">
                                        <label class="flex items-center mb-2">
                                            <input type="checkbox" id="balance-comptes-mouvementes" class="mr-2">
                                            <span>Afficher uniquement les comptes mouvementés</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="balance-inclure-comptes-soldés" class="mr-2">
                                            <span>Inclure les comptes soldés</span>
                                        </label>
                                    </div>
                                    <div class="mt-4">
                                        <label class="block text-sm font-medium mb-2">Niveau de détail :</label>
                                        <select id="balance-niveau-detail" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <option value="tous">Tous les comptes</option>
                                            <option value="2">Comptes à 2 chiffres</option>
                                            <option value="3">Comptes à 3 chiffres</option>
                                            <option value="4">Comptes à 4 chiffres</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de début :</label>
                                            <input type="date" id="balance-date-debut" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de fin :</label>
                                            <input type="date" id="balance-date-fin" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-balance-generale" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-balance-generale" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold">Balance Générale</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-balance" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-balance" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-balance" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="balance-generale-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">BALANCE GÉNÉRALE</h3>
                                <p id="balance-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période du <span id="balance-periode-debut" class="font-semibold">01/01/2024</span> au <span id="balance-periode-fin" class="font-semibold">31/03/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="balance-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto mt-4">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--hover-color)]">
                                        <tr>
                                            <th rowspan="2" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">N° Compte</th>
                                            <th rowspan="2" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">Libellé</th>
                                            <th colspan="2" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Soldes Initiaux</th>
                                            <th colspan="2" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Mouvements de la période</th>
                                            <th colspan="2" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Soldes Finaux</th>
                                        </tr>
                                        <tr>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="balance-generale-mouvements" class="divide-y divide-[var(--border-color)]">
                                        <!-- Les mouvements seront ajoutés dynamiquement ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Balance Agée -->
                <div id="balance-agee" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Balance Agée (Tiers)</h1>
                        <p class="text-gray-500">Consultez les échéances clients et fournisseurs par ancienneté</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="balance-agee-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Type de balance :</label>
                                    <div class="flex space-x-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="balance-agee-type" value="clients" class="mr-2" checked>
                                            <span>Clients</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="balance-agee-type" value="fournisseurs" class="mr-2">
                                            <span>Fournisseurs</span>
                                        </label>
                                    </div>
                                    <div class="mt-4">
                                        <label class="block text-sm font-medium mb-2">Tiers (optionnel) :</label>
                                        <select id="balance-agee-tiers" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <option value="">Tous les tiers</option>
                                            <!-- Les options de tiers seront ajoutées dynamiquement ici -->
                                        </select>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Date de référence :</label>
                                    <input type="date" id="balance-agee-date" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    
                                    <div class="mt-4">
                                        <label class="block text-sm font-medium mb-2">Tranches d'âge (en jours) :</label>
                                        <div class="grid grid-cols-4 gap-2">
                                            <input type="number" id="age1" value="30" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <input type="number" id="age2" value="60" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <input type="number" id="age3" value="90" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <input type="number" id="age4" value="120" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-balance-agee" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-balance-agee" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold">Balance Agée</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-balance-agee" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-balance-agee" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-balance-agee" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="balance-agee-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">BALANCE AGÉE <span id="balance-agee-type-title">(CLIENTS)</span></h3>
                                <p id="balance-agee-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">À la date du <span id="balance-agee-date-ref" class="font-semibold">31/03/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="balance-agee-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto mt-4">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--hover-color)]">
                                        <tr>
                                            <th rowspan="2" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">Code Tiers</th>
                                            <th rowspan="2" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">Nom</th>
                                            <th rowspan="2" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">Solde</th>
                                            <th rowspan="2" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider align-middle">Non Échu</th>
                                            <th colspan="4" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Échu</th>
                                        </tr>
                                        <tr>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"><span id="age1-label">0-30 jours</span></th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"><span id="age2-label">31-60 jours</span></th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"><span id="age3-label">61-90 jours</span></th>
                                            <th class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"><span id="age4-label">+90 jours</span></th>
                                        </tr>
                                    </thead>
                                    <tbody id="balance-agee-mouvements" class="divide-y divide-[var(--border-color)]">
                                        <!-- Les mouvements seront ajoutés dynamiquement ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Journaux -->
                <div id="journaux" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Journaux Comptables</h1>
                        <p class="text-gray-500">Consultez le détail des mouvements par journal sur une période définie</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="journaux-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Sélection du journal :</label>
                                    <select id="selection-journal-consultation" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="">-- Sélectionnez un journal --</option>
                                        <option value="all">Tous les journaux</option>
                                        <!-- Les options de journal seront ajoutées dynamiquement ici -->
                                    </select>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de début :</label>
                                            <input type="date" id="journaux-date-debut" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de fin :</label>
                                            <input type="date" id="journaux-date-fin" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-journaux" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-journaux" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold">Journal Comptable</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-journaux" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-journaux" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-journaux" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="journaux-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">JOURNAL COMPTABLE</h3>
                                <p id="journaux-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période du <span id="journaux-periode-debut" class="font-semibold">01/01/2024</span> au <span id="journaux-periode-fin" class="font-semibold">31/03/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="journaux-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div id="journaux-content-wrapper">
                                <!-- Le contenu des journaux sera ajouté dynamiquement ici -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bilan -->
                <div id="bilan" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Bilan Comptable</h1>
                        <p class="text-gray-500">Consultez le bilan comptable, fonctionnel et financier</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="bilan-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Type de bilan :</label>
                                    <div class="flex space-x-4 mb-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="bilan-type" value="comptable" class="mr-2" checked>
                                            <span>Bilan Comptable</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="bilan-type" value="fonctionnel" class="mr-2">
                                            <span>Bilan Fonctionnel</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="bilan-type" value="financier" class="mr-2">
                                            <span>Bilan Financier</span>
                                        </label>
                                    </div>
                                    
                                    <label class="block text-sm font-medium mb-2">Format d'affichage :</label>
                                    <div class="flex space-x-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="bilan-format" value="standard" class="mr-2" checked>
                                            <span>Standard</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="bilan-format" value="complet" class="mr-2">
                                            <span>Complet</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de clôture :</label>
                                            <input type="date" id="bilan-date" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Exercice précédent :</label>
                                            <div class="flex items-center">
                                                <input type="checkbox" id="bilan-comparatif" class="mr-2">
                                                <span>Afficher les données comparatives</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-bilan" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-bilan" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold" id="bilan-resultat-titre">Bilan Comptable</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-bilan" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-bilan" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-bilan" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="bilan-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title" id="bilan-titre-impression">BILAN COMPTABLE</h3>
                                <p id="bilan-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Au <span id="bilan-date-cloture" class="font-semibold">31/12/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="bilan-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <!-- Contenu du bilan généré dynamiquement ici -->
                                <div id="bilan-data-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Compte de résultat -->
                <div id="compte-resultat" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Compte de Résultat</h1>
                        <p class="text-gray-500">Consultez le compte de résultat pour un exercice donné</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="resultat-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Présentation :</label>
                                    <div class="flex space-x-4 mb-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="resultat-presentation" value="nature" class="mr-2" checked>
                                            <span>Par nature</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="resultat-presentation" value="fonction" class="mr-2">
                                            <span>Par fonction</span>
                                        </label>
                                    </div>
                                    
                                    <label class="block text-sm font-medium mb-2">Niveau de détail :</label>
                                    <select id="resultat-niveau-detail" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="resume">Résumé</option>
                                        <option value="standard" selected>Standard</option>
                                        <option value="detaille">Détaillé</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de début :</label>
                                            <input type="date" id="resultat-date-debut" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de fin :</label>
                                            <input type="date" id="resultat-date-fin" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="resultat-comparatif" class="mr-2">
                                            <span>Afficher les données comparatives de l'exercice précédent</span>
                                        </label>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-resultat" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-compte" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold" id="resultat-titre">Compte de Résultat</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-resultat" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-resultat" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-resultat" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="resultat-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">COMPTE DE RÉSULTAT</h3>
                                <p id="resultat-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période du <span id="resultat-periode-debut" class="font-semibold">01/01/2024</span> au <span id="resultat-periode-fin" class="font-semibold">31/12/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="resultat-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <!-- Contenu du compte de résultat généré dynamiquement ici -->
                                <div id="resultat-data-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- SIG - Soldes Intermédiaires de Gestion -->
                <div id="sig" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Tableau des Soldes Intermédiaires de Gestion (SIG)</h1>
                        <p class="text-gray-500">Consultez les indicateurs clés de performance financière</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="sig-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Format d'affichage :</label>
                                    <div class="flex space-x-4 mb-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="sig-format" value="tableau" class="mr-2" checked>
                                            <span>Tableau</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="sig-format" value="graphique" class="mr-2">
                                            <span>Graphique</span>
                                        </label>
                                    </div>
                                    
                                    <label class="block text-sm font-medium mb-2">Options :</label>
                                    <div>
                                        <label class="flex items-center mb-2">
                                            <input type="checkbox" id="sig-pourcentage" class="mr-2" checked>
                                            <span>Afficher les pourcentages</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="sig-evolution" class="mr-2" checked>
                                            <span>Afficher l'évolution</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de début :</label>
                                            <input type="date" id="sig-date-debut" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de fin :</label>
                                            <input type="date" id="sig-date-fin" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="sig-comparatif" class="mr-2" checked>
                                            <span>Afficher les données comparatives de l'exercice précédent</span>
                                        </label>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-sig" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-sig" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold">Soldes Intermédiaires de Gestion</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-sig" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-sig" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-sig" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="sig-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">SOLDES INTERMÉDIAIRES DE GESTION</h3>
                                <p id="sig-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période du <span id="sig-periode-debut" class="font-semibold">01/01/2024</span> au <span id="sig-periode-fin" class="font-semibold">31/12/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="sig-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <!-- Contenu du tableau SIG généré dynamiquement ici -->
                                <div id="sig-data-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tableau des flux de trésorerie -->
                <div id="flux-tresorerie" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Tableau des Flux de Trésorerie</h1>
                        <p class="text-gray-500">Consultez les mouvements de trésorerie par activité</p>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)]">
                            <h2 class="text-lg font-semibold">Critères de sélection</h2>
                        </div>
                        
                        <div class="p-4">
                            <form id="flux-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Méthode de présentation :</label>
                                    <div class="flex space-x-4 mb-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="flux-methode" value="directe" class="mr-2" checked>
                                            <span>Directe</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="flux-methode" value="indirecte" class="mr-2">
                                            <span>Indirecte</span>
                                        </label>
                                    </div>
                                    
                                    <label class="block text-sm font-medium mb-2">Niveau de détail :</label>
                                    <select id="flux-niveau-detail" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="resume">Résumé</option>
                                        <option value="standard" selected>Standard</option>
                                        <option value="detaille">Détaillé</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de début :</label>
                                            <input type="date" id="flux-date-debut" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Date de fin :</label>
                                            <input type="date" id="flux-date-fin" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="flux-comparatif" class="mr-2" checked>
                                            <span>Afficher les données comparatives de l'exercice précédent</span>
                                        </label>
                                    </div>
                                    
                                    <div class="mt-6 flex justify-end space-x-3">
                                        <button type="button" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                                        <button type="button" id="valider-flux" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-flux" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold" id="flux-titre">Tableau des Flux de Trésorerie</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-flux" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-flux" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-flux" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="flux-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">TABLEAU DES FLUX DE TRÉSORERIE</h3>
                                <p id="flux-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période du <span id="flux-periode-debut" class="font-semibold">01/01/2024</span> au <span id="flux-periode-fin" class="font-semibold">31/12/2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="flux-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <!-- Contenu du tableau des flux généré dynamiquement ici -->
                                <div id="flux-data-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Déclarations TVA -->
                <div id="declarations-tva" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Déclarations de TVA</h1>
                        <p class="text-gray-500">Générez et consultez vos déclarations de TVA</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="tax-form col-span-1 dark:bg-gray-800">
                            <div class="tax-form-header">TVA collectée</div>
                            <div class="flex justify-between items-center mt-2">
                                <span>Total</span>
                                <span id="tva-collectee-total" class="tax-amount credit">0 FCFA</span>
                            </div>
                        </div>
                        <div class="tax-form col-span-1 dark:bg-gray-800">
                            <div class="tax-form-header">TVA déductible</div>
                            <div class="flex justify-between items-center mt-2">
                                <span>Total</span>
                                <span id="tva-deductible-total" class="tax-amount debit">0 FCFA</span>
                            </div>
                        </div>
                        <div class="tax-form col-span-1 dark:bg-gray-800">
                            <div class="tax-form-header">TVA à payer</div>
                            <div class="flex justify-between items-center mt-2">
                                <span>Montant</span>
                                <span id="tva-a-payer" class="tax-amount credit">0 FCFA</span>
                            </div>
                        </div>
                        <div class="tax-form col-span-1 dark:bg-gray-800">
                            <div class="tax-form-header">TVA à reporter</div>
                            <div class="flex justify-between items-center mt-2">
                                <span>Crédit</span>
                                <span id="tva-credit-reporter" class="tax-amount debit">0 FCFA</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm mb-6">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                            <h2 class="text-lg font-semibold">Paramètres de calcul</h2>
                            <button id="calculer-tva-btn" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded flex items-center gap-2">
                                <i class="fas fa-calculator"></i> Calculer la TVA
                            </button>
                        </div>
                        
                        <div class="p-4">
                            <form id="declaration-tva-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Période de déclaration :</label>
                                    <select id="tva-periode" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="mensuelle" selected>Mensuelle</option>
                                        <option value="trimestrielle">Trimestrielle</option>
                                        <option value="annuelle">Annuelle</option>
                                    </select>
                                    
                                    <div class="grid grid-cols-2 gap-4 mt-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Mois/Trimestre :</label>
                                            <select id="tva-mois" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                                <option value="1">Janvier</option>
                                                <option value="2">Février</option>
                                                <option value="3">Mars</option>
                                                <option value="4">Avril</option>
                                                <option value="5">Mai</option>
                                                <option value="6">Juin</option>
                                                <option value="7">Juillet</option>
                                                <option value="8">Août</option>
                                                <option value="9">Septembre</option>
                                                <option value="10" selected>Octobre</option>
                                                <option value="11">Novembre</option>
                                                <option value="12">Décembre</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Année :</label>
                                            <select id="tva-annee" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                                <option value="2023">2023</option>
                                                <option value="2024" selected>2024</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Options :</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="tva-inclure-credit" class="mr-2" checked>
                                            <span>Inclure crédit de TVA de la période précédente</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="tva-regrouper-comptes" class="mr-2">
                                            <span>Regrouper les comptes par taux de TVA</span>
                                        </label>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <label class="block text-sm font-medium mb-2">Modèle de déclaration :</label>
                                        <select id="tva-modele" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <option value="standard" selected>Modèle Standard</option>
                                            <option value="simplifie">Modèle Simplifié</option>
                                            <option value="complet">Modèle Complet</option>
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="resultat-tva" class="bg-[var(--bg-color)] border border-[var(--border-color)] rounded-lg overflow-hidden shadow-sm hidden">
                        <div class="p-4 border-b border-[var(--border-color)] flex justify-between">
                            <h2 class="text-lg font-semibold">Déclaration de TVA</h2>
                            <div class="flex space-x-2">
                                <button id="export-pdf-tva" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button id="export-excel-tva" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-file-excel"></i> Excel
                                </button>
                                <button id="print-tva" class="px-3 py-1 border border-[var(--border-color)] rounded hover:bg-[var(--hover-color)] flex items-center gap-1">
                                    <i class="fas fa-print"></i> Imprimer
                                </button>
                                <button id="valider-declaration-tva" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded flex items-center gap-1">
                                    <i class="fas fa-check"></i> Valider la déclaration
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-4" id="tva-content">
                            <div class="mb-4 text-center print-header">
                                <h3 class="text-xl font-bold print-title">DÉCLARATION DE TVA</h3>
                                <p id="tva-societe" class="print-subtitle">AUTO - SociétéX</p>
                                <p class="print-subtitle">Période : <span id="tva-periode-label" class="font-semibold">Octobre 2024</span></p>
                                <div class="print-info">
                                    <p class="text-sm text-gray-500" id="tva-date-impression">Date d'impression: 28/10/2024</p>
                                    <p class="text-sm text-gray-500">Édité par: Admin</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <!-- Contenu de la déclaration de TVA généré dynamiquement ici -->
                                <div id="tva-data-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Plan comptable analytique -->
                <div id="plan-comptable-analytique" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold mb-2">Plan Comptable Analytique</h1>
                        <p class="text-gray-500">Gérez vos axes et plans analytiques pour une analyse fine de votre activité</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <!-- Axes analytiques -->
                        <div class="analytical-section col-span-1 dark:bg-gray-800">
                            <div class="analytical-header">Axes analytiques</div>
                            <div class="analytical-content">
                                <div class="flex justify-between mb-4">
                                    <h3 class="font-medium">Liste des axes</h3>
                                    <button id="ajouter-axe-btn" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center gap-1">
                                        <i class="fas fa-plus-circle"></i> Ajouter
                                    </button>
                                </div>
                                
                                <div id="axes-list" class="space-y-2">
                                    <!-- Liste des axes analytiques ici -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sections analytiques -->
                        <div class="analytical-section col-span-2 dark:bg-gray-800">
                            <div class="analytical-header">Sections analytiques</div>
                            <div class="analytical-content">
                                <div class="flex justify-between mb-4">
                                    <h3 class="font-medium">Liste des sections</h3>
                                    <button id="ajouter-section-btn" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center gap-1">
                                        <i class="fas fa-plus-circle"></i> Ajouter
                                    </button>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-[var(--border-color)]">
                                        <thead class="bg-[var(--hover-color)]">
                                            <tr>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Axe</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parent</th>
                                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sections-analytiques-table" class="divide-y divide-[var(--border-color)]">
                                            <!-- Sections analytiques ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytical-section dark:bg-gray-800">
                        <div class="analytical-header flex justify-between items-center">
                            <h2 class="font-medium">Plan comptable analytique</h2>
                            <div class="flex space-x-2">
                                <button id="import-plan-analytique-btn" class="text-sm border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-3 py-1 rounded flex items-center gap-1">
                                    <i class="fas fa-file-import"></i> Importer
                                </button>
                                <button id="export-plan-analytique-btn" class="text-sm border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-3 py-1 rounded flex items-center gap-1">
                                    <i class="fas fa-file-export"></i> Exporter
                                </button>
                            </div>
                        </div>
                        <div class="analytical-content">
                            <div class="mb-4">
                                <div class="relative">
                                    <input type="text" id="search-plan-analytique" placeholder="Rechercher..." class="w-full border border-[var(--border-color)] rounded-md pl-9 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--hover-color)]">
                                        <tr>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Compte général</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ventilation</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Axe principal</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sections par défaut</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="plan-analytique-table" class="divide-y divide-[var(--border-color)]">
                                        <!-- Plan analytique ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sections analytiques -->
                <div id="sections-analytiques" class="tab-content">
                    <!-- Contenu pour la gestion des sections analytiques -->
                </div>
                
                <!-- Ventilation analytique -->
                <div id="ventilation-analytique" class="tab-content">
                    <!-- Contenu pour la ventilation analytique -->
                </div>
                
                <!-- Tableaux de bord analytique -->
                <div id="tableaux-bord-analytique" class="tab-content">
                    <!-- Contenu pour les tableaux de bord analytiques -->
                </div>
                
                <!-- Déclarations fiscales -->
                <div id="declarations-fiscales" class="tab-content">
                    <!-- Contenu pour les déclarations fiscales -->
                </div>
                
                <!-- Suivi fiscal -->
                <div id="suivi-fiscal" class="tab-content">
                    <!-- Contenu pour le suivi fiscal -->
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modal Créer un compte -->
    <div id="modal-creer-compte" class="modal">
        <div class="modal-content bg-[var(--bg-color)] max-w-lg mx-auto mt-20 rounded-lg shadow-xl">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h2 class="text-lg font-semibold">Créer un Nouveau Compte</h2>
                <button id="close-modal-creer-compte" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <form id="form-creer-compte">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Numéro de Compte :</label>
                        <input type="text" id="new-compte-numero" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Libellé :</label>
                        <input type="text" id="new-compte-libelle" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Type de Compte :</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="type-compte" value="charges" class="text-[var(--primary-color)]">
                                <span class="ml-2">Charges</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="type-compte" value="produits" class="text-[var(--primary-color)]">
                                <span class="ml-2">Produits</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="type-compte" value="autres" class="text-[var(--primary-color)]" checked>
                                <span class="ml-2">Autres</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="annuler-creer-compte" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                        <button type="submit" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Ajouter</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Créer un tiers -->
    <div id="modal-creer-tiers" class="modal">
        <div class="modal-content bg-[var(--bg-color)] max-w-lg mx-auto mt-20 rounded-lg shadow-xl">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h2 class="text-lg font-semibold">Créer un Nouveau Tiers</h2>
                <button id="close-modal-creer-tiers" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <form id="form-creer-tiers">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Code Tiers :</label>
                        <input type="text" id="new-tiers-code" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Nom/Raison Sociale :</label>
                        <input type="text" id="new-tiers-nom" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Type de Tiers :</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="type-tiers" value="client" class="text-[var(--primary-color)]" checked>
                                <span class="ml-2">Client</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="type-tiers" value="fournisseur" class="text-[var(--primary-color)]">
                                <span class="ml-2">Fournisseur</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="type-tiers" value="autre" class="text-[var(--primary-color)]">
                                <span class="ml-2">Autre</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Compte Collectif :</label>
                        <select id="new-tiers-compte-collectif" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                            <option value="411000">411000 - Clients</option>
                            <option value="401000">401000 - Fournisseurs</option>
                            <option value="421000">421000 - Personnel</option>
                            <!-- Autres options ajoutées dynamiquement -->
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Contact :</label>
                        <input type="text" id="new-tiers-contact" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Adresse :</label>
                        <textarea id="new-tiers-adresse" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" rows="2"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Téléphone :</label>
                            <input type="text" id="new-tiers-telephone" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Email :</label>
                            <input type="email" id="new-tiers-email" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="annuler-creer-tiers" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                        <button type="submit" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Ajouter</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Ajouter Journal -->
    <div id="modal-ajouter-journal" class="modal">
        <div class="modal-content bg-[var(--bg-color)] max-w-lg mx-auto mt-20 rounded-lg shadow-xl">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h2 class="text-lg font-semibold">Création de Code Journal</h2>
                <button id="close-modal-ajouter-journal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <form id="form-ajouter-journal">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Nom du Journal :</label>
                        <input type="text" id="new-journal-nom" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Code du Journal :</label>
                        <input type="text" id="new-journal-code" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Type de Journal :</label>
                        <select id="new-journal-type" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                            <option value="" disabled selected>Sélectionnez le type</option>
                            <option value="Ventes">Ventes</option>
                            <option value="Achats">Achats</option>
                            <option value="Trésorerie">Trésorerie</option>
                            <option value="Divers">Divers</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Compte Associé :</label>
                        <select id="new-journal-compte" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                            <option value="" disabled selected>Sélectionnez un compte</option>
                            <!-- Les options seront ajoutées dynamiquement -->
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Devise :</label>
                        <select id="new-journal-devise" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                            <option value="" disabled selected>Sélectionnez la devise</option>
                            <option value="FCFA">FCFA</option>
                            <option value="EUR">EUR</option>
                            <option value="USD">USD</option>
                        </select>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Description :</label>
                        <textarea id="new-journal-description" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" rows="3"></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="annuler-ajouter-journal" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                        <button type="submit" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Importer Plan Comptable -->
    <div id="modal-import-plan-comptable" class="modal">
        <div class="modal-content bg-[var(--bg-color)] max-w-lg mx-auto mt-20 rounded-lg shadow-xl">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h2 class="text-lg font-semibold">Importer un Plan Comptable</h2>
                <button id="close-modal-import-plan-comptable" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Sélectionnez un format d'import :</label>
                    <div class="flex flex-wrap gap-2">
                        <label class="inline-flex items-center border border-[var(--border-color)] rounded-md p-2 cursor-pointer hover:bg-[var(--hover-color)]">
                            <input type="radio" name="import-format" value="mae" class="mr-2" checked>
                            <span>.MAE</span>
                        </label>
                        <label class="inline-flex items-center border border-[var(--border-color)] rounded-md p-2 cursor-pointer hover:bg-[var(--hover-color)]">
                            <input type="radio" name="import-format" value="xls" class="mr-2">
                            <span>.XLS / .XLSX</span>
                        </label>
                        <label class="inline-flex items-center border border-[var(--border-color)] rounded-md p-2 cursor-pointer hover:bg-[var(--hover-color)]">
                            <input type="radio" name="import-format" value="pdf" class="mr-2">
                            <span>.PDF</span>
                        </label>
                        <label class="inline-flex items-center border border-[var(--border-color)] rounded-md p-2 cursor-pointer hover:bg-[var(--hover-color)]">
                            <input type="radio" name="import-format" value="csv" class="mr-2">
                            <span>.CSV</span>
                        </label>
                    </div>
                </div>
                
                <div class="file-upload-area" id="import-file-drop-area">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                    <p class="mb-2">Glissez et déposez votre fichier ici</p>
                    <p class="text-sm text-gray-500 mb-3">ou</p>
                    <label class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded inline-block cursor-pointer">
                        <i class="fas fa-file mr-2"></i> Sélectionner un fichier
                        <input type="file" id="import-file-input" class="hidden">
                    </label>
                </div>
                
                <div id="import-preview" class="mt-4 hidden">
                    <h3 class="font-medium mb-2">Aperçu de l'import:</h3>
                    <div class="document-preview">
                        <p class="text-center text-gray-500">Chargement de l'aperçu...</p>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="annuler-import-plan-comptable" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                    <button type="button" id="valider-import-plan-comptable" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded" disabled>Importer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Ajouter Facture -->
    <div id="modal-ajouter-facture" class="modal">
        <div class="modal-content bg-[var(--bg-color)] max-w-4xl mx-auto mt-20 rounded-lg shadow-xl">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h2 class="text-lg font-semibold">Digitalisation de Facture</h2>
                <button id="close-modal-ajouter-facture" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-medium mb-4">Fichier de facture</h3>
                        <div class="file-upload-area" id="facture-file-drop-area">
                            <i class="fas fa-file-invoice text-4xl text-gray-400 mb-3"></i>
                            <p class="mb-2">Glissez et déposez votre fichier ici</p>
                            <p class="text-sm text-gray-500 mb-3">ou</p>
                            <label class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded inline-block cursor-pointer">
                                <i class="fas fa-file-pdf mr-2"></i> Sélectionner un fichier
                                <input type="file" id="facture-file-input" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                            </label>
                        </div>
                        
                        <div id="facture-preview" class="mt-4 hidden">
                            <h3 class="font-medium mb-2">Aperçu:</h3>
                            <div class="document-preview">
                                <p class="text-center text-gray-500">Chargement de l'aperçu...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="document-form">
                        <h3 class="font-medium mb-4">Informations de la facture</h3>
                        <form id="form-ajouter-facture">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Type de document :</label>
                                <div class="flex space-x-4">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="document-type" value="facture-fournisseur" class="mr-2" checked>
                                        <span>Facture Fournisseur</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="document-type" value="facture-client" class="mr-2">
                                        <span>Facture Client</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Numéro de facture :</label>
                                <input type="text" id="facture-numero" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Date de facture :</label>
                                <input type="date" id="facture-date" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Date d'échéance :</label>
                                <input type="date" id="facture-echeance" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Tiers :</label>
                                <select id="facture-tiers" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" required>
                                    <option value="" disabled selected>Sélectionner un tiers</option>
                                    <!-- Options ajoutées dynamiquement -->
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Description :</label>
                                <textarea id="facture-description" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" rows="2"></textarea>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Montant HT :</label>
                                <input type="number" id="facture-montant-ht" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" step="0.01" required>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Taux TVA (%) :</label>
                                <select id="facture-taux-tva" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    <option value="0">0%</option>
                                    <option value="18" selected>18%</option>
                                    <option value="19.6">19.6%</option>
                                    <option value="20">20%</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Montant TVA :</label>
                                <input type="number" id="facture-montant-tva" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" step="0.01" readonly>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Montant TTC :</label>
                                <input type="number" id="facture-montant-ttc" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" step="0.01" readonly>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Devise :</label>
                                <select id="facture-devise" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    <option value="FCFA" selected>FCFA</option>
                                    <option value="EUR">EUR</option>
                                    <option value="USD">USD</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="facture-comptabiliser" class="mr-2" checked>
                                    <span>Créer l'écriture comptable automatiquement</span>
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="annuler-ajouter-facture" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                    <button type="button" id="valider-ajouter-facture" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Enregistrer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Nouvelle Écriture -->
    <div id="modal-nouvelle-ecriture" class="modal">
        <div class="modal-content bg-[var(--bg-color)] max-w-4xl mx-auto mt-20 rounded-lg shadow-xl">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h2 class="text-lg font-semibold">Sélection du journal et de la période</h2>
                <button id="close-modal-nouvelle-ecriture" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <form id="form-selection-journal">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Journal</label>
                            <select id="selection-journal" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <option disabled selected>Sélectionnez un journal</option>
                                <!-- Options ajoutées dynamiquement -->
                            </select>
                        </div>
                        
                        <div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Mois</label>
                                    <select id="selection-mois" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="01">Janvier</option>
                                        <option value="02">Février</option>
                                        <option value="03">Mars</option>
                                        <option value="04">Avril</option>
                                        <option value="05">Mai</option>
                                        <option value="06">Juin</option>
                                        <option value="07">Juillet</option>
                                        <option value="08">Août</option>
                                        <option value="09">Septembre</option>
                                        <option value="10" selected>Octobre</option>
                                        <option value="11">Novembre</option>
                                        <option value="12">Décembre</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Année</label>
                                    <select id="selection-annee" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                        <option value="2024" selected>2024</option>
                                        <option value="2023">2023</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <label class="block text-sm font-medium mb-2">Modèle de saisie (optionnel)</label>
                        <select id="selection-modele-saisie" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                            <option value="">Aucun modèle</option>
                            <!-- Options ajoutées dynamiquement -->
                        </select>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="annuler-nouvelle-ecriture" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Annuler</button>
                        <button type="button" id="valider-nouvelle-ecriture" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Valider</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal Saisie Écriture -->
    <div id="modal-saisie-ecriture" class="modal">
        <div class="modal-content bg-[var(--bg-color)] max-w-5xl mx-auto mt-10 rounded-lg shadow-xl">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h2 class="text-lg font-semibold">Nouvelle écriture</h2>
                <button id="close-modal-saisie-ecriture" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <form id="form-saisie-ecriture">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Date</label>
                            <input type="date" id="saisie-date" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Référence</label>
                            <input type="text" id="saisie-reference" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" placeholder="Référence du document">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">N° Facture</label>
                            <input type="text" id="saisie-facture" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" placeholder="N° de facture (si applicable)">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Libellé global</label>
                        <input type="text" id="saisie-libelle-global" class="w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]" placeholder="Description de l'opération">
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-[var(--border-color)]">
                            <thead class="bg-[var(--hover-color)]">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Compte</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tiers</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Échéance</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                    <th class="px-4 py-2"></th>
                                </tr>
                            </thead>
                            <tbody id="lignes-ecriture">
                                <!-- Deux lignes par défaut qu'on ne peut pas supprimer -->
                                <tr class="default-row">
                                    <td class="px-4 py-2">
                                        <select class="ligne-compte w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <option value="">Sélectionnez un compte</option>
                                            <!-- Options ajoutées dynamiquement -->
                                        </select>
                                    </td>
                                    <td class="px-4 py-2">
                                        <select class="ligne-tiers w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <option value="">Sélectionnez un tiers</option>
                                            <!-- Options ajoutées dynamiquement -->
                                        </select>
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="text" class="ligne-libelle w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="date" class="ligne-echeance w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="number" class="ligne-debit w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="number" class="ligne-credit w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <button type="button" class="text-gray-400 cursor-not-allowed">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="default-row">
                                    <td class="px-4 py-2">
                                        <select class="ligne-compte w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <option value="">Sélectionnez un compte</option>
                                            <!-- Options ajoutées dynamiquement -->
                                        </select>
                                    </td>
                                    <td class="px-4 py-2">
                                        <select class="ligne-tiers w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                            <option value="">Sélectionnez un tiers</option>
                                            <!-- Options ajoutées dynamiquement -->
                                        </select>
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="text" class="ligne-libelle w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="date" class="ligne-echeance w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="number" class="ligne-debit w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <input type="number" class="ligne-credit w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    </td>
                                    <td class="px-4 py-2">
                                        <button type="button" class="text-gray-400 cursor-not-allowed">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4 flex justify-between">
                        <button type="button" id="ajouter-ligne" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded flex items-center gap-2">
                            <i class="fas fa-plus"></i> Ajouter une ligne
                        </button>
                        
                        <div class="flex items-center gap-4">
                            <div>
                                <label class="mr-2">Devise:</label>
                                <select id="saisie-devise" class="border border-[var(--border-color)] rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                    <option value="FCFA" selected>FCFA</option>
                                    <option value="EUR">EUR</option>
                                    <option value="USD">USD</option>
                                </select>
                            </div>
                            <div class="text-right">
                                <p>Solde: <span id="solde-ecriture" class="font-bold">0.00</span> <span id="solde-devise">FCFA</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="fermer-saisie-ecriture" class="border border-[var(--border-color)] hover:bg-[var(--hover-color)] px-4 py-2 rounded">Fermer</button>
                        <button type="button" id="sauvegarder-ecriture" class="bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] text-white px-4 py-2 rounded">Sauvegarder</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Initialisation des données par défaut
        const defaultData = {
            comptes: [
                { id: 1, numero: "101000", libelle: "Capital social", type: "autres" },
                { id: 2, numero: "201000", libelle: "Frais d'établissement", type: "autres" },
                { id: 3, numero: "401000", libelle: "Fournisseurs", type: "autres" },
                { id: 4, numero: "411000", libelle: "Clients", type: "autres" },
                { id: 5, numero: "512000", libelle: "Banque", type: "autres" },
                { id: 6, numero: "601400", libelle: "Fournitures consommables", type: "charges" },
                { id: 7, numero: "602100", libelle: "Matières premières", type: "charges" },
                { id: 8, numero: "701000", libelle: "Ventes de produits finis", type: "produits" },
                { id: 9, numero: "707000", libelle: "Ventes de marchandises", type: "produits" },
                { id: 10, numero: "445660", libelle: "TVA déductible", type: "autres" },
                { id: 11, numero: "445670", libelle: "TVA collectée", type: "autres" }
            ],
            tiers: [
                { id: 1, code: "CLI001", nom: "Client Principal SARL", type: "client", compte: "411000", contact: "M. Dupont", telephone: "+225 0707070707", email: "contact@clientprincipal.com", adresse: "Abidjan, Plateau" },
                { id: 2, code: "CLI002", nom: "Client Secondaire SA", type: "client", compte: "411000", contact: "Mme Konaté", telephone: "+225 0505050505", email: "contact@clientsecondaire.com", adresse: "Abidjan, Cocody" },
                { id: 3, code: "FRN001", nom: "Fournisseur Principal SA", type: "fournisseur", compte: "401000", contact: "M. Martin", telephone: "+225 0101010101", email: "contact@fournisseurprincipal.com", adresse: "Abidjan, Zone Industrielle" },
                { id: 4, code: "FRN002", nom: "Fournisseur Matériel SARL", type: "fournisseur", compte: "401000", contact: "Mme Sanogo", telephone: "+225 0202020202", email: "contact@fournisseurmateriel.com", adresse: "Abidjan, Treichville" }
            ],
            journaux: [
                { id: 1, code: "AC", nom: "Achats", type: "Achats", compte: "401000", devise: "FCFA", description: "Journal des achats" },
                { id: 2, code: "VE", nom: "Ventes", type: "Ventes", compte: "411000", devise: "FCFA", description: "Journal des ventes" },
                { id: 3, code: "BQ", nom: "Banque", type: "Trésorerie", compte: "512000", devise: "FCFA", description: "Journal de banque" },
                { id: 4, code: "OD", nom: "Opérations Diverses", type: "Divers", compte: "", devise: "FCFA", description: "Journal des opérations diverses" }
            ],
            modelesSaisie: [
                { id: 1, code: "ACHFRN", libelle: "Achat Fournisseur", journal: "AC", nbLignes: 3, derniereUtilisation: null, 
                  lignes: [
                    { compte: "602100", debit: 100, credit: 0, libelle: "Achat de matières premières" },
                    { compte: "445660", debit: 18, credit: 0, libelle: "TVA déductible 18%" },
                    { compte: "401000", debit: 0, credit: 118, libelle: "Dette fournisseur", tiers: "FRN001" }
                  ]
                },
                { id: 2, code: "VENTE", libelle: "Vente Client", journal: "VE", nbLignes: 3, derniereUtilisation: null,
                  lignes: [
                    { compte: "411000", debit: 118, credit: 0, libelle: "Créance client", tiers: "CLI001" },
                    { compte: "707000", debit: 0, credit: 100, libelle: "Vente de marchandises" },
                    { compte: "445670", debit: 0, credit: 18, libelle: "TVA collectée 18%" }
                  ]
                }
            ],
            ecritures: [],
            factures: [],
            sectionsAnalytiques: [
                { id: 1, code: "ADM", libelle: "Administration", axe: "Départements", parent: "" },
                { id: 2, code: "COM", libelle: "Commercial", axe: "Départements", parent: "" },
                { id: 3, code: "PRD", libelle: "Production", axe: "Départements", parent: "" },
                { id: 4, code: "PROJ1", libelle: "Projet Alpha", axe: "Projets", parent: "" },
                { id: 5, code: "PROJ2", libelle: "Projet Beta", axe: "Projets", parent: "" }
            ],
            axesAnalytiques: [
                { id: 1, code: "DEP", libelle: "Départements" },
                { id: 2, code: "PROJ", libelle: "Projets" },
                { id: 3, code: "REG", libelle: "Régions" }
            ],
            declarationsTVA: [],
            declarationsFiscales: [],
            activities: [],
            currentCompany: "societeX"
        };
        
        // Base de données locale
        class Database {
            constructor() {
                this.loadData();
            }
            
            loadData() {
                if (!localStorage.getItem('unikorp_data')) {
                    localStorage.setItem('unikorp_data', JSON.stringify(defaultData));
                }
                this.data = JSON.parse(localStorage.getItem('unikorp_data'));
            }
            
            saveData() {
                localStorage.setItem('unikorp_data', JSON.stringify(this.data));
            }
            
            getComptes() {
                return this.data.comptes;
            }
            
            getTiers() {
                return this.data.tiers;
            }
            
            getJournaux() {
                return this.data.journaux;
            }
            
            getEcritures() {
                return this.data.ecritures;
            }
            
            getModeleSaisie() {
                return this.data.modelesSaisie;
            }
            
            getFactures() {
                return this.data.factures;
            }
            
            getActivities() {
                return this.data.activities;
            }
            
            getSectionsAnalytiques() {
                return this.data.sectionsAnalytiques;
            }
            
            getAxesAnalytiques() {
                return this.data.axesAnalytiques;
            }
            
            getCurrentCompany() {
                return this.data.currentCompany;
            }
            
            setCurrentCompany(company) {
                this.data.currentCompany = company;
                this.saveData();
            }
            
            // Méthodes pour les comptes
            addCompte(compte) {
                const newId = this.data.comptes.length > 0 ? 
                    Math.max(...this.data.comptes.map(c => c.id)) + 1 : 1;
                
                const newCompte = {
                    id: newId,
                    ...compte
                };
                
                this.data.comptes.push(newCompte);
                this.addActivity({
                    type: 'create',
                    module: 'comptes',
                    description: `Création du compte ${compte.numero} - ${compte.libelle}`,
                    timestamp: new Date().toISOString()
                });
                this.saveData();
                return newCompte;
            }
            
            updateCompte(id, updates) {
                const index = this.data.comptes.findIndex(c => c.id === id);
                if (index !== -1) {
                    const oldCompte = this.data.comptes[index];
                    this.data.comptes[index] = { ...oldCompte, ...updates };
                    this.addActivity({
                        type: 'update',
                        module: 'comptes',
                        description: `Modification du compte ${oldCompte.numero} - ${oldCompte.libelle}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return this.data.comptes[index];
                }
                return null;
            }
            
            deleteCompte(id) {
                const index = this.data.comptes.findIndex(c => c.id === id);
                if (index !== -1) {
                    const deletedCompte = this.data.comptes[index];
                    this.data.comptes.splice(index, 1);
                    this.addActivity({
                        type: 'delete',
                        module: 'comptes',
                        description: `Suppression du compte ${deletedCompte.numero} - ${deletedCompte.libelle}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return true;
                }
                return false;
            }
            
            // Méthodes pour les tiers
            addTiers(tiers) {
                const newId = this.data.tiers.length > 0 ? 
                    Math.max(...this.data.tiers.map(t => t.id)) + 1 : 1;
                
                const newTiers = {
                    id: newId,
                    ...tiers
                };
                
                this.data.tiers.push(newTiers);
                this.addActivity({
                    type: 'create',
                    module: 'tiers',
                    description: `Création du tiers ${tiers.code} - ${tiers.nom}`,
                    timestamp: new Date().toISOString()
                });
                this.saveData();
                return newTiers;
            }
            
            updateTiers(id, updates) {
                const index = this.data.tiers.findIndex(t => t.id === id);
                if (index !== -1) {
                    const oldTiers = this.data.tiers[index];
                    this.data.tiers[index] = { ...oldTiers, ...updates };
                    this.addActivity({
                        type: 'update',
                        module: 'tiers',
                        description: `Modification du tiers ${oldTiers.code} - ${oldTiers.nom}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return this.data.tiers[index];
                }
                return null;
            }
            
            deleteTiers(id) {
                const index = this.data.tiers.findIndex(t => t.id === id);
                if (index !== -1) {
                    const deletedTiers = this.data.tiers[index];
                    this.data.tiers.splice(index, 1);
                    this.addActivity({
                        type: 'delete',
                        module: 'tiers',
                        description: `Suppression du tiers ${deletedTiers.code} - ${deletedTiers.nom}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return true;
                }
                return false;
            }
            
            // Méthodes pour les journaux
            addJournal(journal) {
                const newId = this.data.journaux.length > 0 ? 
                    Math.max(...this.data.journaux.map(j => j.id)) + 1 : 1;
                
                const newJournal = {
                    id: newId,
                    ...journal
                };
                
                this.data.journaux.push(newJournal);
                this.addActivity({
                    type: 'create',
                    module: 'journaux',
                    description: `Création du journal ${journal.code} - ${journal.nom}`,
                    timestamp: new Date().toISOString()
                });
                this.saveData();
                return newJournal;
            }
            
            updateJournal(id, updates) {
                const index = this.data.journaux.findIndex(j => j.id === id);
                if (index !== -1) {
                    const oldJournal = this.data.journaux[index];
                    this.data.journaux[index] = { ...oldJournal, ...updates };
                    this.addActivity({
                        type: 'update',
                        module: 'journaux',
                        description: `Modification du journal ${oldJournal.code} - ${oldJournal.nom}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return this.data.journaux[index];
                }
                return null;
            }
            
            deleteJournal(id) {
                const index = this.data.journaux.findIndex(j => j.id === id);
                if (index !== -1) {
                    const deletedJournal = this.data.journaux[index];
                    this.data.journaux.splice(index, 1);
                    this.addActivity({
                        type: 'delete',
                        module: 'journaux',
                        description: `Suppression du journal ${deletedJournal.code} - ${deletedJournal.nom}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return true;
                }
                return false;
            }
            
            // Méthodes pour les modèles de saisie
            addModeleSaisie(modele) {
                const newId = this.data.modelesSaisie.length > 0 ? 
                    Math.max(...this.data.modelesSaisie.map(m => m.id)) + 1 : 1;
                
                const newModele = {
                    id: newId,
                    ...modele,
                    derniereUtilisation: null
                };
                
                this.data.modelesSaisie.push(newModele);
                this.addActivity({
                    type: 'create',
                    module: 'modeles-saisie',
                    description: `Création du modèle de saisie ${modele.code} - ${modele.libelle}`,
                    timestamp: new Date().toISOString()
                });
                this.saveData();
                return newModele;
            }
            
            updateModeleSaisie(id, updates) {
                const index = this.data.modelesSaisie.findIndex(m => m.id === id);
                if (index !== -1) {
                    const oldModele = this.data.modelesSaisie[index];
                    this.data.modelesSaisie[index] = { ...oldModele, ...updates };
                    this.addActivity({
                        type: 'update',
                        module: 'modeles-saisie',
                        description: `Modification du modèle de saisie ${oldModele.code} - ${oldModele.libelle}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return this.data.modelesSaisie[index];
                }
                return null;
            }
            
            deleteModeleSaisie(id) {
                const index = this.data.modelesSaisie.findIndex(m => m.id === id);
                if (index !== -1) {
                    const deletedModele = this.data.modelesSaisie[index];
                    this.data.modelesSaisie.splice(index, 1);
                    this.addActivity({
                        type: 'delete',
                        module: 'modeles-saisie',
                        description: `Suppression du modèle de saisie ${deletedModele.code} - ${deletedModele.libelle}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return true;
                }
                return false;
            }
            
            // Méthodes pour les factures
            addFacture(facture) {
                const newId = this.data.factures.length > 0 ? 
                    Math.max(...this.data.factures.map(f => f.id)) + 1 : 1;
                
                const newFacture = {
                    id: newId,
                    ...facture,
                    dateCreation: new Date().toISOString()
                };
                
                this.data.factures.push(newFacture);
                this.addActivity({
                    type: 'create',
                    module: 'factures',
                    description: `Digitalisation de la facture ${facture.numero}`,
                    timestamp: new Date().toISOString()
                });
                this.saveData();
                return newFacture;
            }
            
            updateFacture(id, updates) {
                const index = this.data.factures.findIndex(f => f.id === id);
                if (index !== -1) {
                    const oldFacture = this.data.factures[index];
                    this.data.factures[index] = { ...oldFacture, ...updates };
                    this.addActivity({
                        type: 'update',
                        module: 'factures',
                        description: `Modification de la facture ${oldFacture.numero}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return this.data.factures[index];
                }
                return null;
            }
            
            deleteFacture(id) {
                const index = this.data.factures.findIndex(f => f.id === id);
                if (index !== -1) {
                    const deletedFacture = this.data.factures[index];
                    this.data.factures.splice(index, 1);
                    this.addActivity({
                        type: 'delete',
                        module: 'factures',
                        description: `Suppression de la facture ${deletedFacture.numero}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return true;
                }
                return false;
            }
            
            // Méthodes pour les écritures
            addEcriture(ecriture) {
                const newId = this.data.ecritures.length > 0 ? 
                    Math.max(...this.data.ecritures.map(e => e.id)) + 1 : 1;
                
                // Générer un numéro de saisie basé sur le code journal + année/mois + séquence
                const date = new Date(ecriture.dateOperation);
                const year = date.getFullYear().toString().substring(2);
                const month = String(date.getMonth() + 1).padStart(2, '0');
                
                // Trouver le dernier numéro pour ce journal et cette période
                const journalCode = ecriture.journal;
                const prefix = `${journalCode}${year}${month}`;
                
                const similarEcritures = this.data.ecritures.filter(e => {
                    return e.numeroPiece && e.numeroPiece.startsWith(prefix);
                });
                
                let sequence = "0001";
                if (similarEcritures.length > 0) {
                    const lastSequence = Math.max(...similarEcritures.map(e => {
                        const seq = e.numeroPiece.substring(prefix.length);
                        return parseInt(seq, 10);
                    }));
                    sequence = String(lastSequence + 1).padStart(4, '0');
                }
                
                const numeroPiece = `${prefix}${sequence}`;
                
                const newEcriture = {
                    id: newId,
                    numeroPiece,
                    dateSaisie: new Date().toISOString(),
                    ...ecriture
                };
                
                this.data.ecritures.push(newEcriture);
                
                // Calculer le montant total de l'écriture
                const montantTotal = ecriture.lignes.reduce((sum, ligne) => {
                    return sum + parseFloat(ligne.debit || 0);
                }, 0);
                
                this.addActivity({
                    type: 'create',
                    module: 'ecritures',
                    description: `Création de l'écriture ${numeroPiece} dans le journal ${ecriture.journal} pour ${formatNumber(montantTotal)} ${ecriture.devise || 'FCFA'}`,
                    timestamp: new Date().toISOString()
                });
                
                // Mise à jour des statistiques pour les KPIs
                this.updateStatistiquesFinancieres(ecriture);
                
                this.saveData();
                return newEcriture;
            }
            
            updateEcriture(id, updates) {
                const index = this.data.ecritures.findIndex(e => e.id === id);
                if (index !== -1) {
                    const oldEcriture = this.data.ecritures[index];
                    this.data.ecritures[index] = { ...oldEcriture, ...updates };
                    this.addActivity({
                        type: 'update',
                        module: 'ecritures',
                        description: `Modification de l'écriture ${oldEcriture.numeroPiece}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return this.data.ecritures[index];
                }
                return null;
            }
            
            deleteEcriture(id) {
                const index = this.data.ecritures.findIndex(e => e.id === id);
                if (index !== -1) {
                    const deletedEcriture = this.data.ecritures[index];
                    this.data.ecritures.splice(index, 1);
                    this.addActivity({
                        type: 'delete',
                        module: 'ecritures',
                        description: `Suppression de l'écriture ${deletedEcriture.numeroPiece}`,
                        timestamp: new Date().toISOString()
                    });
                    this.saveData();
                    return true;
                }
                return false;
            }
            
            // Méthodes pour les sections analytiques
            addSectionAnalytique(section) {
                const newId = this.data.sectionsAnalytiques.length > 0 ? 
                    Math.max(...this.data.sectionsAnalytiques.map(s => s.id)) + 1 : 1;
                
                const newSection = {
                    id: newId,
                    ...section
                };
                
                this.data.sectionsAnalytiques.push(newSection);
                this.addActivity({
                    type: 'create',
                    module: 'sections-analytiques',
                    description: `Création de la section analytique ${section.code} - ${section.libelle}`,
                    timestamp: new Date().toISOString()
                });
                this.saveData();
                return newSection;
            }
            
            // Méthodes pour les axes analytiques
            addAxeAnalytique(axe) {
                const newId = this.data.axesAnalytiques.length > 0 ? 
                    Math.max(...this.data.axesAnalytiques.map(a => a.id)) + 1 : 1;
                
                const newAxe = {
                    id: newId,
                    ...axe
                };
                
                this.data.axesAnalytiques.push(newAxe);
                this.addActivity({
                    type: 'create',
                    module: 'axes-analytiques',
                    description: `Création de l'axe analytique ${axe.code} - ${axe.libelle}`,
                    timestamp: new Date().toISOString()
                });
                this.saveData();
                return newAxe;
            }
            
            // Méthodes pour les déclarations TVA
            calculerTVA(periode, options = {}) {
                const { mois, annee, inclureCredit = true, regrouper = false } = periode;
                
                // Filtrer les écritures pour la période sélectionnée
                const dateDebut = new Date(annee, mois - 1, 1);
                const dateFin = new Date(annee, mois, 0); // Dernier jour du mois
                
                const ecrituresPeriode = this.data.ecritures.filter(e => {
                    const dateOperation = new Date(e.dateOperation);
                    return dateOperation >= dateDebut && dateOperation <= dateFin;
                });
                
                // Identifier les comptes de TVA
                let tvaCollectee = 0;
                let tvaDeductible = 0;
                
                // Pour chaque écriture, chercher les lignes concernant la TVA
                ecrituresPeriode.forEach(ecriture => {
                    ecriture.lignes.forEach(ligne => {
                        // TVA collectée (généralement au crédit)
                        if (ligne.compte.startsWith('4431') && ligne.compte.endsWith('70')) {
                            tvaCollectee += parseFloat(ligne.credit || 0);
                        }
                        // TVA déductible (généralement au débit)
                        else if (ligne.compte.startsWith('4452') && ligne.compte.endsWith('60')) {
                            tvaDeductible += parseFloat(ligne.debit || 0);
                        }
                    });
                });
                
                // Calculer le solde
                let solde = tvaCollectee - tvaDeductible;
                let tvaAPayer = solde > 0 ? solde : 0;
                let creditTVA = solde < 0 ? Math.abs(solde) : 0;
                
                return {
                    tvaCollectee,
                    tvaDeductible,
                    tvaAPayer,
                    creditTVA,
                    periode: {
                        mois,
                        annee
                    }
                };
            }
            
            // Méthode pour mettre à jour les statistiques financières à partir des écritures
            updateStatistiquesFinancieres(ecriture) {
                if (!this.data.statistiquesFinancieres) {
                    this.data.statistiquesFinancieres = {
                        ca: 0,
                        caAnnuel: {}, // par année/mois
                        depenses: 0,
                        depensesAnnuel: {}, // par année/mois
                        benefice: 0,
                        marge: 0
                    };
                }
                
                const stats = this.data.statistiquesFinancieres;
                const date = new Date(ecriture.dateOperation);
                const year = date.getFullYear();
                const month = date.getMonth();
                
                const yearMonthKey = `${year}-${month}`;
                
                if (!stats.caAnnuel[yearMonthKey]) {
                    stats.caAnnuel[yearMonthKey] = 0;
                }
                
                if (!stats.depensesAnnuel[yearMonthKey]) {
                    stats.depensesAnnuel[yearMonthKey] = 0;
                }
                
                // Parcourir les lignes de l'écriture pour mettre à jour les statistiques
                ecriture.lignes.forEach(ligne => {
                    const compte = ligne.compte;
                    
                    // Les comptes de produits (classe 7) augmentent le CA
                    if (compte.startsWith('7')) {
                        const montant = parseFloat(ligne.credit || 0);
                        stats.ca += montant;
                        stats.caAnnuel[yearMonthKey] += montant;
                    }
                    
                    // Les comptes de charges (classe 6) augmentent les dépenses
                    if (compte.startsWith('6')) {
                        const montant = parseFloat(ligne.debit || 0);
                        stats.depenses += montant;
                        stats.depensesAnnuel[yearMonthKey] += montant;
                    }
                });
                
                // Recalculer le bénéfice et la marge
                stats.benefice = stats.ca - stats.depenses;
                stats.marge = stats.ca > 0 ? (stats.benefice / stats.ca) * 100 : 0;
                
                this.saveData();
            }
            
            // Méthode pour récupérer les statistiques par période
            getStatistiquesParPeriode(periode = {}) {
                const stats = this.data.statistiquesFinancieres || {
                    ca: 0,
                    caAnnuel: {},
                    depenses: 0,
                    depensesAnnuel: {},
                    benefice: 0,
                    marge: 0
                };
                
                // Par défaut, retourner les stats globales
                if (!periode.debut || !periode.fin) {
                    return stats;
                }
                
                // Si une période est spécifiée, calculer les stats pour cette période
                const dateDebut = new Date(periode.debut);
                const dateFin = new Date(periode.fin);
                const yearMonthDebut = `${dateDebut.getFullYear()}-${dateDebut.getMonth()}`;
                const yearMonthFin = `${dateFin.getFullYear()}-${dateFin.getMonth()}`;
                
                let caPeriode = 0;
                let depensesPeriode = 0;
                
                // Parcourir les mois dans la période
                Object.entries(stats.caAnnuel).forEach(([yearMonth, ca]) => {
                    if (yearMonth >= yearMonthDebut && yearMonth <= yearMonthFin) {
                        caPeriode += ca;
                    }
                });
                
                Object.entries(stats.depensesAnnuel).forEach(([yearMonth, depenses]) => {
                    if (yearMonth >= yearMonthDebut && yearMonth <= yearMonthFin) {
                        depensesPeriode += depenses;
                    }
                });
                
                const beneficePeriode = caPeriode - depensesPeriode;
                const margePeriode = caPeriode > 0 ? (beneficePeriode / caPeriode) * 100 : 0;
                
                return {
                    ca: caPeriode,
                    depenses: depensesPeriode,
                    benefice: beneficePeriode,
                    marge: margePeriode
                };
            }
            
            // Méthode pour récupérer les données des graphiques
            getGraphData() {
                const stats = this.data.statistiquesFinancieres || {
                    caAnnuel: {},
                    depensesAnnuel: {}
                };
                
                // Récupérer les 12 derniers mois
                const today = new Date();
                const moisData = [];
                const caData = [];
                const depensesData = [];
                
                for (let i = 11; i >= 0; i--) {
                    const month = new Date(today.getFullYear(), today.getMonth() - i, 1);
                    const yearMonthKey = `${month.getFullYear()}-${month.getMonth()}`;
                    
                    // Nom du mois pour l'affichage
                    const monthName = month.toLocaleString('default', { month: 'short' });
                    moisData.push(monthName);
                    
                    // Données CA et dépenses
                    caData.push(stats.caAnnuel[yearMonthKey] || 0);
                    depensesData.push(stats.depensesAnnuel[yearMonthKey] || 0);
                }
                
                return {
                    labels: moisData,
                    ca: caData,
                    depenses: depensesData
                };
            }
            
            // Méthode pour obtenir les mouvements du grand livre pour un compte donné
            getGrandLivre(compteNumero, dateDebut, dateFin) {
                const mouvements = [];
                let solde = 0;
                
                // Trouver toutes les écritures qui concernent ce compte
                this.data.ecritures.forEach(ecriture => {
                    const dateOperation = new Date(ecriture.dateOperation);
                    
                    if (dateDebut && dateOperation < new Date(dateDebut)) return;
                    if (dateFin && dateOperation > new Date(dateFin)) return;
                    
                    ecriture.lignes.forEach(ligne => {
                        if (ligne.compte === compteNumero) {
                            const debit = parseFloat(ligne.debit || 0);
                            const credit = parseFloat(ligne.credit || 0);
                            
                            solde += debit - credit;
                            
                            mouvements.push({
                                date: ecriture.dateOperation,
                                numeroPiece: ecriture.numeroPiece,
                                journal: ecriture.journal,
                                libelle: ligne.libelle || ecriture.libelle,
                                reference: ecriture.reference || '',
                                debit: debit,
                                credit: credit,
                                solde: solde
                            });
                        }
                    });
                });
                
                // Trier par date
                mouvements.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                this.addActivity({
                    type: 'view',
                    module: 'grand-livre',
                    description: `Consultation du grand livre pour le compte ${compteNumero}`,
                    timestamp: new Date().toISOString()
                });
                
                return {
                    mouvements,
                    totaux: {
                        debit: mouvements.reduce((total, mvt) => total + mvt.debit, 0),
                        credit: mouvements.reduce((total, mvt) => total + mvt.credit, 0),
                        solde: solde
                    }
                };
            }
            
            // Méthode pour obtenir le grand livre des tiers
            getGrandLivreTiers(tiersCode, dateDebut, dateFin) {
                const mouvements = [];
                let solde = 0;
                
                // Trouver toutes les écritures concernant ce tiers
                this.data.ecritures.forEach(ecriture => {
                    const dateOperation = new Date(ecriture.dateOperation);
                    
                    if (dateDebut && dateOperation < new Date(dateDebut)) return;
                    if (dateFin && dateOperation > new Date(dateFin)) return;
                    
                    ecriture.lignes.forEach(ligne => {
                        if (ligne.tiers === tiersCode) {
                            const debit = parseFloat(ligne.debit || 0);
                            const credit = parseFloat(ligne.credit || 0);
                            
                            solde += debit - credit;
                            
                            mouvements.push({
                                date: ecriture.dateOperation,
                                numeroPiece: ecriture.numeroPiece,
                                journal: ecriture.journal,
                                compte: ligne.compte,
                                libelle: ligne.libelle || ecriture.libelle,
                                reference: ecriture.reference || '',
                                debit: debit,
                                credit: credit,
                                solde: solde
                            });
                        }
                    });
                });
                
                // Trier par date
                mouvements.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                this.addActivity({
                    type: 'view',
                    module: 'grand-livre-tiers',
                    description: `Consultation du grand livre tiers pour ${tiersCode}`,
                    timestamp: new Date().toISOString()
                });
                
                return {
                    mouvements,
                    totaux: {
                        debit: mouvements.reduce((total, mvt) => total + mvt.debit, 0),
                        credit: mouvements.reduce((total, mvt) => total + mvt.credit, 0),
                        solde: solde
                    }
                };
            }
            
            // Méthode pour obtenir la balance générale
            getBalanceGenerale(dateDebut, dateFin, options = {}) {
                const { afficherMouvementes = true, inclureSoldes = true, niveau = 'tous' } = options;
                const comptes = {};
                
                // Initialiser les soldes des comptes
                this.data.comptes.forEach(compte => {
                    comptes[compte.numero] = {
                        numero: compte.numero,
                        libelle: compte.libelle,
                        soldeInitial: { debit: 0, credit: 0 },
                        mouvements: { debit: 0, credit: 0 },
                        soldeFinal: { debit: 0, credit: 0 }
                    };
                });
                
                // Parcourir toutes les écritures
                this.data.ecritures.forEach(ecriture => {
                    const dateOperation = new Date(ecriture.dateOperation);
                    
                    ecriture.lignes.forEach(ligne => {
                        const compte = ligne.compte;
                        
                        if (!comptes[compte]) {
                            // Si le compte n'existe pas encore dans notre structure, on le crée
                            comptes[compte] = {
                                numero: compte,
                                libelle: this.getCompteLibelle(compte) || compte,
                                soldeInitial: { debit: 0, credit: 0 },
                                mouvements: { debit: 0, credit: 0 },
                                soldeFinal: { debit: 0, credit: 0 }
                            };
                        }
                        
                        const debit = parseFloat(ligne.debit || 0);
                        const credit = parseFloat(ligne.credit || 0);
                        
                        // Si la date est avant la période, mettre à jour le solde initial
                        if (dateDebut && dateOperation < new Date(dateDebut)) {
                            comptes[compte].soldeInitial.debit += debit;
                            comptes[compte].soldeInitial.credit += credit;
                        }
                        // Sinon si la date est dans la période, mettre à jour les mouvements
                        else if ((!dateDebut || dateOperation >= new Date(dateDebut)) && (!dateFin || dateOperation <= new Date(dateFin))) {
                            comptes[compte].mouvements.debit += debit;
                            comptes[compte].mouvements.credit += credit;
                        }
                    });
                });
                
                // Calculer les soldes finaux
                Object.values(comptes).forEach(compte => {
                    const soldeInitialNet = compte.soldeInitial.debit - compte.soldeInitial.credit;
                    const mouvementsNet = compte.mouvements.debit - compte.mouvements.credit;
                    const soldeFinalNet = soldeInitialNet + mouvementsNet;
                    
                    if (soldeFinalNet > 0) {
                        compte.soldeFinal.debit = soldeFinalNet;
                        compte.soldeFinal.credit = 0;
                    } else {
                        compte.soldeFinal.debit = 0;
                        compte.soldeFinal.credit = Math.abs(soldeFinalNet);
                    }
                });
                
                // Filtrer les comptes
                let balanceComptes = Object.values(comptes);
                
                // Filtrer les comptes selon les options
                if (afficherMouvementes) {
                    balanceComptes = balanceComptes.filter(compte => 
                        compte.mouvements.debit > 0 || compte.mouvements.credit > 0
                    );
                }
                
                if (!inclureSoldes) {
                    balanceComptes = balanceComptes.filter(compte => 
                        compte.soldeFinal.debit > 0 || compte.soldeFinal.credit > 0
                    );
                }
                
                // Regrouper par niveau si nécessaire
                if (niveau !== 'tous') {
                    const niveauLength = parseInt(niveau);
                    const comptesFiltres = {};
                    
                    balanceComptes.forEach(compte => {
                        const prefixe = compte.numero.substring(0, niveauLength);
                        
                        if (!comptesFiltres[prefixe]) {
                            comptesFiltres[prefixe] = {
                                numero: prefixe,
                                libelle: `Comptes ${prefixe}`,
                                soldeInitial: { debit: 0, credit: 0 },
                                mouvements: { debit: 0, credit: 0 },
                                soldeFinal: { debit: 0, credit: 0 }
                            };
                        }
                        
                        comptesFiltres[prefixe].soldeInitial.debit += compte.soldeInitial.debit;
                        comptesFiltres[prefixe].soldeInitial.credit += compte.soldeInitial.credit;
                        comptesFiltres[prefixe].mouvements.debit += compte.mouvements.debit;
                        comptesFiltres[prefixe].mouvements.credit += compte.mouvements.credit;
                        comptesFiltres[prefixe].soldeFinal.debit += compte.soldeFinal.debit;
                        comptesFiltres[prefixe].soldeFinal.credit += compte.soldeFinal.credit;
                    });
                    
                    balanceComptes = Object.values(comptesFiltres);
                }
                
                // Trier par numéro de compte
                balanceComptes.sort((a, b) => a.numero.localeCompare(b.numero));
                
                this.addActivity({
                    type: 'view',
                    module: 'balance-generale',
                    description: `Consultation de la balance générale`,
                    timestamp: new Date().toISOString()
                });
                
                // Calculer les totaux
                const totaux = {
                    soldeInitial: { debit: 0, credit: 0 },
                    mouvements: { debit: 0, credit: 0 },
                    soldeFinal: { debit: 0, credit: 0 }
                };
                
                balanceComptes.forEach(compte => {
                    totaux.soldeInitial.debit += compte.soldeInitial.debit;
                    totaux.soldeInitial.credit += compte.soldeInitial.credit;
                    totaux.mouvements.debit += compte.mouvements.debit;
                    totaux.mouvements.credit += compte.mouvements.credit;
                    totaux.soldeFinal.debit += compte.soldeFinal.debit;
                    totaux.soldeFinal.credit += compte.soldeFinal.credit;
                });
                
                return {
                    comptes: balanceComptes,
                    totaux
                };
            }
            
            // Méthode pour obtenir la balance âgée des tiers
            getBalanceAgee(dateRef, options = {}) {
                const { type = 'clients', tiers = null, tranches = [30, 60, 90, 120] } = options;
                const balanceTiers = {};
                const dateReference = new Date(dateRef);
                
                // Initialiser les soldes des tiers
                this.data.tiers.forEach(t => {
                    if (type === 'clients' && t.type !== 'client') return;
                    if (type === 'fournisseurs' && t.type !== 'fournisseur') return;
                    if (tiers && t.code !== tiers) return;
                    
                    balanceTiers[t.code] = {
                        code: t.code,
                        nom: t.nom,
                        solde: 0,
                        nonEchu: 0,
                        tranches: Array(tranches.length + 1).fill(0)
                    };
                });
                
                // Parcourir toutes les écritures de tiers
                this.data.ecritures.forEach(ecriture => {
                    const dateOperation = new Date(ecriture.dateOperation);
                    
                    // Ne tenir compte que des écritures jusqu'à la date de référence
                    if (dateOperation > dateReference) return;
                    
                    ecriture.lignes.forEach(ligne => {
                        if (!ligne.tiers) return;
                        
                        const tierCode = ligne.tiers;
                        if (!balanceTiers[tierCode]) return;
                        
                        const debit = parseFloat(ligne.debit || 0);
                        const credit = parseFloat(ligne.credit || 0);
                        const montantNet = debit - credit;
                        
                        // Mettre à jour le solde global
                        balanceTiers[tierCode].solde += montantNet;
                        
                        // Si une échéance est spécifiée, calculer l'âge
                        if (ligne.echeance) {
                            const dateEcheance = new Date(ligne.echeance);
                            const aujourdhui = dateReference;
                            
                            // Calculer le nombre de jours de retard
                            const diffTemps = aujourdhui.getTime() - dateEcheance.getTime();
                            const diffJours = Math.floor(diffTemps / (1000 * 3600 * 24));
                            
                            // Si la date d'échéance est future, c'est non échu
                            if (diffJours < 0) {
                                balanceTiers[tierCode].nonEchu += montantNet;
                            } else {
                                // Sinon, déterminer dans quelle tranche tombe ce montant
                                let trouveeTranche = false;
                                for (let i = 0; i < tranches.length; i++) {
                                    if (diffJours <= tranches[i]) {
                                        balanceTiers[tierCode].tranches[i] += montantNet;
                                        trouveeTranche = true;
                                        break;
                                    }
                                }
                                
                                // Si aucune tranche correspondante n'a été trouvée, mettre dans la dernière
                                if (!trouveeTranche) {
                                    balanceTiers[tierCode].tranches[tranches.length] += montantNet;
                                }
                            }
                        } else {
                            // Sans échéance, tout est considéré comme étant dans la dernière tranche
                            balanceTiers[tierCode].tranches[tranches.length] += montantNet;
                        }
                    });
                });
                
                // Filtrer les tiers sans solde
                const tiersFiltres = Object.values(balanceTiers).filter(t => t.solde !== 0);
                
                // Trier par code
                tiersFiltres.sort((a, b) => a.code.localeCompare(b.code));
                
                this.addActivity({
                    type: 'view',
                    module: 'balance-agee',
                    description: `Consultation de la balance âgée des ${type}`,
                    timestamp: new Date().toISOString()
                });
                
                // Calculer les totaux
                const totaux = {
                    solde: 0,
                    nonEchu: 0,
                    tranches: Array(tranches.length + 1).fill(0)
                };
                
                tiersFiltres.forEach(t => {
                    totaux.solde += t.solde;
                    totaux.nonEchu += t.nonEchu;
                    
                    for (let i = 0; i < t.tranches.length; i++) {
                        totaux.tranches[i] += t.tranches[i];
                    }
                });
                
                return {
                    tiers: tiersFiltres,
                    totaux,
                    tranches
                };
            }
            
            // Méthode pour récupérer les données d'un journal comptable
            getJournal(code, dateDebut, dateFin) {
                const mouvements = [];
                
                // Si on demande tous les journaux
                if (code === 'all') {
                    // Récupérer tous les mouvements pour tous les journaux
                    this.data.journaux.forEach(journal => {
                        const journalData = this.getJournal(journal.code, dateDebut, dateFin);
                        mouvements.push(...journalData.mouvements);
                    });
                } else {
                    // Récupérer toutes les écritures pour ce journal
                    this.data.ecritures.forEach(ecriture => {
                        if (ecriture.journal !== code) return;
                        
                        const dateOperation = new Date(ecriture.dateOperation);
                        
                        if (dateDebut && dateOperation < new Date(dateDebut)) return;
                        if (dateFin && dateOperation > new Date(dateFin)) return;
                        
                        const ecritureMouvements = {
                            id: ecriture.id,
                            numeroPiece: ecriture.numeroPiece,
                            date: ecriture.dateOperation,
                            libelle: ecriture.libelle,
                            reference: ecriture.reference,
                            numeroFacture: ecriture.numeroFacture,
                            lignes: ecriture.lignes.map(ligne => ({
                                compte: ligne.compte,
                                libelle: ligne.libelle,
                                tiers: ligne.tiers,
                                debit: parseFloat(ligne.debit || 0),
                                credit: parseFloat(ligne.credit || 0)
                            }))
                        };
                        
                        mouvements.push(ecritureMouvements);
                    });
                }
                
                // Trier par date
                mouvements.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                this.addActivity({
                    type: 'view',
                    module: 'journaux',
                    description: `Consultation du journal ${code === 'all' ? 'centralisateur' : code}`,
                    timestamp: new Date().toISOString()
                });
                
                // Calculer les totaux
                let totalDebit = 0;
                let totalCredit = 0;
                
                mouvements.forEach(mouvement => {
                    mouvement.lignes.forEach(ligne => {
                        totalDebit += ligne.debit;
                        totalCredit += ligne.credit;
                    });
                });
                
                return {
                    code,
                    mouvements,
                    totaux: {
                        debit: totalDebit,
                        credit: totalCredit
                    }
                };
            }
            
            // Méthode pour générer les données du bilan
            getBilan(date, type = 'comptable', options = {}) {
                const { comparatif = false, format = 'standard' } = options;
                
                // Récupérer les données de la balance générale à la date spécifiée
                const balance = this.getBalanceGenerale(null, date);
                
                // Structure du bilan selon le type
                let structureBilan = {};
                
                if (type === 'comptable') {
                    structureBilan = {
                        actif: {
                            immobilisations: {
                                titre: "Immobilisations",
                                comptes: ['2'],
                                montant: 0
                            },
                            stocks: {
                                titre: "Stocks",
                                comptes: ['3'],
                                montant: 0
                            },
                            creances: {
                                titre: "Créances",
                                comptes: ['4'],
                                montant: 0
                            },
                            tresorerie: {
                                titre: "Trésorerie",
                                comptes: ['5'],
                                montant: 0
                            }
                        },
                        passif: {
                            capitauxPropres: {
                                titre: "Capitaux propres",
                                comptes: ['1'],
                                montant: 0
                            },
                            dettesFinancieres: {
                                titre: "Dettes financières",
                                comptes: ['16'],
                                montant: 0
                            },
                            dettesFournisseurs: {
                                titre: "Dettes fournisseurs",
                                comptes: ['401'],
                                montant: 0
                            },
                            autresDettes: {
                                titre: "Autres dettes",
                                comptes: ['4'],
                                exceptions: ['401'],
                                montant: 0
                            }
                        }
                    };
                } else if (type === 'fonctionnel') {
                    // Structure du bilan fonctionnel
                    structureBilan = {
                        actif: {
                            actifImmobilise: {
                                titre: "Actif immobilisé",
                                comptes: ['2'],
                                montant: 0
                            },
                            actifCirculant: {
                                titre: "Actif circulant d'exploitation",
                                comptes: ['3', '401', '411'],
                                montant: 0
                            },
                            tresorerie: {
                                titre: "Trésorerie active",
                                comptes: ['5'],
                                montant: 0
                            }
                        },
                        passif: {
                            ressourcesPermanentes: {
                                titre: "Ressources permanentes",
                                comptes: ['1', '16'],
                                montant: 0
                            },
                            passifCirculant: {
                                titre: "Passif circulant d'exploitation",
                                comptes: ['401', '43', '44'],
                                montant: 0
                            },
                            tresorieDette: {
                                titre: "Trésorerie passive",
                                comptes: ['519'],
                                montant: 0
                            }
                        }
                    };
                } else if (type === 'financier') {
                    // Structure du bilan financier
                    structureBilan = {
                        actif: {
                            valeursBrutes: {
                                titre: "Valeurs brutes",
                                comptes: ['2'],
                                montant: 0
                            },
                            amortissements: {
                                titre: "Amortissements",
                                comptes: ['28'],
                                montant: 0,
                                signe: -1
                            },
                            actifCirculant: {
                                titre: "Actif circulant",
                                comptes: ['3', '4'],
                                montant: 0
                            },
                            tresorerie: {
                                titre: "Trésorerie",
                                comptes: ['5'],
                                montant: 0
                            }
                        },
                        passif: {
                            capitauxPropres: {
                                titre: "Capitaux propres",
                                comptes: ['1'],
                                montant: 0
                            },
                            provisions: {
                                titre: "Provisions",
                                comptes: ['15'],
                                montant: 0
                            },
                            dettes: {
                                titre: "Dettes",
                                comptes: ['16', '17', '4', '5'],
                                exceptions: ['51'],
                                montant: 0
                            }
                        }
                    };
                }
                
                // Calculer les montants pour chaque section du bilan
                balance.comptes.forEach(compte => {
                    // Solde net du compte (débit - crédit)
                    const soldeNet = compte.soldeFinal.debit - compte.soldeFinal.credit;
                    
                    // Parcourir toutes les sections de l'actif
                    Object.values(structureBilan.actif).forEach(section => {
                        const compteMatchSection = section.comptes.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        // Vérifier les exceptions si elles existent
                        const estException = section.exceptions && section.exceptions.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        if (compteMatchSection && !estException) {
                            // Les comptes d'actif ont généralement un solde débiteur
                            const signe = section.signe || 1; // Par défaut, pas d'inversion de signe
                            section.montant += soldeNet * signe;
                        }
                    });
                    
                    // Parcourir toutes les sections du passif
                    Object.values(structureBilan.passif).forEach(section => {
                        const compteMatchSection = section.comptes.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        // Vérifier les exceptions si elles existent
                        const estException = section.exceptions && section.exceptions.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        if (compteMatchSection && !estException) {
                            // Les comptes de passif ont généralement un solde créditeur
                            const signe = section.signe || 1; // Par défaut, pas d'inversion de signe
                            section.montant += soldeNet * signe * -1; // On inverse pour faire apparaître les soldes créditeurs en positif
                        }
                    });
                });
                
                // Calculer les totaux
                const totalActif = Object.values(structureBilan.actif).reduce((sum, section) => sum + section.montant, 0);
                const totalPassif = Object.values(structureBilan.passif).reduce((sum, section) => sum + section.montant, 0);
                
                this.addActivity({
                    type: 'view',
                    module: 'bilan',
                    description: `Consultation du bilan ${type}`,
                    timestamp: new Date().toISOString()
                });
                
                return {
                    type,
                    date,
                    actif: structureBilan.actif,
                    passif: structureBilan.passif,
                    totalActif,
                    totalPassif
                };
            }
            
            // Méthode pour générer les données du compte de résultat
            getCompteResultat(dateDebut, dateFin, options = {}) {
                const { presentation = 'nature', niveau = 'standard', comparatif = false } = options;
                
                // Récupérer les données de la balance générale pour la période
                const balance = this.getBalanceGenerale(dateDebut, dateFin);
                
                // Structure du compte de résultat selon la présentation
                let structureResultat = {};
                
                if (presentation === 'nature') {
                    structureResultat = {
                        produits: {
                            ventesMarchandises: {
                                titre: "Ventes de marchandises",
                                comptes: ['707'],
                                montant: 0
                            },
                            productionVendue: {
                                titre: "Production vendue",
                                comptes: ['70'],
                                exceptions: ['707'],
                                montant: 0
                            },
                            productionStockee: {
                                titre: "Production stockée",
                                comptes: ['71'],
                                montant: 0
                            },
                            productionImmobilisee: {
                                titre: "Production immobilisée",
                                comptes: ['72'],
                                montant: 0
                            },
                            subventionsExploitation: {
                                titre: "Subventions d'exploitation",
                                comptes: ['74'],
                                montant: 0
                            },
                            autresProduits: {
                                titre: "Autres produits",
                                comptes: ['75', '79'],
                                montant: 0
                            },
                            produitsFianciers: {
                                titre: "Produits financiers",
                                comptes: ['76'],
                                montant: 0
                            },
                            produitsExceptionnels: {
                                titre: "Produits exceptionnels",
                                comptes: ['77'],
                                montant: 0
                            }
                        },
                        charges: {
                            achatsMarchandises: {
                                titre: "Achats de marchandises",
                                comptes: ['607'],
                                montant: 0
                            },
                            achatsMatieres: {
                                titre: "Achats de matières et autres appro.",
                                comptes: ['601', '602', '605'],
                                montant: 0
                            },
                            variationStocks: {
                                titre: "Variation de stocks",
                                comptes: ['603'],
                                montant: 0
                            },
                            autresAchats: {
                                titre: "Autres achats et charges externes",
                                comptes: ['61', '62'],
                                montant: 0
                            },
                            impotsTaxes: {
                                titre: "Impôts, taxes et versements assimilés",
                                comptes: ['63'],
                                montant: 0
                            },
                            chargesPersonnel: {
                                titre: "Charges de personnel",
                                comptes: ['64'],
                                montant: 0
                            },
                            amortissements: {
                                titre: "Dotations aux amortissements",
                                comptes: ['681'],
                                montant: 0
                            },
                            provisions: {
                                titre: "Dotations aux provisions",
                                comptes: ['681'],
                                exceptions: ['6811', '6812'],
                                montant: 0
                            },
                            autresCharges: {
                                titre: "Autres charges",
                                comptes: ['65'],
                                montant: 0
                            },
                            chargesFinancieres: {
                                titre: "Charges financières",
                                comptes: ['66'],
                                montant: 0
                            },
                            chargesExceptionnelles: {
                                titre: "Charges exceptionnelles",
                                comptes: ['67'],
                                montant: 0
                            },
                            impotsSurBenefices: {
                                titre: "Impôts sur les bénéfices",
                                comptes: ['69'],
                                montant: 0
                            }
                        }
                    };
                } else if (presentation === 'fonction') {
                    // Structure pour présentation par fonction
                    structureResultat = {
                        produits: {
                            chiffreAffaires: {
                                titre: "Chiffre d'affaires net",
                                comptes: ['70'],
                                montant: 0
                            },
                            autresProduits: {
                                titre: "Autres produits d'exploitation",
                                comptes: ['71', '72', '74', '75'],
                                montant: 0
                            },
                            produitsFianciers: {
                                titre: "Produits financiers",
                                comptes: ['76'],
                                montant: 0
                            },
                            produitsExceptionnels: {
                                titre: "Produits exceptionnels",
                                comptes: ['77'],
                                montant: 0
                            }
                        },
                        charges: {
                            coutProduction: {
                                titre: "Coût des ventes",
                                comptes: ['603', '607', '6032'],
                                montant: 0
                            },
                            chargesCommerciales: {
                                titre: "Charges commerciales",
                                // Ici devrait se trouver les comptes analytiques liés aux fonctions commerciales
                                comptes: [],
                                montant: 0
                            },
                            chargesAdministratives: {
                                titre: "Charges administratives",
                                // Ici devrait se trouver les comptes analytiques liés aux fonctions administratives
                                comptes: [],
                                montant: 0
                            },
                            chargesFinancieres: {
                                titre: "Charges financières",
                                comptes: ['66'],
                                montant: 0
                            },
                            chargesExceptionnelles: {
                                titre: "Charges exceptionnelles",
                                comptes: ['67'],
                                montant: 0
                            },
                            impotsSurBenefices: {
                                titre: "Impôts sur les bénéfices",
                                comptes: ['69'],
                                montant: 0
                            }
                        }
                    };
                }
                
                // Calculer les montants pour chaque section du compte de résultat
                balance.comptes.forEach(compte => {
                    // Montants des mouvements
                    const mouvementDebit = compte.mouvements.debit;
                    const mouvementCredit = compte.mouvements.credit;
                    
                    // Parcourir toutes les sections des produits
                    Object.values(structureResultat.produits).forEach(section => {
                        const compteMatchSection = section.comptes.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        // Vérifier les exceptions
                        const estException = section.exceptions && section.exceptions.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        if (compteMatchSection && !estException) {
                            // Les produits sont généralement au crédit
                            section.montant += mouvementCredit - mouvementDebit;
                        }
                    });
                    
                    // Parcourir toutes les sections des charges
                    Object.values(structureResultat.charges).forEach(section => {
                        const compteMatchSection = section.comptes.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        // Vérifier les exceptions
                        const estException = section.exceptions && section.exceptions.some(prefixe => compte.numero.startsWith(prefixe));
                        
                        if (compteMatchSection && !estException) {
                            // Les charges sont généralement au débit
                            section.montant += mouvementDebit - mouvementCredit;
                        }
                    });
                });
                
                // Calculer les totaux
                const totalProduits = Object.values(structureResultat.produits).reduce((sum, section) => sum + section.montant, 0);
                const totalCharges = Object.values(structureResultat.charges).reduce((sum, section) => sum + section.montant, 0);
                const resultatNet = totalProduits - totalCharges;
                
                this.addActivity({
                    type: 'view',
                    module: 'compte-resultat',
                    description: `Consultation du compte de résultat par ${presentation}`,
                    timestamp: new Date().toISOString()
                });
                
                return {
                    presentation,
                    niveau,
                    dateDebut,
                    dateFin,
                    produits: structureResultat.produits,
                    charges: structureResultat.charges,
                    totalProduits,
                    totalCharges,
                    resultatNet
                };
            }
            
            // Méthode pour générer les soldes intermédiaires de gestion (SIG)
            getSIG(dateDebut, dateFin, options = {}) {
                const { format = 'tableau', evolution = true, pourcentage = true, comparatif = true } = options;
                
                // Récupérer les données de la balance générale pour la période
                const balance = this.getBalanceGenerale(dateDebut, dateFin);
                
                // Si comparatif demandé, calculer aussi pour la période précédente de même durée
                let balanceComparative = null;
                if (comparatif) {
                    const dateDebutPrecedente = new Date(dateDebut);
                    const dateFinPrecedente = new Date(dateFin);
                    
                    // Calculer la durée de la période
                    const duree = new Date(dateFin) - new Date(dateDebut);
                    
                    // Reculer d'une période
                    dateDebutPrecedente.setTime(dateDebutPrecedente.getTime() - duree);
                    dateFinPrecedente.setTime(dateFinPrecedente.getTime() - duree);
                    
                    balanceComparative = this.getBalanceGenerale(dateDebutPrecedente.toISOString(), dateFinPrecedente.toISOString());
                }
                
                // Définir les SIG à calculer
                const sig = {
                    marge: {
                        titre: "Marge commerciale",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes) => {
                            const ventes = this.getSommeComptes(comptes, ['707'], 'credit');
                            const achats = this.getSommeComptes(comptes, ['607'], 'debit');
                            const variationStock = this.getSommeComptes(comptes, ['6037'], 'debit') - this.getSommeComptes(comptes, ['6037'], 'credit');
                            
                            return ventes - achats - variationStock;
                        }
                    },
                    production: {
                        titre: "Production de l'exercice",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes) => {
                            const vendue = this.getSommeComptes(comptes, ['70'], 'credit') - this.getSommeComptes(comptes, ['707'], 'credit');
                            const stockee = this.getSommeComptes(comptes, ['71'], 'credit') - this.getSommeComptes(comptes, ['71'], 'debit');
                            const immobilisee = this.getSommeComptes(comptes, ['72'], 'credit');
                            
                            return vendue + stockee + immobilisee;
                        }
                    },
                    valeurAjoutee: {
                        titre: "Valeur ajoutée",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes, sig) => {
                            const marge = sig.marge.montant;
                            const production = sig.production.montant;
                            const achats = this.getSommeComptes(comptes, ['601', '602', '604', '605', '606', '608', '609', '61', '62'], 'debit');
                            
                            return marge + production - achats;
                        }
                    },
                    ebe: {
                        titre: "Excédent brut d'exploitation",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes, sig) => {
                            const valeurAjoutee = sig.valeurAjoutee.montant;
                            const subventions = this.getSommeComptes(comptes, ['74'], 'credit');
                            const impots = this.getSommeComptes(comptes, ['63'], 'debit');
                            const charges = this.getSommeComptes(comptes, ['64'], 'debit');
                            
                            return valeurAjoutee + subventions - impots - charges;
                        }
                    },
                    resultatExploitation: {
                        titre: "Résultat d'exploitation",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes, sig) => {
                            const ebe = sig.ebe.montant;
                            const reprisesProv = this.getSommeComptes(comptes, ['781'], 'credit');
                            const autresProduits = this.getSommeComptes(comptes, ['75'], 'credit');
                            const dotationsAmort = this.getSommeComptes(comptes, ['681'], 'debit');
                            const autresCharges = this.getSommeComptes(comptes, ['65'], 'debit');
                            
                            return ebe + reprisesProv + autresProduits - dotationsAmort - autresCharges;
                        }
                    },
                    resultatFinancier: {
                        titre: "Résultat financier",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes) => {
                            const produits = this.getSommeComptes(comptes, ['76'], 'credit');
                            const charges = this.getSommeComptes(comptes, ['66'], 'debit');
                            
                            return produits - charges;
                        }
                    },
                    resultatCourant: {
                        titre: "Résultat courant avant impôts",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes, sig) => {
                            return sig.resultatExploitation.montant + sig.resultatFinancier.montant;
                        }
                    },
                    resultatExceptionnel: {
                        titre: "Résultat exceptionnel",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes) => {
                            const produits = this.getSommeComptes(comptes, ['77'], 'credit');
                            const charges = this.getSommeComptes(comptes, ['67'], 'debit');
                            
                            return produits - charges;
                        }
                    },
                    resultatNet: {
                        titre: "Résultat net",
                        montant: 0,
                        precedent: 0,
                        calcul: (comptes, sig) => {
                            const impots = this.getSommeComptes(comptes, ['695'], 'debit');
                            
                            return sig.resultatCourant.montant + sig.resultatExceptionnel.montant - impots;
                        }
                    }
                };
                
                // Calculer les SIG pour la période actuelle
                const comptesActuels = balance.comptes.map(c => ({
                    numero: c.numero,
                    mouvements: c.mouvements
                }));
                
                Object.keys(sig).forEach(key => {
                    sig[key].montant = sig[key].calcul(comptesActuels, sig);
                });
                
                // Calculer les SIG pour la période précédente si demandé
                if (comparatif && balanceComparative) {
                    const comptesPrecedents = balanceComparative.comptes.map(c => ({
                        numero: c.numero,
                        mouvements: c.mouvements
                    }));
                    
                    Object.keys(sig).forEach(key => {
                        sig[key].precedent = sig[key].calcul(comptesPrecedents, sig);
                    });
                }
                
                // Calculer les évolutions et pourcentages
                if (evolution || pourcentage) {
                    Object.keys(sig).forEach(key => {
                        // Calcul de l'évolution en valeur
                        sig[key].evolution = sig[key].montant - sig[key].precedent;
                        
                        // Calcul du pourcentage d'évolution
                        if (sig[key].precedent !== 0) {
                            sig[key].pourcentage = (sig[key].evolution / Math.abs(sig[key].precedent)) * 100;
                        } else {
                            sig[key].pourcentage = sig[key].montant !== 0 ? 100 : 0;
                        }
                    });
                }
                
                this.addActivity({
                    type: 'view',
                    module: 'sig',
                    description: `Consultation des soldes intermédiaires de gestion`,
                    timestamp: new Date().toISOString()
                });
                
                return {
                    format,
                    dateDebut,
                    dateFin,
                    sig,
                    afficherEvolution: evolution,
                    afficherPourcentage: pourcentage
                };
            }
            
            // Méthode utilitaire pour obtenir la somme des mouvements des comptes
            getSommeComptes(comptes, prefixes, type) {
                let somme = 0;
                
                comptes.forEach(compte => {
                    const matchPrefix = prefixes.some(prefix => compte.numero.startsWith(prefix));
                    
                    if (matchPrefix) {
                        if (type === 'debit') {
                            somme += compte.mouvements.debit;
                        } else if (type === 'credit') {
                            somme += compte.mouvements.credit;
                        }
                    }
                });
                
                return somme;
            }
            
            // Méthode pour obtenir le libellé d'un compte
            getCompteLibelle(numero) {
                const compte = this.data.comptes.find(c => c.numero === numero);
                return compte ? compte.libelle : numero;
            }
            
            // Méthode pour obtenir le nom d'un tiers
            getTiersNom(code) {
                const tiers = this.data.tiers.find(t => t.code === code);
                return tiers ? tiers.nom : code;
            }
            
            // Méthode pour ajouter une activité
            addActivity(activity) {
                this.data.activities.unshift(activity);
                // Limiter le nombre d'activités stockées
                if (this.data.activities.length > 200) {
                    this.data.activities = this.data.activities.slice(0, 200);
                }
                this.saveData();
            }
        }
        
        // Initialisation de la base de données
        const db = new Database();
        
        // Détection du mode sombre
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // Fonctions utilitaires
        function formatDate(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR');
        }
        
        function formatNumber(number) {
            if (number === null || number === undefined) return '0';
            return number.toLocaleString('fr-FR');
        }
        
        function formatCurrency(number, devise = 'FCFA') {
            if (number === null || number === undefined) return '0 ' + devise;
            return number.toLocaleString('fr-FR') + ' ' + devise;
        }
        
        // Gestion de l'authentification et de la sélection de l'entreprise
        document.addEventListener('DOMContentLoaded', function() {
            // Login Form
            const loginForm = document.getElementById('login-form');
            
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const identifier = document.getElementById('identifier').value;
                const password = document.getElementById('password').value;
                
                if (identifier === 'admin' && password === 'password') {
                    document.getElementById('login-error').classList.add('hidden');
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('company-selection-screen').style.display = 'flex';
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                }
            });
            
            // Company Selection
            const companyCards = document.querySelectorAll('.company-card');
            
            companyCards.forEach(card => {
                card.addEventListener('click', function() {
                    // Remove selection from all cards
                    companyCards.forEach(c => {
                        c.classList.remove('selected');
                        c.querySelector('.company-check').classList.add('invisible');
                    });
                    
                    // Add selection to clicked card
                    this.classList.add('selected');
                    this.querySelector('.company-check').classList.remove('invisible');
                });
            });
            
            // Confirm Company Selection
            document.getElementById('confirm-company-selection').addEventListener('click', function() {
                const selectedCompany = document.querySelector('.company-card.selected');
                if (selectedCompany) {
                    const companyId = selectedCompany.dataset.company;
                    db.setCurrentCompany(companyId);
                    
                    const companyName = selectedCompany.querySelector('h3').textContent;
                    document.getElementById('company-name-display').textContent = companyName;
                    
                    document.getElementById('company-selection-screen').style.display = 'none';
                    document.getElementById('main-app').style.display = 'flex';
                    
                    // Initialize the app
                    initializeApp();
                    
                    // Ouvrir le tableau de bord par défaut
                    showTabContent('tableau-bord');
                }
            });
            
            // Logout
            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('main-app').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
            });
        });
        
        // Fonction pour initialiser l'application
        function initializeApp() {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            const tabContents = document.querySelectorAll('.tab-content');
            const moduleNavItems = document.querySelectorAll('.module-nav-item');
            const sidebarCategories = document.querySelectorAll('.sidebar-category-header');
            
            // Charger les données initiales
            loadComptesGeneraux();
            loadTiers();
            loadJournaux();
            loadEcritures();
            loadFactures();
            loadModeleSaisie();
            loadSectionsAnalytiques();
            loadAxesAnalytiques();
            loadActivities();
            updateDashboardKPIs();
            initializeCharts();
            updateFiltresGrandLivre();
            initializeFiscalCalendar();
            
            // Tableau de bord
            document.getElementById('tableau-bord-btn').addEventListener('click', function() {
                showTabContent('tableau-bord');
                sidebarItems.forEach(i => i.classList.remove('active'));
                
                // Update KPIs and charts
                updateDashboardKPIs();
                updateCharts();
                loadActivities();
            });
            
            // Gestion des catégories du menu déroulant
            sidebarCategories.forEach(category => {
                category.addEventListener('click', function() {
                    const parent = this.parentElement;
                    parent.classList.toggle('open');
                });
            });
            
            // Navigation dans le menu
            sidebarItems.forEach(item => {
                item.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    
                    // Activer l'élément du menu
                    sidebarItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Afficher le contenu correspondant
                    showTabContent(target);
                    
                    // Fermer le menu mobile si ouvert
                    if (document.getElementById('sidebar').classList.contains('mobile-open')) {
                        toggleMobileMenu();
                    }
                });
            });
            
            // Fonction pour afficher un onglet
            window.showTabContent = function(tabId) {
                tabContents.forEach(tab => {
                    if (tab.id === tabId) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
            }
            
            // Navigation entre modules
            moduleNavItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Changement visuel de l'onglet actif
                    moduleNavItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Si ce n'est pas SKOMPTAB, afficher une alerte indiquant que le module est en développement
                    if (this.dataset.module !== 'skomptab' && this.id !== 'tableau-bord-btn') {
                        alert(`Le module ${this.dataset.module.toUpperCase()} est en cours de développement.`);
                    }
                });
            });
            
            // Menu mobile
            document.getElementById('mobile-menu-button').addEventListener('click', toggleMobileMenu);
            document.getElementById('mobile-sidebar-overlay').addEventListener('click', toggleMobileMenu);
            
            function toggleMobileMenu() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobile-sidebar-overlay');
                
                sidebar.classList.toggle('mobile-open');
                if (sidebar.classList.contains('mobile-open')) {
                    sidebar.classList.add('fixed', 'inset-0', 'z-50');
                    sidebar.classList.remove('hidden');
                    overlay.classList.remove('hidden');
                } else {
                    sidebar.classList.remove('fixed', 'inset-0', 'z-50');
                    sidebar.classList.add('hidden');
                    overlay.classList.add('hidden');
                }
            }
            
            // Gestion des modales
            setupModal('creer-compte', 'modal-creer-compte');
            setupModal('creer-tiers', 'modal-creer-tiers');
            setupModal('nouvelle-ecriture', 'modal-nouvelle-ecriture');
            setupModal('ajouter-journal', 'modal-ajouter-journal');
            setupModal('import-plan-comptable', 'modal-import-plan-comptable');
            setupModal('ajouter-facture', 'modal-ajouter-facture');
            
            function setupModal(buttonId, modalId) {
                const button = document.getElementById(`${buttonId}-btn`);
                const modal = document.getElementById(modalId);
                const closeButton = document.getElementById(`close-${modalId}`);
                const cancelButton = document.getElementById(`annuler-${buttonId}`);
                
                if (button && modal) {
                    button.addEventListener('click', () => {
                        modal.style.display = 'block';
                        document.body.style.overflow = 'hidden';
                    });
                    
                    if (closeButton) {
                        closeButton.addEventListener('click', () => {
                            modal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        });
                    }
                    
                    if (cancelButton) {
                        cancelButton.addEventListener('click', () => {
                            modal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        });
                    }
                    
                    window.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                        }
                    });
                }
            }
            
            // Gestion du formulaire de création de compte
            const formCreerCompte = document.getElementById('form-creer-compte');
            
            if (formCreerCompte) {
                formCreerCompte.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const numeroCompte = document.getElementById('new-compte-numero').value;
                    const libelleCompte = document.getElementById('new-compte-libelle').value;
                    const typeCompte = document.querySelector('input[name="type-compte"]:checked').value;
                    
                    // Vérifier si le compte existe déjà
                    const comptes = db.getComptes();
                    const compteExiste = comptes.some(c => c.numero === numeroCompte);
                    
                    if (compteExiste) {
                        alert("Ce numéro de compte existe déjà. Veuillez en choisir un autre.");
                        return;
                    }
                    
                    // Ajouter le compte
                    db.addCompte({
                        numero: numeroCompte,
                        libelle: libelleCompte,
                        type: typeCompte
                    });
                    
                    // Rafraîchir la liste des comptes
                    loadComptesGeneraux();
                    updateFiltresGrandLivre();
                    loadActivities();
                    
                    // Fermer la modale
                    document.getElementById('modal-creer-compte').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Vider le formulaire
                    formCreerCompte.reset();
                });
            }
            
            // Gestion du formulaire de création de tiers
            const formCreerTiers = document.getElementById('form-creer-tiers');
            
            if (formCreerTiers) {
                formCreerTiers.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const codeTiers = document.getElementById('new-tiers-code').value;
                    const nomTiers = document.getElementById('new-tiers-nom').value;
                    const typeTiers = document.querySelector('input[name="type-tiers"]:checked').value;
                    const compteTiers = document.getElementById('new-tiers-compte-collectif').value;
                    const contactTiers = document.getElementById('new-tiers-contact').value;
                    const adresseTiers = document.getElementById('new-tiers-adresse').value;
                    const telephoneTiers = document.getElementById('new-tiers-telephone').value;
                    const emailTiers = document.getElementById('new-tiers-email').value;
                    
                    // Vérifier si le tiers existe déjà
                    const tiers = db.getTiers();
                    const tiersExiste = tiers.some(t => t.code === codeTiers);
                    
                    if (tiersExiste) {
                        alert("Ce code tiers existe déjà. Veuillez en choisir un autre.");
                        return;
                    }
                    
                    // Ajouter le tiers
                    db.addTiers({
                        code: codeTiers,
                        nom: nomTiers,
                        type: typeTiers,
                        compte: compteTiers,
                        contact: contactTiers,
                        adresse: adresseTiers,
                        telephone: telephoneTiers,
                        email: emailTiers
                    });
                    
                    // Rafraîchir la liste des tiers
                    loadTiers();
                    loadActivities();
                    
                    // Fermer la modale
                    document.getElementById('modal-creer-tiers').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Vider le formulaire
                    formCreerTiers.reset();
                });
            }
            
            // Gestion du formulaire d'ajout de journal
            const formAjouterJournal = document.getElementById('form-ajouter-journal');
            
            if (formAjouterJournal) {
                // Remplir le select des comptes
                const comptesSelect = document.getElementById('new-journal-compte');
                const comptes = db.getComptes();
                
                comptesSelect.innerHTML = '<option value="" disabled selected>Sélectionnez un compte</option>';
                comptes.forEach(compte => {
                    const option = document.createElement('option');
                    option.value = compte.numero;
                    option.textContent = `${compte.numero} - ${compte.libelle}`;
                    comptesSelect.appendChild(option);
                });
                
                formAjouterJournal.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const code = document.getElementById('new-journal-code').value;
                    const nom = document.getElementById('new-journal-nom').value;
                    const type = document.getElementById('new-journal-type').value;
                    const compte = document.getElementById('new-journal-compte').value;
                    const devise = document.getElementById('new-journal-devise').value;
                    const description = document.getElementById('new-journal-description').value;
                    
                    // Vérifier si le code journal existe déjà
                    const journaux = db.getJournaux();
                    const journalExiste = journaux.some(j => j.code === code);
                    
                    if (journalExiste) {
                        alert("Ce code journal existe déjà. Veuillez en choisir un autre.");
                        return;
                    }
                    
                    // Ajouter le journal
                    db.addJournal({
                        code,
                        nom,
                        type,
                        compte,
                        devise,
                        description
                    });
                    
                    // Rafraîchir la liste des journaux
                    loadJournaux();
                    loadActivities();
                    
                    // Fermer la modale
                    document.getElementById('modal-ajouter-journal').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Vider le formulaire
                    formAjouterJournal.reset();
                });
            }
            
            // Gestion de l'ajout d'une facture
            const validerAjouterFacture = document.getElementById('valider-ajouter-facture');
            
            if (validerAjouterFacture) {
                // Remplir le select des tiers
                const tiersSelect = document.getElementById('facture-tiers');
                const tiers = db.getTiers();
                
                tiersSelect.innerHTML = '<option value="" disabled selected>Sélectionner un tiers</option>';
                tiers.forEach(t => {
                    const option = document.createElement('option');
                    option.value = t.code;
                    option.textContent = `${t.code} - ${t.nom}`;
                    tiersSelect.appendChild(option);
                });
                
                // Calcul automatique de la TVA et TTC
                const montantHtInput = document.getElementById('facture-montant-ht');
                const tauxTvaSelect = document.getElementById('facture-taux-tva');
                const montantTvaInput = document.getElementById('facture-montant-tva');
                const montantTtcInput = document.getElementById('facture-montant-ttc');
                
                function calculerTotaux() {
                    const montantHt = parseFloat(montantHtInput.value || 0);
                    const tauxTva = parseFloat(tauxTvaSelect.value || 0);
                    
                    const montantTva = montantHt * (tauxTva / 100);
                    const montantTtc = montantHt + montantTva;
                    
                    montantTvaInput.value = montantTva.toFixed(2);
                    montantTtcInput.value = montantTtc.toFixed(2);
                }
                
                montantHtInput.addEventListener('input', calculerTotaux);
                tauxTvaSelect.addEventListener('change', calculerTotaux);
                
                validerAjouterFacture.addEventListener('click', function() {
                    const typeDoc = document.querySelector('input[name="document-type"]:checked').value;
                    const numeroFacture = document.getElementById('facture-numero').value;
                    const dateFacture = document.getElementById('facture-date').value;
                    const dateEcheance = document.getElementById('facture-echeance').value;
                    const tiersCode = document.getElementById('facture-tiers').value;
                    const description = document.getElementById('facture-description').value;
                    const montantHt = parseFloat(document.getElementById('facture-montant-ht').value || 0);
                    const tauxTva = parseFloat(document.getElementById('facture-taux-tva').value || 0);
                    const montantTva = parseFloat(document.getElementById('facture-montant-tva').value || 0);
                    const montantTtc = parseFloat(document.getElementById('facture-montant-ttc').value || 0);
                    const devise = document.getElementById('facture-devise').value;
                    const comptabiliser = document.getElementById('facture-comptabiliser').checked;
                    
                    // Validation de base
                    if (!numeroFacture || !dateFacture || !tiersCode || montantHt <= 0) {
                        alert("Veuillez remplir tous les champs obligatoires.");
                        return;
                    }
                    
                    // Créer la facture numérisée
                    const facture = {
                        type: typeDoc,
                        numero: numeroFacture,
                        date: dateFacture,
                        echeance: dateEcheance,
                        tiers: tiersCode,
                        description: description,
                        montantHt: montantHt,
                        tauxTva: tauxTva,
                        montantTva: montantTva,
                        montantTtc: montantTtc,
                        devise: devise,
                        fichier: null, // URL du fichier importé
                        dateCreation: new Date().toISOString(),
                        ecriture: null // ID de l'écriture liée
                    };
                    
                    // Ajouter la facture
                    const nouvelleFacture = db.addFacture(facture);
                    
                    // Si comptabilisation automatique demandée
                    if (comptabiliser) {
                        // Déterminer le journal et les comptes selon le type de document
                        let journalCode, compteDebit, compteCredit, compteCompteTva;
                        
                        if (typeDoc === 'facture-fournisseur') {
                            journalCode = 'AC'; // Journal des achats
                            compteDebit = '602100'; // Compte de charge par défaut
                            compteCredit = '401000'; // Compte fournisseur
                            compteCompteTva = '445660'; // TVA déductible
                        } else {
                            journalCode = 'VE'; // Journal des ventes
                            compteDebit = '411000'; // Compte client
                            compteCredit = '707000'; // Compte de produit par défaut
                            compteCompteTva = '445670'; // TVA collectée
                        }
                        
                        // Créer les lignes d'écriture
                        const lignes = [];
                        
                        if (typeDoc === 'facture-fournisseur') {
                            // Débit du compte de charge (montant HT)
                            lignes.push({
                                compte: compteDebit,
                                tiers: '',
                                libelle: `Achat ${description || 'divers'}`,
                                debit: montantHt,
                                credit: 0,
                                echeance: ''
                            });
                            
                            // Débit du compte de TVA si applicable
                            if (montantTva > 0) {
                                lignes.push({
                                    compte: compteCompteTva,
                                    tiers: '',
                                    libelle: `TVA ${tauxTva}% sur ${numeroFacture}`,
                                    debit: montantTva,
                                    credit: 0,
                                    echeance: ''
                                });
                            }
                            
                            // Crédit du compte fournisseur (montant TTC)
                            lignes.push({
                                compte: compteCredit,
                                tiers: tiersCode,
                                libelle: `Facture ${numeroFacture} ${description || ''}`,
                                debit: 0,
                                credit: montantTtc,
                                echeance: dateEcheance
                            });
                        } else {
                            // Débit du compte client (montant TTC)
                            lignes.push({
                                compte: compteDebit,
                                tiers: tiersCode,
                                libelle: `Facture ${numeroFacture} ${description || ''}`,
                                debit: montantTtc,
                                credit: 0,
                                echeance: dateEcheance
                            });
                            
                            // Crédit du compte de produit (montant HT)
                            lignes.push({
                                compte: compteCredit,
                                tiers: '',
                                libelle: `Vente ${description || 'divers'}`,
                                debit: 0,
                                credit: montantHt,
                                echeance: ''
                            });
                            
                            // Crédit du compte de TVA si applicable
                            if (montantTva > 0) {
                                lignes.push({
                                    compte: compteCompteTva,
                                    tiers: '',
                                    libelle: `TVA ${tauxTva}% sur ${numeroFacture}`,
                                    debit: 0,
                                    credit: montantTva,
                                    echeance: ''
                                });
                            }
                        }
                        
                        // Créer l'écriture comptable
                        const ecriture = {
                            journal: journalCode,
                            dateOperation: dateFacture,
                            reference: numeroFacture,
                            numeroFacture: numeroFacture,
                            libelle: description || `Facture ${numeroFacture}`,
                            devise: devise,
                            lignes: lignes
                        };
                        
                        const nouvelleEcriture = db.addEcriture(ecriture);
                        
                        // Mettre à jour la facture avec l'ID de l'écriture
                        db.updateFacture(nouvelleFacture.id, { ecriture: nouvelleEcriture.id });
                        
                        // Rafraîchir la liste des écritures
                        loadEcritures();
                    }
                    
                    // Rafraîchir la liste des factures
                    loadFactures();
                    loadActivities();
                    
                    // Fermer la modale
                    document.getElementById('modal-ajouter-facture').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Vider le formulaire
                    document.getElementById('form-ajouter-facture').reset();
                    document.getElementById('facture-preview').classList.add('hidden');
                });
            }
            
            // Gestion du formulaire de sélection de journal
            if (document.getElementById('valider-nouvelle-ecriture')) {
                // Remplir le select des journaux
                const journauxSelect = document.getElementById('selection-journal');
                const journaux = db.getJournaux();
                
                journauxSelect.innerHTML = '<option value="" disabled selected>Sélectionnez un journal</option>';
                journaux.forEach(journal => {
                    const option = document.createElement('option');
                    option.value = journal.code;
                    option.textContent = `${journal.code} - ${journal.nom}`;
                    journauxSelect.appendChild(option);
                });
                
                // Remplir le select des modèles de saisie
                const modelesSelect = document.getElementById('selection-modele-saisie');
                const modeles = db.getModeleSaisie();
                
                modelesSelect.innerHTML = '<option value="">Aucun modèle</option>';
                modeles.forEach(modele => {
                    const option = document.createElement('option');
                    option.value = modele.id;
                    option.textContent = `${modele.code} - ${modele.libelle}`;
                    modelesSelect.appendChild(option);
                });
                
                document.getElementById('valider-nouvelle-ecriture').addEventListener('click', function() {
                    const journal = document.getElementById('selection-journal').value;
                    const mois = document.getElementById('selection-mois').value;
                    const annee = document.getElementById('selection-annee').value;
                    const modeleId = document.getElementById('selection-modele-saisie').value;
                    
                    if (!journal) {
                        alert("Veuillez sélectionner un journal.");
                        return;
                    }
                    
                    // Fermer la modale de sélection
                    document.getElementById('modal-nouvelle-ecriture').style.display = 'none';
                    
                    // Ouvrir la modale de saisie
                    document.getElementById('modal-saisie-ecriture').style.display = 'block';
                    
                    // Initialiser la date par défaut
                    const today = new Date();
                    const defaultDate = `${annee}-${mois}-${String(today.getDate()).padStart(2, '0')}`;
                    document.getElementById('saisie-date').value = defaultDate;
                    
                    // Marquer le journal sélectionné
                    document.getElementById('form-saisie-ecriture').dataset.journal = journal;
                    
                    // Mettre à jour la devise selon le journal
                    const journalObj = journaux.find(j => j.code === journal);
                    if (journalObj) {
                        document.getElementById('saisie-devise').value = journalObj.devise;
                        document.getElementById('solde-devise').textContent = journalObj.devise;
                    }
                    
                    // Remplir les selects de comptes et tiers dans les lignes d'écriture
                    remplirSelectsEcriture();
                    
                    // Si un modèle de saisie est sélectionné, pre-remplir les lignes
                    if (modeleId) {
                        preRemplirModele(modeleId);
                    }
                });
            }
            
            function remplirSelectsEcriture() {
                const compteSelects = document.querySelectorAll('.ligne-compte');
                const comptes = db.getComptes();
                const tiersSelects = document.querySelectorAll('.ligne-tiers');
                const tiers = db.getTiers();
                
                compteSelects.forEach(select => {
                    select.innerHTML = '<option value="">Sélectionnez un compte</option>';
                    comptes.forEach(compte => {
                        const option = document.createElement('option');
                        option.value = compte.numero;
                        option.textContent = `${compte.numero} - ${compte.libelle}`;
                        select.appendChild(option);
                    });
                });
                
                tiersSelects.forEach(select => {
                    select.innerHTML = '<option value="">Sélectionnez un tiers</option>';
                    tiers.forEach(t => {
                        const option = document.createElement('option');
                        option.value = t.code;
                        option.textContent = `${t.code} - ${t.nom}`;
                        select.appendChild(option);
                    });
                });
            }
            
            function preRemplirModele(modeleId) {
                const modeles = db.getModeleSaisie();
                const modele = modeles.find(m => m.id == modeleId);
                
                if (!modele) return;
                
                // Mettre à jour l'horodatage de dernière utilisation
                db.updateModeleSaisie(modeleId, { derniereUtilisation: new Date().toISOString() });
                
                const defaultRows = document.querySelectorAll('.default-row');
                
                // Supprimer les lignes supplémentaires existantes
                const additionalRows = document.querySelectorAll('#lignes-ecriture tr:not(.default-row)');
                additionalRows.forEach(row => row.remove());
                
                // Ajouter des lignes supplémentaires si nécessaire
                const additionalLinesNeeded = Math.max(0, modele.lignes.length - defaultRows.length);
                for (let i = 0; i < additionalLinesNeeded; i++) {
                    document.getElementById('ajouter-ligne').click();
                }
                
                // Maintenant, remplir toutes les lignes
                const allRows = document.querySelectorAll('#lignes-ecriture tr');
                modele.lignes.forEach((ligne, index) => {
                    if (index < allRows.length) {
                        const row = allRows[index];
                        row.querySelector('.ligne-compte').value = ligne.compte;
                        
                        const tiersSelect = row.querySelector('.ligne-tiers');
                        if (tiersSelect.tagName === 'SELECT') {
                            tiersSelect.value = ligne.tiers || '';
                        } else {
                            tiersSelect.value = ligne.tiers || '';
                        }
                        
                        row.querySelector('.ligne-libelle').value = ligne.libelle || '';
                        row.querySelector('.ligne-debit').value = ligne.debit || '';
                        row.querySelector('.ligne-credit').value = ligne.credit || '';
                    }
                });
                
                // Mettre à jour le solde
                updateSolde();
            }
            
            if (document.getElementById('fermer-saisie-ecriture')) {
                document.getElementById('fermer-saisie-ecriture').addEventListener('click', function() {
                    document.getElementById('modal-saisie-ecriture').style.display = 'none';
                    document.body.style.overflow = 'auto';
                });
            }
            
            if (document.getElementById('close-modal-saisie-ecriture')) {
                document.getElementById('close-modal-saisie-ecriture').addEventListener('click', function() {
                    document.getElementById('modal-saisie-ecriture').style.display = 'none';
                    document.body.style.overflow = 'auto';
                });
            }
            
            // Ajouter une ligne dans le formulaire de saisie d'écriture
            if (document.getElementById('ajouter-ligne')) {
                document.getElementById('ajouter-ligne').addEventListener('click', function() {
                    const tbody = document.getElementById('lignes-ecriture');
                    const comptes = db.getComptes();
                    const tiers = db.getTiers();
                    
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td class="px-4 py-2">
                            <select class="ligne-compte w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <option value="">Sélectionnez un compte</option>
                                ${comptes.map(compte => `<option value="${compte.numero}">${compte.numero} - ${compte.libelle}</option>`).join('')}
                            </select>
                        </td>
                        <td class="px-4 py-2">
                            <select class="ligne-tiers w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                                <option value="">Sélectionnez un tiers</option>
                                ${tiers.map(t => `<option value="${t.code}">${t.code} - ${t.nom}</option>`).join('')}
                            </select>
                        </td>
                        <td class="px-4 py-2">
                            <input type="text" class="ligne-libelle w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                        </td>
                        <td class="px-4 py-2">
                            <input type="date" class="ligne-echeance w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                        </td>
                        <td class="px-4 py-2">
                            <input type="number" class="ligne-debit w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                        </td>
                        <td class="px-4 py-2">
                            <input type="number" class="ligne-credit w-full border border-[var(--border-color)] rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)] bg-[var(--bg-color)]">
                        </td>
                        <td class="px-4 py-2">
                            <button type="button" class="text-red-600 hover:text-red-900 delete-ligne">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(newRow);
                    
                    // Ajouter l'événement de suppression à la nouvelle ligne
                    const deleteButton = newRow.querySelector('.delete-ligne');
                    deleteButton.addEventListener('click', function() {
                        newRow.remove();
                        updateSolde();
                    });
                    
                    // Ajouter les événements pour mettre à jour le solde
                    const inputs = newRow.querySelectorAll('input[type="number"]');
                    inputs.forEach(input => {
                        input.addEventListener('input', updateSolde);
                    });
                });
                
                // Ajouter les événements de suppression aux lignes existantes
                document.querySelectorAll('.delete-ligne').forEach(button => {
                    button.addEventListener('click', function() {
                        if (!this.closest('tr').classList.contains('default-row')) {
                            this.closest('tr').remove();
                            updateSolde();
                        }
                    });
                });
                
                // Ajouter les événements pour mettre à jour le solde
                document.querySelectorAll('#lignes-ecriture input[type="number"]').forEach(input => {
                    input.addEventListener('input', updateSolde);
                });
                
                // Fonction pour mettre à jour le solde
                function updateSolde() {
                    let totalDebit = 0;
                    let totalCredit = 0;
                    
                    // Calculer le total des débits
                    document.querySelectorAll('#lignes-ecriture tr').forEach(row => {
                        const debitInput = row.querySelector('.ligne-debit');
                        const creditInput = row.querySelector('.ligne-credit');
                        
                        if (debitInput && debitInput.value) {
                            totalDebit += parseFloat(debitInput.value);
                        }
                        
                        if (creditInput && creditInput.value) {
                            totalCredit += parseFloat(creditInput.value);
                        }
                    });
                    
                    const solde = totalDebit - totalCredit;
                    document.getElementById('solde-ecriture').textContent = solde.toFixed(2);
                    
                    // Changer la couleur du solde en fonction de son signe
                    if (solde === 0) {
                        document.getElementById('solde-ecriture').classList.remove('text-red-600', 'dark:text-red-400');
                        document.getElementById('solde-ecriture').classList.add('text-green-600', 'dark:text-green-400');
                    } else {
                        document.getElementById('solde-ecriture').classList.remove('text-green-600', 'dark:text-green-400');
                        document.getElementById('solde-ecriture').classList.add('text-red-600', 'dark:text-red-400');
                    }
                }
                
                // Sauvegarde de l'écriture
                document.getElementById('sauvegarder-ecriture').addEventListener('click', function() {
                    // Vérifier si le solde est à zéro
                    const solde = parseFloat(document.getElementById('solde-ecriture').textContent);
                    
                    if (solde !== 0) {
                        alert("L'écriture n'est pas équilibrée. Le solde doit être égal à zéro.");
                        return;
                    }
                    
                    // Récupérer les informations de l'écriture
                    const journal = document.getElementById('form-saisie-ecriture').dataset.journal;
                    const dateOperation = document.getElementById('saisie-date').value;
                    const reference = document.getElementById('saisie-reference').value;
                    const numeroFacture = document.getElementById('saisie-facture').value;
                    const libelle = document.getElementById('saisie-libelle-global').value;
                    const devise = document.getElementById('saisie-devise').value;
                    
                    // Récupérer les lignes
                    const lignes = [];
                    document.querySelectorAll('#lignes-ecriture tr').forEach(row => {
                        const compte = row.querySelector('.ligne-compte').value;
                        
                        // Récupérer le tiers (qui peut être dans un select ou un input)
                        let tiers = '';
                        const tiersElement = row.querySelector('.ligne-tiers');
                        if (tiersElement.tagName === 'SELECT') {
                            tiers = tiersElement.value;
                        } else {
                            tiers = tiersElement.value;
                        }
                        
                        const libelle = row.querySelector('.ligne-libelle').value;
                        const echeance = row.querySelector('.ligne-echeance').value;
                        const debit = row.querySelector('.ligne-debit').value;
                        const credit = row.querySelector('.ligne-credit').value;
                        
                        if (compte) {
                            lignes.push({
                                compte,
                                tiers,
                                libelle,
                                echeance,
                                debit: debit || 0,
                                credit: credit || 0
                            });
                        }
                    });
                    
                    // Vérifier qu'il y a au moins une ligne
                    if (lignes.length === 0) {
                        alert("Veuillez remplir au moins une ligne d'écriture.");
                        return;
                    }
                    
                    // Ajouter l'écriture à la base de données
                    db.addEcriture({
                        journal,
                        dateOperation,
                        reference,
                        numeroFacture,
                        libelle,
                        devise,
                        lignes
                    });
                    
                    // Rafraîchir la liste des écritures
                    loadEcritures();
                    loadActivities();
                    updateDashboardKPIs();
                    updateCharts();
                    
                    // Fermer la modale
                    document.getElementById('modal-saisie-ecriture').style.display = 'none';
                    document.body.style.overflow = 'auto';
                    
                    // Vider le formulaire (sauf les lignes par défaut)
                    document.getElementById('saisie-date').value = '';
                    document.getElementById('saisie-reference').value = '';
                    document.getElementById('saisie-facture').value = '';
                    document.getElementById('saisie-libelle-global').value = '';
                    
                    // Vider les lignes par défaut
                    document.querySelectorAll('#lignes-ecriture tr.default-row').forEach(row => {
                        row.querySelector('.ligne-compte').value = '';
                        if (row.querySelector('.ligne-tiers').tagName === 'SELECT') {
                            row.querySelector('.ligne-tiers').value = '';
                        } else {
                            row.querySelector('.ligne-tiers').value = '';
                        }
                        row.querySelector('.ligne-libelle').value = '';
                        row.querySelector('.ligne-echeance').value = '';
                        row.querySelector('.ligne-debit').value = '';
                        row.querySelector('.ligne-credit').value = '';
                    });
                    
                    // Supprimer les lignes ajoutées
                    document.querySelectorAll('#lignes-ecriture tr:not(.default-row)').forEach(row => {
                        row.remove();
                    });
                    
                    // Réinitialiser le solde
                    document.getElementById('solde-ecriture').textContent = '0.00';
                    document.getElementById('solde-ecriture').classList.remove('text-red-600', 'dark:text-red-400');
                    document.getElementById('solde-ecriture').classList.add('text-green-600', 'dark:text-green-400');
                });
            }
            
            // Gestion de l'affichage des grands livres
            if (document.getElementById('valider-grand-livre')) {
                document.getElementById('valider-grand-livre').addEventListener('click', function() {
                    const compte = document.getElementById('grand-livre-compte').value;
                    const dateDebut = document.getElementById('grand-livre-date-debut').value;
                    const dateFin = document.getElementById('grand-livre-date-fin').value;
                    
                    if (!compte) {
                        alert("Veuillez sélectionner un compte.");
                        return;
                    }
                    
                    // Récupérer les informations du grand livre
                    const grandLivre = db.getGrandLivre(compte, dateDebut, dateFin);
                    
                    // Mettre à jour l'affichage
                    document.getElementById('grand-livre-compte-title').textContent = `${compte} - ${db.getCompteLibelle(compte)}`;
                    document.getElementById('grand-livre-periode-debut').textContent = formatDate(dateDebut || '2024-01-01');
                    document.getElementById('grand-livre-periode-fin').textContent = formatDate(dateFin || new Date().toISOString().split('T')[0]);
                    document.getElementById('grand-livre-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le tableau des mouvements
                    const tbody = document.getElementById('grand-livre-mouvements');
                    tbody.innerHTML = '';
                    
                    if (grandLivre.mouvements.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td colspan="7" class="px-3 py-4 text-center text-gray-500">Aucun mouvement pour ce compte dans la période sélectionnée</td>
                        `;
                        tbody.appendChild(tr);
                    } else {
                        grandLivre.mouvements.forEach(mvt => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td class="px-3 py-2 text-sm">${formatDate(mvt.date)}</td>
                                <td class="px-3 py-2 text-sm">${mvt.numeroPiece}</td>
                                <td class="px-3 py-2 text-sm">${mvt.journal}</td>
                                <td class="px-3 py-2 text-sm">${mvt.libelle}</td>
                                <td class="px-3 py-2 text-sm">${mvt.debit > 0 ? formatNumber(mvt.debit) : ''}</td>
                                <td class="px-3 py-2 text-sm">${mvt.credit > 0 ? formatNumber(mvt.credit) : ''}</td>
                                <td class="px-3 py-2 text-sm">${formatNumber(mvt.solde)}</td>
                            `;
                            tbody.appendChild(tr);
                        });
                        
                        // Ajouter la ligne des totaux
                        const trTotal = document.createElement('tr');
                        trTotal.classList.add('bg-[var(--hover-color)]', 'font-semibold');
                        trTotal.innerHTML = `
                            <td class="px-3 py-2 text-sm" colspan="4">Total du compte</td>
                            <td class="px-3 py-2 text-sm">${formatNumber(grandLivre.totaux.debit)}</td>
                            <td class="px-3 py-2 text-sm">${formatNumber(grandLivre.totaux.credit)}</td>
                            <td class="px-3 py-2 text-sm">${formatNumber(grandLivre.totaux.solde)}</td>
                        `;
                        tbody.appendChild(trTotal);
                    }
                    
                    // Afficher le grand livre
                    document.getElementById('resultat-grand-livre').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-grand-livre').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage des grands livres tiers
            if (document.getElementById('valider-grand-livre-tiers')) {
                // Remplir le select des tiers
                const tiersSelect = document.getElementById('grand-livre-tiers-compte');
                const tiers = db.getTiers();
                
                tiersSelect.innerHTML = '<option value="">-- Sélectionnez un tiers --</option>';
                tiers.forEach(t => {
                    const option = document.createElement('option');
                    option.value = t.code;
                    option.textContent = `${t.code} - ${t.nom}`;
                    tiersSelect.appendChild(option);
                });
                
                document.getElementById('valider-grand-livre-tiers').addEventListener('click', function() {
                    const tiersCode = document.getElementById('grand-livre-tiers-compte').value;
                    const dateDebut = document.getElementById('grand-livre-tiers-date-debut').value;
                    const dateFin = document.getElementById('grand-livre-tiers-date-fin').value;
                    
                    if (!tiersCode) {
                        alert("Veuillez sélectionner un tiers.");
                        return;
                    }
                    
                    // Récupérer les informations du grand livre tiers
                    const grandLivreTiers = db.getGrandLivreTiers(tiersCode, dateDebut, dateFin);
                    
                    // Mettre à jour l'affichage
                    const tiersObj = tiers.find(t => t.code === tiersCode);
                    const tiersNom = tiersObj ? tiersObj.nom : tiersCode;
                    
                    document.getElementById('grand-livre-tiers-title').textContent = `Tiers: ${tiersCode} - ${tiersNom}`;
                    document.getElementById('grand-livre-tiers-periode-debut').textContent = formatDate(dateDebut || '2024-01-01');
                    document.getElementById('grand-livre-tiers-periode-fin').textContent = formatDate(dateFin || new Date().toISOString().split('T')[0]);
                    document.getElementById('grand-livre-tiers-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le tableau des mouvements
                    const tbody = document.getElementById('grand-livre-tiers-mouvements');
                    tbody.innerHTML = '';
                    
                    if (grandLivreTiers.mouvements.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td colspan="9" class="px-3 py-4 text-center text-gray-500">Aucun mouvement pour ce tiers dans la période sélectionnée</td>
                        `;
                        tbody.appendChild(tr);
                    } else {
                        grandLivreTiers.mouvements.forEach(mvt => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td class="px-3 py-2 text-sm">${formatDate(mvt.date)}</td>
                                <td class="px-3 py-2 text-sm">${mvt.numeroPiece}</td>
                                <td class="px-3 py-2 text-sm">${mvt.journal}</td>
                                <td class="px-3 py-2 text-sm">${mvt.compte}</td>
                                <td class="px-3 py-2 text-sm">${mvt.libelle}</td>
                                <td class="px-3 py-2 text-sm">${mvt.reference}</td>
                                <td class="px-3 py-2 text-sm">${mvt.debit > 0 ? formatNumber(mvt.debit) : ''}</td>
                                <td class="px-3 py-2 text-sm">${mvt.credit > 0 ? formatNumber(mvt.credit) : ''}</td>
                                <td class="px-3 py-2 text-sm">${formatNumber(mvt.solde)}</td>
                            `;
                            tbody.appendChild(tr);
                        });
                        
                        // Ajouter la ligne des totaux
                        const trTotal = document.createElement('tr');
                        trTotal.classList.add('bg-[var(--hover-color)]', 'font-semibold');
                        trTotal.innerHTML = `
                            <td class="px-3 py-2 text-sm" colspan="6">Total du tiers</td>
                            <td class="px-3 py-2 text-sm">${formatNumber(grandLivreTiers.totaux.debit)}</td>
                            <td class="px-3 py-2 text-sm">${formatNumber(grandLivreTiers.totaux.credit)}</td>
                            <td class="px-3 py-2 text-sm">${formatNumber(grandLivreTiers.totaux.solde)}</td>
                        `;
                        tbody.appendChild(trTotal);
                    }
                    
                    // Afficher le grand livre tiers
                    document.getElementById('resultat-grand-livre-tiers').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-grand-livre-tiers').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage de la balance générale
            if (document.getElementById('valider-balance-generale')) {
                document.getElementById('valider-balance-generale').addEventListener('click', function() {
                    const dateDebut = document.getElementById('balance-date-debut').value;
                    const dateFin = document.getElementById('balance-date-fin').value;
                    const afficherMouvementes = document.getElementById('balance-comptes-mouvementes').checked;
                    const inclureSoldes = document.getElementById('balance-inclure-comptes-soldés').checked;
                    const niveau = document.getElementById('balance-niveau-detail').value;
                    
                    // Récupérer les informations de la balance
                    const balance = db.getBalanceGenerale(dateDebut, dateFin, {
                        afficherMouvementes,
                        inclureSoldes,
                        niveau
                    });
                    
                    // Mettre à jour l'affichage
                    document.getElementById('balance-periode-debut').textContent = formatDate(dateDebut || '2024-01-01');
                    document.getElementById('balance-periode-fin').textContent = formatDate(dateFin || new Date().toISOString().split('T')[0]);
                    document.getElementById('balance-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le tableau des mouvements
                    const tbody = document.getElementById('balance-generale-mouvements');
                    tbody.innerHTML = '';
                    
                    if (balance.comptes.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td colspan="8" class="px-3 py-4 text-center text-gray-500">Aucun compte ne correspond aux critères sélectionnés</td>
                        `;
                        tbody.appendChild(tr);
                    } else {
                        balance.comptes.forEach(compte => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td class="px-3 py-2 text-sm">${compte.numero}</td>
                                <td class="px-3 py-2 text-sm">${compte.libelle}</td>
                                <td class="px-3 py-2 text-sm text-right">${compte.soldeInitial.debit > 0 ? formatNumber(compte.soldeInitial.debit) : ''}</td>
                                <td class="px-3 py-2 text-sm text-right">${compte.soldeInitial.credit > 0 ? formatNumber(compte.soldeInitial.credit) : ''}</td>
                                <td class="px-3 py-2 text-sm text-right">${compte.mouvements.debit > 0 ? formatNumber(compte.mouvements.debit) : ''}</td>
                                <td class="px-3 py-2 text-sm text-right">${compte.mouvements.credit > 0 ? formatNumber(compte.mouvements.credit) : ''}</td>
                                <td class="px-3 py-2 text-sm text-right">${compte.soldeFinal.debit > 0 ? formatNumber(compte.soldeFinal.debit) : ''}</td>
                                <td class="px-3 py-2 text-sm text-right">${compte.soldeFinal.credit > 0 ? formatNumber(compte.soldeFinal.credit) : ''}</td>
                            `;
                            tbody.appendChild(tr);
                        });
                        
                        // Ajouter la ligne des totaux
                        const trTotal = document.createElement('tr');
                        trTotal.classList.add('bg-[var(--hover-color)]', 'font-semibold');
                        trTotal.innerHTML = `
                            <td class="px-3 py-2 text-sm" colspan="2">Totaux</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balance.totaux.soldeInitial.debit)}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balance.totaux.soldeInitial.credit)}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balance.totaux.mouvements.debit)}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balance.totaux.mouvements.credit)}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balance.totaux.soldeFinal.debit)}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balance.totaux.soldeFinal.credit)}</td>
                        `;
                        tbody.appendChild(trTotal);
                    }
                    
                    // Afficher la balance
                    document.getElementById('resultat-balance-generale').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-balance-generale').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage de la balance âgée
            if (document.getElementById('valider-balance-agee')) {
                // Remplir le select des tiers
                const tiersSelect = document.getElementById('balance-agee-tiers');
                const tiers = db.getTiers();
                
                tiersSelect.innerHTML = '<option value="">Tous les tiers</option>';
                tiers.forEach(t => {
                    const option = document.createElement('option');
                    option.value = t.code;
                    option.textContent = `${t.code} - ${t.nom}`;
                    tiersSelect.appendChild(option);
                });
                
                // Mettre à jour les libellés des tranches d'âge
                document.getElementById('age1').addEventListener('change', updateAgeBracketLabels);
                document.getElementById('age2').addEventListener('change', updateAgeBracketLabels);
                document.getElementById('age3').addEventListener('change', updateAgeBracketLabels);
                document.getElementById('age4').addEventListener('change', updateAgeBracketLabels);
                
                function updateAgeBracketLabels() {
                    const age1 = parseInt(document.getElementById('age1').value);
                    const age2 = parseInt(document.getElementById('age2').value);
                    const age3 = parseInt(document.getElementById('age3').value);
                    const age4 = parseInt(document.getElementById('age4').value);
                    
                    document.getElementById('age1-label').textContent = `0-${age1} jours`;
                    document.getElementById('age2-label').textContent = `${age1+1}-${age2} jours`;
                    document.getElementById('age3-label').textContent = `${age2+1}-${age3} jours`;
                    document.getElementById('age4-label').textContent = `+${age3} jours`;
                }
                
                // Initialiser les libellés
                updateAgeBracketLabels();
                
                document.getElementById('valider-balance-agee').addEventListener('click', function() {
                    const type = document.querySelector('input[name="balance-agee-type"]:checked').value;
                    const tiersCode = document.getElementById('balance-agee-tiers').value;
                    const dateRef = document.getElementById('balance-agee-date').value || new Date().toISOString().split('T')[0];
                    
                    const age1 = parseInt(document.getElementById('age1').value);
                    const age2 = parseInt(document.getElementById('age2').value);
                    const age3 = parseInt(document.getElementById('age3').value);
                    const age4 = parseInt(document.getElementById('age4').value);
                    
                    // Récupérer les informations de la balance âgée
                    const balanceAgee = db.getBalanceAgee(dateRef, {
                        type,
                        tiers: tiersCode,
                        tranches: [age1, age2, age3, age4]
                    });
                    
                    // Mettre à jour l'affichage
                    document.getElementById('balance-agee-type-title').textContent = type === 'clients' ? '(CLIENTS)' : '(FOURNISSEURS)';
                    document.getElementById('balance-agee-date-ref').textContent = formatDate(dateRef);
                    document.getElementById('balance-agee-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le tableau des tiers
                    const tbody = document.getElementById('balance-agee-mouvements');
                    tbody.innerHTML = '';
                    
                    if (balanceAgee.tiers.length === 0) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td colspan="8" class="px-3 py-4 text-center text-gray-500">Aucun tiers ne correspond aux critères sélectionnés</td>
                        `;
                        tbody.appendChild(tr);
                    } else {
                        balanceAgee.tiers.forEach(tiers => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td class="px-3 py-2 text-sm">${tiers.code}</td>
                                <td class="px-3 py-2 text-sm">${tiers.nom}</td>
                                <td class="px-3 py-2 text-sm text-right">${formatNumber(tiers.solde)}</td>
                                <td class="px-3 py-2 text-sm text-right">${formatNumber(tiers.nonEchu)}</td>
                                <td class="px-3 py-2 text-sm text-right">${formatNumber(tiers.tranches[0])}</td>
                                <td class="px-3 py-2 text-sm text-right">${formatNumber(tiers.tranches[1])}</td>
                                <td class="px-3 py-2 text-sm text-right">${formatNumber(tiers.tranches[2])}</td>
                                <td class="px-3 py-2 text-sm text-right">${formatNumber(tiers.tranches[3])}</td>
                            `;
                            tbody.appendChild(tr);
                        });
                        
                        // Ajouter la ligne des totaux
                        const trTotal = document.createElement('tr');
                        trTotal.classList.add('bg-[var(--hover-color)]', 'font-semibold');
                        trTotal.innerHTML = `
                            <td class="px-3 py-2 text-sm" colspan="2">Totaux</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balanceAgee.totaux.solde)}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balanceAgee.totaux.nonEchu)}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balanceAgee.totaux.tranches[0])}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balanceAgee.totaux.tranches[1])}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balanceAgee.totaux.tranches[2])}</td>
                            <td class="px-3 py-2 text-sm text-right">${formatNumber(balanceAgee.totaux.tranches[3])}</td>
                        `;
                        tbody.appendChild(trTotal);
                    }
                    
                    // Afficher la balance âgée
                    document.getElementById('resultat-balance-agee').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-balance-agee').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage des journaux
            if (document.getElementById('valider-journaux')) {
                // Remplir le select des journaux
                const journauxSelect = document.getElementById('selection-journal-consultation');
                const journaux = db.getJournaux();
                
                journauxSelect.innerHTML = '<option value="">-- Sélectionnez un journal --</option><option value="all">Tous les journaux</option>';
                journaux.forEach(journal => {
                    const option = document.createElement('option');
                    option.value = journal.code;
                    option.textContent = `${journal.code} - ${journal.nom}`;
                    journauxSelect.appendChild(option);
                });
                
                document.getElementById('valider-journaux').addEventListener('click', function() {
                    const journal = document.getElementById('selection-journal-consultation').value;
                    const dateDebut = document.getElementById('journaux-date-debut').value;
                    const dateFin = document.getElementById('journaux-date-fin').value;
                    
                    if (!journal) {
                        alert("Veuillez sélectionner un journal.");
                        return;
                    }
                    
                    // Récupérer les informations du journal
                    const journalData = db.getJournal(journal, dateDebut, dateFin);
                    
                    // Mettre à jour l'affichage
                    document.getElementById('journaux-periode-debut').textContent = formatDate(dateDebut || '2024-01-01');
                    document.getElementById('journaux-periode-fin').textContent = formatDate(dateFin || new Date().toISOString().split('T')[0]);
                    document.getElementById('journaux-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le contenu des journaux
                    const contentWrapper = document.getElementById('journaux-content-wrapper');
                    contentWrapper.innerHTML = '';
                    
                    if (journal === 'all') {
                        // Affichage de tous les journaux
                        const journauxGroupes = {};
                        
                        // Regrouper les mouvements par journal
                        journalData.mouvements.forEach(mouvement => {
                            const journalCode = mouvement.journal || mouvement.numeroPiece.substring(0, 2);
                            
                            if (!journauxGroupes[journalCode]) {
                                journauxGroupes[journalCode] = [];
                            }
                            
                            journauxGroupes[journalCode].push(mouvement);
                        });
                        
                        // Afficher chaque journal
                        Object.entries(journauxGroupes).forEach(([code, mouvements]) => {
                            const journalSection = document.createElement('div');
                            journalSection.classList.add('mb-8');
                            
                            const journalObj = journaux.find(j => j.code === code);
                            const journalNom = journalObj ? journalObj.nom : code;
                            
                            journalSection.innerHTML = `
                                <h3 class="text-lg font-semibold mb-3">Journal ${code} - ${journalNom}</h3>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-[var(--border-color)]">
                                        <thead class="bg-[var(--hover-color)]">
                                            <tr>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Pièce</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Référence</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Compte</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                            </tr>
                                        </thead>
                                        <tbody class="journal-mouvements-${code} divide-y divide-[var(--border-color)]"></tbody>
                                    </table>
                                </div>
                            `;
                            
                            contentWrapper.appendChild(journalSection);
                            
                            // Remplir le tableau des mouvements
                            const tbody = document.querySelector(`.journal-mouvements-${code}`);
                            
                            let totalDebit = 0;
                            let totalCredit = 0;
                            
                            mouvements.forEach(mouvement => {
                                // Ligne d'entête de l'écriture
                                const trHeader = document.createElement('tr');
                                trHeader.classList.add('bg-gray-50', 'dark:bg-gray-800');
                                trHeader.innerHTML = `
                                    <td class="px-3 py-2 text-sm font-medium">${formatDate(mouvement.date)}</td>
                                    <td class="px-3 py-2 text-sm font-medium">${mouvement.numeroPiece}</td>
                                    <td class="px-3 py-2 text-sm font-medium" colspan="5">${mouvement.libelle || ''}</td>
                                `;
                                tbody.appendChild(trHeader);
                                
                                // Lignes de détail de l'écriture
                                mouvement.lignes.forEach(ligne => {
                                    const tr = document.createElement('tr');
                                    
                                    // Récupérer le libellé du compte
                                    const compteLibelle = db.getCompteLibelle(ligne.compte);
                                    
                                    tr.innerHTML = `
                                        <td class="px-3 py-2 text-sm"></td>
                                        <td class="px-3 py-2 text-sm"></td>
                                        <td class="px-3 py-2 text-sm">${ligne.libelle || ''}</td>
                                        <td class="px-3 py-2 text-sm">${mouvement.reference || ''}</td>
                                        <td class="px-3 py-2 text-sm">${ligne.compte} - ${compteLibelle}</td>
                                        <td class="px-3 py-2 text-sm">${ligne.debit > 0 ? formatNumber(ligne.debit) : ''}</td>
                                        <td class="px-3 py-2 text-sm">${ligne.credit > 0 ? formatNumber(ligne.credit) : ''}</td>
                                    `;
                                    tbody.appendChild(tr);
                                    
                                    totalDebit += ligne.debit;
                                    totalCredit += ligne.credit;
                                });
                            });
                            
                            // Ajouter la ligne des totaux
                            const trTotal = document.createElement('tr');
                            trTotal.classList.add('bg-[var(--hover-color)]', 'font-semibold');
                            trTotal.innerHTML = `
                                <td class="px-3 py-2 text-sm" colspan="5">Total journal ${code}</td>
                                <td class="px-3 py-2 text-sm">${formatNumber(totalDebit)}</td>
                                <td class="px-3 py-2 text-sm">${formatNumber(totalCredit)}</td>
                            `;
                            tbody.appendChild(trTotal);
                        });
                    } else {
                        // Affichage d'un seul journal
                        const journalObj = journaux.find(j => j.code === journal);
                        const journalNom = journalObj ? journalObj.nom : journal;
                        
                        contentWrapper.innerHTML = `
                            <h3 class="text-lg font-semibold mb-3">Journal ${journal} - ${journalNom}</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-[var(--border-color)]">
                                    <thead class="bg-[var(--hover-color)]">
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Pièce</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Libellé</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Référence</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Compte</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Débit</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Crédit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="journal-mouvements"></tbody>
                                </table>
                            </div>
                        `;
                        
                        // Remplir le tableau des mouvements
                        const tbody = document.getElementById('journal-mouvements');
                        
                        if (journalData.mouvements.length === 0) {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td colspan="7" class="px-3 py-4 text-center text-gray-500">Aucun mouvement pour ce journal dans la période sélectionnée</td>
                            `;
                            tbody.appendChild(tr);
                        } else {
                            journalData.mouvements.forEach(mouvement => {
                                // Ligne d'entête de l'écriture
                                const trHeader = document.createElement('tr');
                                trHeader.classList.add('bg-gray-50', 'dark:bg-gray-800');
                                trHeader.innerHTML = `
                                    <td class="px-3 py-2 text-sm font-medium">${formatDate(mouvement.date)}</td>
                                    <td class="px-3 py-2 text-sm font-medium">${mouvement.numeroPiece}</td>
                                    <td class="px-3 py-2 text-sm font-medium" colspan="5">${mouvement.libelle || ''}</td>
                                `;
                                tbody.appendChild(trHeader);
                                
                                // Lignes de détail de l'écriture
                                mouvement.lignes.forEach(ligne => {
                                    const tr = document.createElement('tr');
                                    
                                    // Récupérer le libellé du compte
                                    const compteLibelle = db.getCompteLibelle(ligne.compte);
                                    
                                    tr.innerHTML = `
                                        <td class="px-3 py-2 text-sm"></td>
                                        <td class="px-3 py-2 text-sm"></td>
                                        <td class="px-3 py-2 text-sm">${ligne.libelle || ''}</td>
                                        <td class="px-3 py-2 text-sm">${mouvement.reference || ''}</td>
                                        <td class="px-3 py-2 text-sm">${ligne.compte} - ${compteLibelle}</td>
                                        <td class="px-3 py-2 text-sm">${ligne.debit > 0 ? formatNumber(ligne.debit) : ''}</td>
                                        <td class="px-3 py-2 text-sm">${ligne.credit > 0 ? formatNumber(ligne.credit) : ''}</td>
                                    `;
                                    tbody.appendChild(tr);
                                });
                            });
                            
                            // Ajouter la ligne des totaux
                            const trTotal = document.createElement('tr');
                            trTotal.classList.add('bg-[var(--hover-color)]', 'font-semibold');
                            trTotal.innerHTML = `
                                <td class="px-3 py-2 text-sm" colspan="5">Total journal</td>
                                <td class="px-3 py-2 text-sm">${formatNumber(journalData.totaux.debit)}</td>
                                <td class="px-3 py-2 text-sm">${formatNumber(journalData.totaux.credit)}</td>
                            `;
                            tbody.appendChild(trTotal);
                        }
                    }
                    
                    // Afficher le journal
                    document.getElementById('resultat-journaux').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-journaux').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage du bilan
            if (document.getElementById('valider-bilan')) {
                document.getElementById('valider-bilan').addEventListener('click', function() {
                    const typeBilan = document.querySelector('input[name="bilan-type"]:checked').value;
                    const formatBilan = document.querySelector('input[name="bilan-format"]:checked').value;
                    const dateBilan = document.getElementById('bilan-date').value || new Date().toISOString().split('T')[0];
                    const comparatif = document.getElementById('bilan-comparatif').checked;
                    
                    // Récupérer les informations du bilan
                    const bilan = db.getBilan(dateBilan, typeBilan, {
                        format: formatBilan,
                        comparatif
                    });
                    
                    // Mettre à jour l'affichage
                    document.getElementById('bilan-resultat-titre').textContent = `Bilan ${typeBilan.charAt(0).toUpperCase() + typeBilan.slice(1)}`;
                    document.getElementById('bilan-titre-impression').textContent = `BILAN ${typeBilan.toUpperCase()}`;
                    document.getElementById('bilan-date-cloture').textContent = formatDate(dateBilan);
                    document.getElementById('bilan-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le contenu du bilan
                    const container = document.getElementById('bilan-data-container');
                    container.innerHTML = '';
                    
                    // Créer le tableau du bilan
                    const bilanTable = document.createElement('table');
                    bilanTable.className = 'financial-table min-w-full';
                    
                    // En-tête du tableau
                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr>
                            <th colspan="2">ACTIF</th>
                            <th>Montant</th>
                            <th colspan="2">PASSIF</th>
                            <th>Montant</th>
                        </tr>
                    `;
                    bilanTable.appendChild(thead);
                    
                    // Corps du tableau avec les sections ACTIF/PASSIF
                    const tbody = document.createElement('tbody');
                    
                    // Trouver la section la plus longue pour équilibrer le tableau
                    const actifSections = Object.keys(bilan.actif);
                    const passifSections = Object.keys(bilan.passif);
                    const maxRows = Math.max(actifSections.length, passifSections.length);
                    
                    for (let i = 0; i < maxRows; i++) {
                        const tr = document.createElement('tr');
                        
                        // Colonne ACTIF
                        if (i < actifSections.length) {
                            const sectionKey = actifSections[i];
                            const section = bilan.actif[sectionKey];
                            tr.innerHTML += `
                                <td class="w-8">&nbsp;</td>
                                <td>${section.titre}</td>
                                <td class="text-right">${formatNumber(section.montant)}</td>
                            `;
                        } else {
                            tr.innerHTML += `<td colspan="3">&nbsp;</td>`;
                        }
                        
                        // Colonne PASSIF
                        if (i < passifSections.length) {
                            const sectionKey = passifSections[i];
                            const section = bilan.passif[sectionKey];
                            tr.innerHTML += `
                                <td class="w-8">&nbsp;</td>
                                <td>${section.titre}</td>
                                <td class="text-right">${formatNumber(section.montant)}</td>
                            `;
                        } else {
                            tr.innerHTML += `<td colspan="3">&nbsp;</td>`;
                        }
                        
                        tbody.appendChild(tr);
                    }
                    
                    // Ligne de total
                    const trTotal = document.createElement('tr');
                    trTotal.className = 'total-row';
                    trTotal.innerHTML = `
                        <td class="w-8">&nbsp;</td>
                        <td>TOTAL ACTIF</td>
                        <td class="text-right">${formatNumber(bilan.totalActif)}</td>
                        <td class="w-8">&nbsp;</td>
                        <td>TOTAL PASSIF</td>
                        <td class="text-right">${formatNumber(bilan.totalPassif)}</td>
                    `;
                    tbody.appendChild(trTotal);
                    
                    bilanTable.appendChild(tbody);
                    container.appendChild(bilanTable);
                    
                    // Afficher le bilan
                    document.getElementById('resultat-bilan').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-bilan').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage du compte de résultat
            if (document.getElementById('valider-resultat')) {
                document.getElementById('valider-resultat').addEventListener('click', function() {
                    const presentation = document.querySelector('input[name="resultat-presentation"]:checked').value;
                    const niveau = document.getElementById('resultat-niveau-detail').value;
                    const dateDebut = document.getElementById('resultat-date-debut').value;
                    const dateFin = document.getElementById('resultat-date-fin').value;
                    const comparatif = document.getElementById('resultat-comparatif').checked;
                    
                    if (!dateDebut || !dateFin) {
                        alert("Veuillez sélectionner une période.");
                        return;
                    }
                    
                    // Récupérer les informations du compte de résultat
                    const compteResultat = db.getCompteResultat(dateDebut, dateFin, {
                        presentation,
                        niveau,
                        comparatif
                    });
                    
                    // Mettre à jour l'affichage
                    document.getElementById('resultat-titre').textContent = `Compte de Résultat par ${presentation}`;
                    document.getElementById('resultat-periode-debut').textContent = formatDate(dateDebut);
                    document.getElementById('resultat-periode-fin').textContent = formatDate(dateFin);
                    document.getElementById('resultat-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le contenu du compte de résultat
                    const container = document.getElementById('resultat-data-container');
                    container.innerHTML = '';
                    
                    // Créer le tableau du compte de résultat
                    const resultatTable = document.createElement('table');
                    resultatTable.className = 'financial-table min-w-full';
                    
                    // En-tête du tableau
                    const thead = document.createElement('thead');
                    thead.innerHTML = `
                        <tr>
                            <th>RUBRIQUES</th>
                            <th>MONTANT</th>
                        </tr>
                    `;
                    resultatTable.appendChild(thead);
                    
                    // Corps du tableau
                    const tbody = document.createElement('tbody');
                    
                    // Section PRODUITS
                    const trProduits = document.createElement('tr');
                    trProduits.className = 'subtotal-row';
                    trProduits.innerHTML = `
                        <td colspan="2">PRODUITS</td>
                    `;
                    tbody.appendChild(trProduits);
                    
                    // Détail des produits
                    Object.values(compteResultat.produits).forEach(produit => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${produit.titre}</td>
                            <td class="text-right">${formatNumber(produit.montant)}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                    
                    // Total des produits
                    const trTotalProduits = document.createElement('tr');
                    trTotalProduits.className = 'subtotal-row';
                    trTotalProduits.innerHTML = `
                        <td>TOTAL PRODUITS</td>
                        <td class="text-right">${formatNumber(compteResultat.totalProduits)}</td>
                    `;
                    tbody.appendChild(trTotalProduits);
                    
                    // Ligne vide
                    const trEmpty1 = document.createElement('tr');
                    trEmpty1.innerHTML = `<td colspan="2">&nbsp;</td>`;
                    tbody.appendChild(trEmpty1);
                    
                    // Section CHARGES
                    const trCharges = document.createElement('tr');
                    trCharges.className = 'subtotal-row';
                    trCharges.innerHTML = `
                        <td colspan="2">CHARGES</td>
                    `;
                    tbody.appendChild(trCharges);
                    
                    // Détail des charges
                    Object.values(compteResultat.charges).forEach(charge => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${charge.titre}</td>
                            <td class="text-right">${formatNumber(charge.montant)}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                    
                    // Total des charges
                    const trTotalCharges = document.createElement('tr');
                    trTotalCharges.className = 'subtotal-row';
                    trTotalCharges.innerHTML = `
                        <td>TOTAL CHARGES</td>
                        <td class="text-right">${formatNumber(compteResultat.totalCharges)}</td>
                    `;
                    tbody.appendChild(trTotalCharges);
                    
                    // Ligne vide
                    const trEmpty2 = document.createElement('tr');
                    trEmpty2.innerHTML = `<td colspan="2">&nbsp;</td>`;
                    tbody.appendChild(trEmpty2);
                    
                    // Résultat net
                    const trResultat = document.createElement('tr');
                    trResultat.className = 'total-row';
                    trResultat.innerHTML = `
                        <td>RÉSULTAT NET (Bénéfice ou Perte)</td>
                        <td class="text-right">${formatNumber(compteResultat.resultatNet)}</td>
                    `;
                    tbody.appendChild(trResultat);
                    
                    resultatTable.appendChild(tbody);
                    container.appendChild(resultatTable);
                    
                    // Afficher le compte de résultat
                    document.getElementById('resultat-compte').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-compte').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage des SIG
            if (document.getElementById('valider-sig')) {
                document.getElementById('valider-sig').addEventListener('click', function() {
                    const format = document.querySelector('input[name="sig-format"]:checked').value;
                    const pourcentage = document.getElementById('sig-pourcentage').checked;
                    const evolution = document.getElementById('sig-evolution').checked;
                    const dateDebut = document.getElementById('sig-date-debut').value;
                    const dateFin = document.getElementById('sig-date-fin').value;
                    const comparatif = document.getElementById('sig-comparatif').checked;
                    
                    if (!dateDebut || !dateFin) {
                        alert("Veuillez sélectionner une période.");
                        return;
                    }
                    
                    // Récupérer les informations des SIG
                    const sig = db.getSIG(dateDebut, dateFin, {
                        format,
                        pourcentage,
                        evolution,
                        comparatif
                    });
                    
                    // Mettre à jour l'affichage
                    document.getElementById('sig-periode-debut').textContent = formatDate(dateDebut);
                    document.getElementById('sig-periode-fin').textContent = formatDate(dateFin);
                    document.getElementById('sig-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le contenu des SIG
                    const container = document.getElementById('sig-data-container');
                    container.innerHTML = '';
                    
                    if (format === 'tableau') {
                        // Affichage en tableau
                        const sigTable = document.createElement('table');
                        sigTable.className = 'financial-table min-w-full';
                        
                        // En-tête du tableau
                        const thead = document.createElement('thead');
                        let theadHTML = `
                            <tr>
                                <th>SOLDES INTERMÉDIAIRES</th>
                                <th>MONTANT</th>
                        `;
                        
                        if (comparatif) {
                            theadHTML += `<th>EXERCICE PRÉCÉDENT</th>`;
                        }
                        
                        if (evolution) {
                            theadHTML += `<th>ÉVOLUTION</th>`;
                        }
                        
                        if (pourcentage) {
                            theadHTML += `<th>POURCENTAGE</th>`;
                        }
                        
                        theadHTML += `</tr>`;
                        thead.innerHTML = theadHTML;
                        sigTable.appendChild(thead);
                        
                        // Corps du tableau
                        const tbody = document.createElement('tbody');
                        
                        // Afficher chaque SIG
                        Object.values(sig.sig).forEach(solde => {
                            const tr = document.createElement('tr');
                            let trHTML = `
                                <td>${solde.titre}</td>
                                <td class="text-right">${formatNumber(solde.montant)}</td>
                            `;
                            
                            if (comparatif) {
                                trHTML += `<td class="text-right">${formatNumber(solde.precedent)}</td>`;
                            }
                            
                            if (evolution) {
                                trHTML += `<td class="text-right">${formatNumber(solde.evolution)}</td>`;
                            }
                            
                            if (pourcentage) {
                                trHTML += `<td class="text-right">${solde.pourcentage.toFixed(2)}%</td>`;
                            }
                            
                            tr.innerHTML = trHTML;
                            tbody.appendChild(tr);
                        });
                        
                        sigTable.appendChild(tbody);
                        container.appendChild(sigTable);
                    } else {
                        // Affichage en graphique
                        const chartContainer = document.createElement('div');
                        chartContainer.className = 'h-96';
                        chartContainer.innerHTML = `<canvas id="sig-chart"></canvas>`;
                        container.appendChild(chartContainer);
                        
                        // Créer le graphique des SIG
                        const ctx = document.getElementById('sig-chart').getContext('2d');
                        
                        const labels = Object.values(sig.sig).map(s => s.titre);
                        const data = Object.values(sig.sig).map(s => s.montant);
                        const dataPrecedent = Object.values(sig.sig).map(s => s.precedent);
                        
                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: 'Période courante',
                                        data: data,
                                        backgroundColor: 'rgba(93, 92, 222, 0.7)',
                                        borderColor: 'rgba(93, 92, 222, 1)',
                                        borderWidth: 1
                                    },
                                    ...(comparatif ? [{
                                        label: 'Période précédente',
                                        data: dataPrecedent,
                                        backgroundColor: 'rgba(156, 163, 175, 0.7)',
                                        borderColor: 'rgba(156, 163, 175, 1)',
                                        borderWidth: 1
                                    }] : [])
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                    
                    // Afficher les SIG
                    document.getElementById('resultat-sig').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-sig').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion de l'affichage du tableau des flux de trésorerie
            if (document.getElementById('valider-flux')) {
                document.getElementById('valider-flux').addEventListener('click', function() {
                    const methode = document.querySelector('input[name="flux-methode"]:checked').value;
                    const niveau = document.getElementById('flux-niveau-detail').value;
                    const dateDebut = document.getElementById('flux-date-debut').value;
                    const dateFin = document.getElementById('flux-date-fin').value;
                    const comparatif = document.getElementById('flux-comparatif').checked;
                    
                    if (!dateDebut || !dateFin) {
                        alert("Veuillez sélectionner une période.");
                        return;
                    }
                    
                    // Mise à jour de l'affichage
                    document.getElementById('flux-titre').textContent = `Tableau des Flux de Trésorerie (méthode ${methode})`;
                    document.getElementById('flux-periode-debut').textContent = formatDate(dateDebut);
                    document.getElementById('flux-periode-fin').textContent = formatDate(dateFin);
                    document.getElementById('flux-date-impression').textContent = `Date d'impression: ${formatDate(new Date().toISOString().split('T')[0])}`;
                    
                    // Remplir le contenu avec un tableau de flux de trésorerie fictif 
                    // (dans une vraie application, ce serait calculé à partir des données comptables)
                    const container = document.getElementById('flux-data-container');
                    container.innerHTML = '';
                    
                    // Structure de base du tableau des flux
                    let fluxHTML = `
                        <table class="financial-table min-w-full">
                            <thead>
                                <tr>
                                    <th>RUBRIQUES</th>
                                    <th>MONTANT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="subtotal-row">
                                    <td colspan="2">FLUX DE TRÉSORERIE LIÉS À L'ACTIVITÉ</td>
                                </tr>
                                <tr>
                                    <td>Résultat net</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>+ Dotations aux amortissements et provisions</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>- Reprises sur amortissements et provisions</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>+/- Plus ou moins-values de cession</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>+/- Variation du BFR</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>= FLUX NET DE TRÉSORERIE GÉNÉRÉ PAR L'ACTIVITÉ (A)</td>
                                    <td class="text-right">0</td>
                                </tr>
                                
                                <tr><td colspan="2">&nbsp;</td></tr>
                                
                                <tr class="subtotal-row">
                                    <td colspan="2">FLUX DE TRÉSORERIE LIÉS AUX OPÉRATIONS D'INVESTISSEMENT</td>
                                </tr>
                                <tr>
                                    <td>- Acquisitions d'immobilisations</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>+ Cessions d'immobilisations</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>= FLUX NET DE TRÉSORERIE LIÉ AUX OPÉRATIONS D'INVESTISSEMENT (B)</td>
                                    <td class="text-right">0</td>
                                </tr>
                                
                                <tr><td colspan="2">&nbsp;</td></tr>
                                
                                <tr class="subtotal-row">
                                    <td colspan="2">FLUX DE TRÉSORERIE LIÉS AUX OPÉRATIONS DE FINANCEMENT</td>
                                </tr>
                                <tr>
                                    <td>+ Augmentation de capital</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>+ Émission d'emprunts</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>- Remboursements d'emprunts</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>- Dividendes versés</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>= FLUX NET DE TRÉSORERIE LIÉ AUX OPÉRATIONS DE FINANCEMENT (C)</td>
                                    <td class="text-right">0</td>
                                </tr>
                                
                                <tr><td colspan="2">&nbsp;</td></tr>
                                
                                <tr class="total-row">
                                    <td>VARIATION DE TRÉSORERIE (A+B+C)</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td>+ Trésorerie d'ouverture</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr class="total-row">
                                    <td>= TRÉSORERIE DE CLÔTURE</td>
                                    <td class="text-right">0</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                    
                    container.innerHTML = fluxHTML;
                    
                    // Afficher le tableau des flux
                    document.getElementById('resultat-flux').classList.remove('hidden');
                    
                    // Faire défiler jusqu'au résultat
                    document.getElementById('resultat-flux').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Gestion du calcul de la TVA
            if (document.getElementById('calculer-tva-btn')) {
                document.getElementById('calculer-tva-btn').addEventListener('click', function() {
                    const periode = document.getElementById('tva-periode').value;
                    const mois = parseInt(document.getElementById('tva-mois').value);
                    const annee = parseInt(document.getElementById('tva-annee').value);
                    
                    const inclureCredit = document.getElementById('tva-inclure-credit').checked;
                    const regrouper = document.getElementById('tva-regrouper-comptes').checked;
                    
                    // Calculer la TVA
                    const tva = db.calculerTVA({
                        mois,
                        annee,
                        inclureCredit,
                        regrouper
                    });
                    
                    // Mise à jour des montants affichés
                    document.getElementById('tva-collectee-total').textContent = formatCurrency(tva.tvaCollectee);
                    document.getElementById('tva-deductible-total').textContent = formatCurrency(tva.tvaDeductible);
                    document.getElementById('tva-a-payer').textContent = formatCurrency(tva.tvaAPayer);
                    document.getElementById('tva-credit-reporter').textContent = formatCurrency(tva.creditTVA);
                    
                    // Convertir le mois en texte
                    const moisTexte = new Date(annee, mois - 1, 1).toLocaleString('fr-FR', { month: 'long' });
                    
                    // Mettre à jour l'affichage détaillé
                    document.getElementById('tva-periode-label').textContent = `${moisTexte} ${annee}`;
                    
                    // Afficher le résultat de la déclaration
                    document.getElementById('resultat-tva').classList.remove('hidden');
                    
                    // Générer les données pour le tableau de la déclaration
                    const container = document.getElementById('tva-data-container');
                    container.innerHTML = '';
                    
                    let tvaHTML = `
                        <table class="financial-table min-w-full">
                            <thead>
                                <tr>
                                    <th colspan="2">OPÉRATIONS</th>
                                    <th>BASE HT</th>
                                    <th>TAUX</th>
                                    <th>TVA</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="subtotal-row">
                                    <td colspan="5">A - TVA COLLECTÉE</td>
                                </tr>
                                <tr>
                                    <td class="w-8">1</td>
                                    <td>Ventes et prestations (taux normal)</td>
                                    <td class="text-right">0</td>
                                    <td class="text-center">18%</td>
                                    <td class="text-right">${formatNumber(tva.tvaCollectee)}</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td colspan="4">TOTAL TVA COLLECTÉE</td>
                                    <td class="text-right">${formatNumber(tva.tvaCollectee)}</td>
                                </tr>
                                
                                <tr><td colspan="5">&nbsp;</td></tr>
                                
                                <tr class="subtotal-row">
                                    <td colspan="5">B - TVA DÉDUCTIBLE</td>
                                </tr>
                                <tr>
                                    <td class="w-8">1</td>
                                    <td>Immobilisations</td>
                                    <td class="text-right">0</td>
                                    <td class="text-center">18%</td>
                                    <td class="text-right">0</td>
                                </tr>
                                <tr>
                                    <td class="w-8">2</td>
                                    <td>Biens et services</td>
                                    <td class="text-right">0</td>
                                    <td class="text-center">18%</td>
                                    <td class="text-right">${formatNumber(tva.tvaDeductible)}</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td colspan="4">TOTAL TVA DÉDUCTIBLE</td>
                                    <td class="text-right">${formatNumber(tva.tvaDeductible)}</td>
                                </tr>
                                
                                <tr><td colspan="5">&nbsp;</td></tr>
                                
                                <tr class="total-row">
                                    <td colspan="4">TVA À PAYER (A - B > 0)</td>
                                    <td class="text-right">${formatNumber(tva.tvaAPayer)}</td>
                                </tr>
                                <tr class="total-row">
                                    <td colspan="4">CRÉDIT DE TVA (A - B < 0)</td>
                                    <td class="text-right">${formatNumber(tva.creditTVA)}</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                    
                    container.innerHTML = tvaHTML;
                    
                    // Ajouter l'événement sur le bouton de validation de déclaration
                    document.getElementById('valider-declaration-tva').addEventListener('click', function() {
                        // Dans une vraie application, on pourrait enregistrer la déclaration en base de données
                        alert("La déclaration de TVA a été validée avec succès.");
                    });
                });
            }
            
            // Recherche dans les comptes
            document.getElementById('search-comptes').addEventListener('input', function() {
                loadComptesGeneraux(this.value);
            });
            
            // Recherche dans les tiers
            document.getElementById('search-tiers').addEventListener('input', function() {
                loadTiers(this.value);
            });
            
            // Recherche dans les écritures
            document.getElementById('search-ecritures').addEventListener('input', function() {
                loadEcritures(this.value);
            });
            
            // Recherche dans les journaux
            document.getElementById('search-journaux').addEventListener('input', function() {
                loadJournaux(this.value);
            });
            
            // Supprimer un compte
            document.body.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-compte-btn') || e.target.closest('.delete-compte-btn')) {
                    const btn = e.target.classList.contains('delete-compte-btn') ? e.target : e.target.closest('.delete-compte-btn');
                    const compteId = parseInt(btn.dataset.id);
                    
                    if (confirm("Êtes-vous sûr de vouloir supprimer ce compte ?")) {
                        db.deleteCompte(compteId);
                        loadComptesGeneraux();
                        updateFiltresGrandLivre();
                        loadActivities();
                    }
                }
            });
            
            // Supprimer un tiers
            document.body.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-tiers-btn') || e.target.closest('.delete-tiers-btn')) {
                    const btn = e.target.classList.contains('delete-tiers-btn') ? e.target : e.target.closest('.delete-tiers-btn');
                    const tiersId = parseInt(btn.dataset.id);
                    
                    if (confirm("Êtes-vous sûr de vouloir supprimer ce tiers ?")) {
                        db.deleteTiers(tiersId);
                        loadTiers();
                        loadActivities();
                    }
                }
            });
            
            // Supprimer un journal
            document.body.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-journal-btn') || e.target.closest('.delete-journal-btn')) {
                    const btn = e.target.classList.contains('delete-journal-btn') ? e.target : e.target.closest('.delete-journal-btn');
                    const journalId = parseInt(btn.dataset.id);
                    
                    if (confirm("Êtes-vous sûr de vouloir supprimer ce journal ?")) {
                        db.deleteJournal(journalId);
                        loadJournaux();
                        loadActivities();
                    }
                }
            });
            
            // Supprimer une écriture
            document.body.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-ecriture-btn') || e.target.closest('.delete-ecriture-btn')) {
                    const btn = e.target.classList.contains('delete-ecriture-btn') ? e.target : e.target.closest('.delete-ecriture-btn');
                    const ecritureId = parseInt(btn.dataset.id);
                    
                    if (confirm("Êtes-vous sûr de vouloir supprimer cette écriture ?")) {
                        db.deleteEcriture(ecritureId);
                        loadEcritures();
                        loadActivities();
                        updateDashboardKPIs();
                        updateCharts();
                    }
                }
            });
            
            // Supprimer une facture
            document.body.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-facture-btn') || e.target.closest('.delete-facture-btn')) {
                    const btn = e.target.classList.contains('delete-facture-btn') ? e.target : e.target.closest('.delete-facture-btn');
                    const factureId = parseInt(btn.dataset.id);
                    
                    if (confirm("Êtes-vous sûr de vouloir supprimer cette facture ?")) {
                        db.deleteFacture(factureId);
                        loadFactures();
                        loadActivities();
                    }
                }
            });
        }
        
        // Fonctions de chargement des données
        function loadComptesGeneraux(search = '') {
            const comptes = db.getComptes();
            const table = document.getElementById('comptes-generaux-table');
            
            if (!table) return;
            
            // Filtrer les comptes si une recherche est en cours
            const filteredComptes = search
                ? comptes.filter(c => 
                    c.numero.toLowerCase().includes(search.toLowerCase()) || 
                    c.libelle.toLowerCase().includes(search.toLowerCase())
                )
                : comptes;
            
            // Mise à jour du compteur
            document.getElementById('comptes-start').textContent = filteredComptes.length > 0 ? '1' : '0';
            document.getElementById('comptes-end').textContent = filteredComptes.length;
            document.getElementById('comptes-total').textContent = comptes.length;
            
            // Activer/désactiver les boutons de pagination
            document.getElementById('comptes-prev').disabled = true;
            document.getElementById('comptes-next').disabled = filteredComptes.length <= 10;
            
            table.innerHTML = '';
            
            if (filteredComptes.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-gray-500">
                            Aucun compte trouvé${search ? ' correspondant à la recherche' : ''}
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredComptes.slice(0, 10).forEach(compte => {
                const tr = document.createElement('tr');
                
                // Classe pour le badge selon le type
                let badgeClass = "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";
                if (compte.type === 'charges') {
                    badgeClass = "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";
                } else if (compte.type === 'produits') {
                    badgeClass = "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";
                }
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${compte.numero}</td>
                    <td class="px-6 py-4">${compte.libelle}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full ${badgeClass}">
                            ${compte.type.charAt(0).toUpperCase() + compte.type.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 edit-compte-btn" data-id="${compte.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-compte-btn" data-id="${compte.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(tr);
            });
        }
        
        function loadTiers(search = '') {
            const tiers = db.getTiers();
            const table = document.getElementById('comptes-tiers-table');
            
            if (!table) return;
            
            // Filtrer les tiers si une recherche est en cours
            const filteredTiers = search
                ? tiers.filter(t => 
                    t.code.toLowerCase().includes(search.toLowerCase()) || 
                    t.nom.toLowerCase().includes(search.toLowerCase())
                )
                : tiers;
            
            // Mise à jour du compteur
            document.getElementById('tiers-start').textContent = filteredTiers.length > 0 ? '1' : '0';
            document.getElementById('tiers-end').textContent = filteredTiers.length;
            document.getElementById('tiers-total').textContent = tiers.length;
            
            // Activer/désactiver les boutons de pagination
            document.getElementById('tiers-prev').disabled = true;
            document.getElementById('tiers-next').disabled = filteredTiers.length <= 10;
            
            table.innerHTML = '';
            
            if (filteredTiers.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            Aucun tiers trouvé${search ? ' correspondant à la recherche' : ''}
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredTiers.slice(0, 10).forEach(tiers => {
                const tr = document.createElement('tr');
                
                // Badge pour le type de tiers
                let badgeClass = "";
                if (tiers.type === 'client') {
                    badgeClass = "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";
                } else if (tiers.type === 'fournisseur') {
                    badgeClass = "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";
                } else {
                    badgeClass = "bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200";
                }
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${tiers.code}</td>
                    <td class="px-6 py-4">${tiers.nom}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full ${badgeClass}">
                            ${tiers.type.charAt(0).toUpperCase() + tiers.type.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4">${tiers.compte}</td>
                    <td class="px-6 py-4">${tiers.contact || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 edit-tiers-btn" data-id="${tiers.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-tiers-btn" data-id="${tiers.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(tr);
            });
        }
        
        function loadJournaux(search = '') {
            const journaux = db.getJournaux();
            const table = document.getElementById('journaux-table');
            
            if (!table) return;
            
            // Filtrer les journaux si une recherche est en cours
            const filteredJournaux = search
                ? journaux.filter(j => 
                    j.code.toLowerCase().includes(search.toLowerCase()) || 
                    j.nom.toLowerCase().includes(search.toLowerCase())
                )
                : journaux;
            
            // Mise à jour du compteur
            if (document.getElementById('journaux-start')) {
                document.getElementById('journaux-start').textContent = filteredJournaux.length > 0 ? '1' : '0';
                document.getElementById('journaux-end').textContent = filteredJournaux.length;
                document.getElementById('journaux-total').textContent = journaux.length;
                
                // Activer/désactiver les boutons de pagination
                document.getElementById('journaux-prev').disabled = true;
                document.getElementById('journaux-next').disabled = filteredJournaux.length <= 10;
            }
            
            table.innerHTML = '';
            
            if (filteredJournaux.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-gray-500">
                            Aucun journal trouvé${search ? ' correspondant à la recherche' : ''}
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredJournaux.forEach(journal => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${journal.code}</td>
                    <td class="px-6 py-4">${journal.nom}</td>
                    <td class="px-6 py-4">${journal.type}</td>
                    <td class="px-6 py-4">${journal.devise}</td>
                    <td class="px-6 py-4">${journal.compte}</td>
                    <td class="px-6 py-4">${journal.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 edit-journal-btn" data-id="${journal.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-journal-btn" data-id="${journal.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(tr);
            });
        }
        
        function loadModeleSaisie(search = '') {
            const modeles = db.getModeleSaisie();
            const table = document.getElementById('modeles-saisie-table');
            
            if (!table) return;
            
            // Filtrer les modèles si une recherche est en cours
            const filteredModeles = search
                ? modeles.filter(m => 
                    m.code.toLowerCase().includes(search.toLowerCase()) || 
                    m.libelle.toLowerCase().includes(search.toLowerCase())
                )
                : modeles;
            
            // Mise à jour du compteur
            document.getElementById('modeles-saisie-start').textContent = filteredModeles.length > 0 ? '1' : '0';
            document.getElementById('modeles-saisie-end').textContent = filteredModeles.length;
            document.getElementById('modeles-saisie-total').textContent = modeles.length;
            
            // Activer/désactiver les boutons de pagination
            document.getElementById('modeles-saisie-prev').disabled = true;
            document.getElementById('modeles-saisie-next').disabled = filteredModeles.length <= 10;
            
            table.innerHTML = '';
            
            if (filteredModeles.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            Aucun modèle trouvé${search ? ' correspondant à la recherche' : ''}
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredModeles.forEach(modele => {
                const tr = document.createElement('tr');
                
                // Formater la date de dernière utilisation
                let derniereUtilisation = "Jamais utilisé";
                if (modele.derniereUtilisation) {
                    derniereUtilisation = formatDate(modele.derniereUtilisation);
                }
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${modele.code}</td>
                    <td class="px-6 py-4">${modele.libelle}</td>
                    <td class="px-6 py-4">${modele.journal}</td>
                    <td class="px-6 py-4 text-center">${modele.lignes.length}</td>
                    <td class="px-6 py-4">${derniereUtilisation}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 edit-modele-btn" data-id="${modele.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 mr-3 use-modele-btn" data-id="${modele.id}">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-modele-btn" data-id="${modele.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(tr);
            });
        }
        
        function loadEcritures(search = '') {
            const ecritures = db.getEcritures();
            const table = document.getElementById('ecritures-table');
            
            if (!table) return;
            
            // Filtrer les écritures si une recherche est en cours
            const filteredEcritures = search
                ? ecritures.filter(e => 
                    e.numeroPiece.toLowerCase().includes(search.toLowerCase()) || 
                    e.journal.toLowerCase().includes(search.toLowerCase()) ||
                    (e.reference && e.reference.toLowerCase().includes(search.toLowerCase())) ||
                    (e.libelle && e.libelle.toLowerCase().includes(search.toLowerCase()))
                )
                : ecritures;
            
            // Mise à jour du compteur
            document.getElementById('ecritures-start').textContent = filteredEcritures.length > 0 ? '1' : '0';
            document.getElementById('ecritures-end').textContent = filteredEcritures.length;
            document.getElementById('ecritures-total').textContent = ecritures.length;
            
            // Activer/désactiver les boutons de pagination
            document.getElementById('ecritures-prev').disabled = true;
            document.getElementById('ecritures-next').disabled = filteredEcritures.length <= 10;
            
            table.innerHTML = '';
            
            if (filteredEcritures.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-6 py-4 text-center text-gray-500">
                            Aucune écriture trouvée${search ? ' correspondant à la recherche' : ''}
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredEcritures.slice(0, 10).forEach((ecriture, index) => {
                const tr = document.createElement('tr');
                
                // Calculer le montant total de l'écriture (somme des débits ou des crédits)
                const montantTotal = ecriture.lignes.reduce((sum, ligne) => {
                    return sum + parseFloat(ligne.debit || 0);
                }, 0);
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${index + 1}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${formatDate(ecriture.dateSaisie)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${formatDate(ecriture.dateOperation)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${ecriture.journal}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${ecriture.numeroPiece}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${ecriture.reference || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${ecriture.libelle || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${formatCurrency(montantTotal, ecriture.devise || 'FCFA')}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 view-ecriture-btn" data-id="${ecriture.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 edit-ecriture-btn" data-id="${ecriture.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-ecriture-btn" data-id="${ecriture.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(tr);
            });
        }
        
        function loadFactures() {
            const factures = db.getFactures();
            const listContainer = document.getElementById('factures-list');
            
            if (!listContainer) return;
            
            listContainer.innerHTML = '';
            
            if (factures.length === 0) {
                listContainer.innerHTML = `
                    <div class="p-4 text-center text-gray-500 dark:text-gray-400">
                        Aucune facture numérisée
                    </div>
                `;
                return;
            }
            
            factures.forEach(facture => {
                const factureItem = document.createElement('div');
                factureItem.className = 'digitalized-document';
                factureItem.dataset.id = facture.id;
                
                // Badge pour le type de document
                let badgeClass = "";
                let badgeText = "";
                if (facture.type === 'facture-fournisseur') {
                    badgeClass = "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";
                    badgeText = "Fournisseur";
                } else {
                    badgeClass = "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";
                    badgeText = "Client";
                }
                
                factureItem.innerHTML = `
                    <div class="digitalized-header">
                        <div class="flex items-center">
                            <span class="px-2 py-1 text-xs rounded-full ${badgeClass} mr-2">
                                ${badgeText}
                            </span>
                            <span class="font-medium">${facture.numero}</span>
                        </div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">
                            ${formatDate(facture.date)}
                        </div>
                    </div>
                    <div class="digitalized-body">
                        <div class="flex justify-between mb-2">
                            <div>
                                <p class="text-sm"><span class="font-medium">Tiers:</span> ${facture.tiers}</p>
                                <p class="text-sm"><span class="font-medium">Montant:</span> ${formatCurrency(facture.montantTtc, facture.devise)}</p>
                            </div>
                            <div class="flex space-x-1">
                                <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 view-facture-btn" data-id="${facture.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-facture-btn" data-id="${facture.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400 truncate">${facture.description || 'Aucune description'}</p>
                    </div>
                `;
                
                // Ajouter un événement de clic pour afficher la facture
                factureItem.addEventListener('click', function(e) {
                    // Ne pas déclencher si on a cliqué sur un bouton
                    if (e.target.closest('button')) return;
                    
                    // Afficher les détails de la facture
                    displayFactureDetails(facture.id);
                });
                
                listContainer.appendChild(factureItem);
            });
            
            // Ajouter les gestionnaires d'événements pour les boutons
            document.querySelectorAll('.view-facture-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    displayFactureDetails(parseInt(this.dataset.id));
                });
            });
        }
        
        function displayFactureDetails(factureId) {
            const factures = db.getFactures();
            const facture = factures.find(f => f.id === factureId);
            
            if (!facture) return;
            
            const previewContainer = document.getElementById('facture-preview');
            const editBtn = document.getElementById('edit-facture-btn');
            const exportBtn = document.getElementById('export-facture-btn');
            
            if (previewContainer) {
                // Activer les boutons
                editBtn.disabled = false;
                exportBtn.disabled = false;
                
                // Type de facture
                const typeText = facture.type === 'facture-fournisseur' ? 'FACTURE FOURNISSEUR' : 'FACTURE CLIENT';
                
                // Afficher les détails de la facture
                previewContainer.innerHTML = `
                    <div class="p-8 bg-white dark:bg-gray-800 shadow-md h-full overflow-auto">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white">${typeText}</h2>
                            <p class="text-gray-500 dark:text-gray-400">N° ${facture.numero}</p>
                        </div>
                        
                        <div class="flex justify-between mb-8">
                            <div>
                                <h3 class="font-semibold mb-1">DATE</h3>
                                <p>${formatDate(facture.date)}</p>
                                ${facture.echeance ? `
                                    <h3 class="font-semibold mb-1 mt-2">ÉCHÉANCE</h3>
                                    <p>${formatDate(facture.echeance)}</p>
                                ` : ''}
                            </div>
                            <div>
                                <h3 class="font-semibold mb-1">TIERS</h3>
                                <p>${facture.tiers} - ${db.getTiersNom(facture.tiers)}</p>
                            </div>
                        </div>
                        
                        ${facture.description ? `
                            <div class="mb-6">
                                <h3 class="font-semibold mb-1">DESCRIPTION</h3>
                                <p>${facture.description}</p>
                            </div>
                        ` : ''}
                        
                        <table class="w-full mb-8">
                            <thead>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th class="text-left py-2 px-2">DESCRIPTION</th>
                                    <th class="text-right py-2 px-2">MONTANT</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="py-2 px-2">Montant HT</td>
                                    <td class="text-right py-2 px-2">${formatCurrency(facture.montantHt, facture.devise)}</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="py-2 px-2">TVA (${facture.tauxTva}%)</td>
                                    <td class="text-right py-2 px-2">${formatCurrency(facture.montantTva, facture.devise)}</td>
                                </tr>
                                <tr class="font-bold">
                                    <td class="py-2 px-2">TOTAL TTC</td>
                                    <td class="text-right py-2 px-2">${formatCurrency(facture.montantTtc, facture.devise)}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-4 text-center">
                            <p>Facture numérisée le ${formatDate(facture.dateCreation)}</p>
                            ${facture.ecriture ? '<p>Écriture comptable liée</p>' : ''}
                        </div>
                    </div>
                `;
            }
        }
        
        function loadSectionsAnalytiques() {
            const sections = db.getSectionsAnalytiques();
            const table = document.getElementById('sections-analytiques-table');
            
            if (!table) return;
            
            table.innerHTML = '';
            
            if (sections.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            Aucune section analytique
                        </td>
                    </tr>
                `;
                return;
            }
            
            sections.forEach(section => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td class="px-4 py-2">${section.code}</td>
                    <td class="px-4 py-2">${section.libelle}</td>
                    <td class="px-4 py-2">${section.axe}</td>
                    <td class="px-4 py-2">${section.parent || '-'}</td>
                    <td class="px-4 py-2">
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 edit-section-btn" data-id="${section.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-section-btn" data-id="${section.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(tr);
            });
        }
        
        function loadAxesAnalytiques() {
            const axes = db.getAxesAnalytiques();
            const axesList = document.getElementById('axes-list');
            
            if (!axesList) return;
            
            axesList.innerHTML = '';
            
            if (axes.length === 0) {
                axesList.innerHTML = `
                    <div class="text-center text-gray-500 p-4">
                        Aucun axe analytique
                    </div>
                `;
                return;
            }
            
            axes.forEach(axe => {
                const axeItem = document.createElement('div');
                axeItem.className = 'flex justify-between items-center p-2 border border-gray-200 dark:border-gray-700 rounded';
                
                axeItem.innerHTML = `
                    <div>
                        <span class="font-medium">${axe.code}</span> - ${axe.libelle}
                    </div>
                    <div>
                        <button class="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 mr-3 edit-axe-btn" data-id="${axe.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 delete-axe-btn" data-id="${axe.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                `;
                
                axesList.appendChild(axeItem);
            });
        }
        
        function loadActivities() {
            const activities = db.getActivities();
            const logContainer = document.getElementById('activity-log');
            
            if (!logContainer) return;
            
            logContainer.innerHTML = '';
            
            if (activities.length === 0) {
                logContainer.innerHTML = `
                    <div class="flex justify-center items-center py-4 text-gray-500 dark:text-gray-400">
                        <p>Aucune activité récente</p>
                    </div>
                `;
                return;
            }
            
            activities.slice(0, 15).forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.classList.add('activity-item');
                
                // Déterminer l'icône en fonction du type d'activité
                let icon = 'fa-info-circle text-blue-500';
                if (activity.type === 'create') icon = 'fa-plus-circle text-green-500';
                else if (activity.type === 'update') icon = 'fa-edit text-orange-500';
                else if (activity.type === 'delete') icon = 'fa-trash text-red-500';
                else if (activity.type === 'view') icon = 'fa-eye text-blue-500';
                
                const date = new Date(activity.timestamp);
                const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
                
                activityItem.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-3">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm">${activity.description}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${formattedDate}</p>
                        </div>
                    </div>
                `;
                
                logContainer.appendChild(activityItem);
            });
        }
        
        function updateFiltresGrandLivre() {
            // Mettre à jour le select des comptes pour le grand livre
            const comptesSelect = document.getElementById('grand-livre-compte');
            if (comptesSelect) {
                const comptes = db.getComptes();
                
                comptesSelect.innerHTML = '<option value="">-- Sélectionnez un compte --</option>';
                comptes.forEach(compte => {
                    const option = document.createElement('option');
                    option.value = compte.numero;
                    option.textContent = `${compte.numero} - ${compte.libelle}`;
                    comptesSelect.appendChild(option);
                });
                
                // Mettre à jour les dates par défaut
                const today = new Date();
                const firstDayOfYear = new Date(today.getFullYear(), 0, 1);
                
                document.getElementById('grand-livre-date-debut').value = firstDayOfYear.toISOString().split('T')[0];
                document.getElementById('grand-livre-date-fin').value = today.toISOString().split('T')[0];
            }
            
            // Mettre à jour le select des comptes pour les journaux
            const comptesJournalSelect = document.getElementById('new-journal-compte');
            if (comptesJournalSelect) {
                const comptes = db.getComptes();
                
                comptesJournalSelect.innerHTML = '<option value="" disabled selected>Sélectionnez un compte</option>';
                comptes.forEach(compte => {
                    const option = document.createElement('option');
                    option.value = compte.numero;
                    option.textContent = `${compte.numero} - ${compte.libelle}`;
                    comptesJournalSelect.appendChild(option);
                });
            }
        }
        
        function updateDashboardKPIs() {
            // Récupérer les statistiques financières
            const stats = db.data.statistiquesFinancieres || {
                ca: 0,
                depenses: 0,
                benefice: 0,
                marge: 0
            };
            
            // Mettre à jour les valeurs des KPIs
            document.getElementById('kpi-ca').textContent = formatCurrency(stats.ca);
            document.getElementById('kpi-depenses').textContent = formatCurrency(stats.depenses);
            document.getElementById('kpi-benefice').textContent = formatCurrency(stats.benefice);
            document.getElementById('kpi-marge').textContent = stats.marge.toFixed(2) + '%';
            
            // Dans une vraie application, les tendances seraient calculées en comparant avec les périodes précédentes
            // Ici, on affiche simplement des valeurs neutres car on n'a pas de comparaison
            document.getElementById('kpi-ca-trend').innerHTML = `<i class="fas fa-minus mr-1"></i> 0%`;
            document.getElementById('kpi-depenses-trend').innerHTML = `<i class="fas fa-minus mr-1"></i> 0%`;
            document.getElementById('kpi-benefice-trend').innerHTML = `<i class="fas fa-minus mr-1"></i> 0%`;
            document.getElementById('kpi-marge-trend').innerHTML = `<i class="fas fa-minus mr-1"></i> 0%`;
        }
        
        function initializeCharts() {
            // Chart 1: Évolution du Chiffre d'Affaires
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            window.revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'],
                    datasets: [{
                        label: 'Chiffre d\'Affaires',
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        borderColor: '#5D5CDE',
                        backgroundColor: 'rgba(93, 92, 222, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Chart 2: Évolution des Dépenses
            const expensesCtx = document.getElementById('expensesChart').getContext('2d');
            window.expensesChart = new Chart(expensesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'],
                    datasets: [{
                        label: 'Dépenses',
                        data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Initialiser les autres graphiques
            initializeTreasuryCharts();
        }
        
        function updateCharts() {
            // Récupérer les données pour les graphiques
            const graphData = db.getGraphData();
            
            // Mettre à jour les graphiques
            if (window.revenueChart) {
                window.revenueChart.data.labels = graphData.labels;
                window.revenueChart.data.datasets[0].data = graphData.ca;
                window.revenueChart.update();
            }
            
            if (window.expensesChart) {
                window.expensesChart.data.labels = graphData.labels;
                window.expensesChart.data.datasets[0].data = graphData.depenses;
                window.expensesChart.update();
            }
            
            // Mettre à jour les autres graphiques
            updateTreasuryCharts();
        }
        
        function initializeTreasuryCharts() {
            // Chart: Évolution de la trésorerie
            const treasuryCtx = document.getElementById('treasuryChart');
            if (treasuryCtx) {
                window.treasuryChart = new Chart(treasuryCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'],
                        datasets: [{
                            label: 'Solde de trésorerie',
                            data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Chart: Répartition par compte
            const distributionCtx = document.getElementById('accountDistributionChart');
            if (distributionCtx) {
                window.accountDistributionChart = new Chart(distributionCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Banque', 'Caisse', 'Autres'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: [
                                '#3B82F6',
                                '#10B981',
                                '#6B7280'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 15,
                                    padding: 15,
                                    font: {
                                        size: 10
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function updateTreasuryCharts() {
            // Ces données seraient normalement calculées à partir des écritures comptables
            // Pour l'instant, on utilise des valeurs fictives
            
            // Dans une vraie application, on extrairait ces données des comptes de trésorerie
            
            // Mise à jour de l'évolution de la trésorerie
            if (window.treasuryChart) {
                window.treasuryChart.update();
            }
            
            // Mise à jour de la répartition par compte
            if (window.accountDistributionChart) {
                window.accountDistributionChart.update();
            }
        }
        
        function initializeFiscalCalendar() {
            // Initialisation du calendrier fiscal
            const calendarEl = document.getElementById('fiscal-calendar');
            if (calendarEl) {
                const today = new Date();
                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    height: 'auto',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: ''
                    },
                    events: [
                        {
                            title: 'Déclaration TVA',
                            start: new Date(today.getFullYear(), today.getMonth() + 1, 10),
                            backgroundColor: '#EF4444',
                            borderColor: '#EF4444'
                        },
                        {
                            title: 'Déclaration Sociale',
                            start: new Date(today.getFullYear(), today.getMonth(), 15),
                            backgroundColor: '#3B82F6',
                            borderColor: '#3B82F6'
                        },
                        {
                            title: 'Acompte IS',
                            start: new Date(today.getFullYear(), today.getMonth() + 1, 15),
                            backgroundColor: '#10B981',
                            borderColor: '#10B981'
                        }
                    ],
                    eventClick: function(info) {
                        alert(`Échéance: ${info.event.title} le ${info.event.start.toLocaleDateString()}`);
                    }
                });
                
                calendar.render();
            }
        }
        
        // Fonction pour mettre à jour le solde
        function updateSolde() {
            let totalDebit = 0;
            let totalCredit = 0;
            
            // Calculer le total des débits et crédits
            document.querySelectorAll('#lignes-ecriture tr').forEach(row => {
                const debitInput = row.querySelector('.ligne-debit');
                const creditInput = row.querySelector('.ligne-credit');
                
                if (debitInput && debitInput.value) {
                    totalDebit += parseFloat(debitInput.value);
                }
                
                if (creditInput && creditInput.value) {
                    totalCredit += parseFloat(creditInput.value);
                }
            });
            
            const solde = totalDebit - totalCredit;
            document.getElementById('solde-ecriture').textContent = solde.toFixed(2);
            
            // Changer la couleur du solde en fonction de son signe
            if (solde === 0) {
                document.getElementById('solde-ecriture').classList.remove('text-red-600', 'dark:text-red-400');
                document.getElementById('solde-ecriture').classList.add('text-green-600', 'dark:text-green-400');
            } else {
                document.getElementById('solde-ecriture').classList.remove('text-green-600', 'dark:text-green-400');
                document.getElementById('solde-ecriture').classList.add('text-red-600', 'dark:text-red-400');
            }
        }
    </script>
</body>
</html>